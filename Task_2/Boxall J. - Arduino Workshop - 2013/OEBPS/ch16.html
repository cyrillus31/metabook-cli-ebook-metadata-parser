<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 16. Reading RFID Tags</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch15.html" title="Chapter 15. Infrared Remote Control"/><link rel="next" href="ch17.html" title="Chapter 17. Data Buses"/></head><body><section class="chapter" title="Chapter 16. Reading RFID Tags" epub:type="chapter" id="reading_rfid_tags"><div class="titlepage"><div><div><h2 class="title">Chapter 16. Reading RFID Tags</h2></div></div></div><p><a id="iddle1405" class="indexterm"/>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Learn how to implement RFID readers with your Arduino</p></li><li class="listitem"><p>Understand how to save variables in the Arduino EEPROM</p></li><li class="listitem"><p>Design the framework for an Arduino-based RFID access system</p></li></ul></div><p><span class="emphasis"><em>Radio-frequency identification</em></span>, or <span class="emphasis"><em>RFID</em></span>, is a wireless system that uses electromagnetic fields to transfer data from one object to another, without the two objects touching. You can build an Arduino that reads common RFID tags and cards to create access systems and to control digital outputs. You may have used an RFID card before, such as an access card that you use to unlock a door or a public transport card that you hold in front of a reader on the bus. <a class="xref" href="ch16.html#example_rfid_devices" title="Figure 16-1. Example RFID devices">Figure 16-1</a> shows some examples of RFID tags and cards.</p><div class="figure"><a id="example_rfid_devices"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00266"/><img src="httpatomoreillycomsourcenostarchimages1630302.png.jpg" alt="Example RFID devices"/></div></div><div class="figure-title">Figure 16-1. Example RFID devices</div></div><div class="sect1" title="Inside RFID Devices"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="inside_rfid_devices">Inside RFID Devices</h2></div></div></div><p><a id="iddle1403" class="indexterm"/><a id="iddle1431" class="indexterm"/>Inside an RFID device is a tiny integrated circuit with memory that can be accessed by a specialized reader. Most tags don’t have a battery inside; instead, they’re powered by energy from an electromagnetic field produced by the RFID reader. This field is transmitted by a fine coil of wire, which also acts as the antenna for the transmission of data between the card and the reader. <a class="xref" href="ch16.html#our_rfid_reader" title="Figure 16-2. Our RFID reader">Figure 16-2</a> shows the antenna coil of the RFID reader that we’ll use in this chapter.</p><div class="figure"><a id="our_rfid_reader"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00267"/><img src="httpatomoreillycomsourcenostarchimages1630304.png.jpg" alt="Our RFID reader"/></div></div><div class="figure-title">Figure 16-2. Our RFID reader</div></div><p><a id="iddle1406" class="indexterm"/>The card reader we’ll use in this chapter is available from Seeed Studio at <span class="emphasis"><em><a class="ulink" href="http://www.seeedstudio.com/" target="_top">http://www.seeedstudio.com/</a></em></span>, part number ELB149C5M. It’s cheap and easy to use, and it operates at 125 kHz; be sure to purchase RFID tags that match that frequency, such as Seeed Studio part number RFR103B2B.</p></div><div class="sect1" title="Testing the Hardware"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="testing_the_hardware">Testing the Hardware</h2></div></div></div><p>In this section you’ll connect the RFID reader to the Arduino and then test that it’s working with a simple sketch that reads RFID cards and sends the data to the Serial Monitor.</p><div class="sect2" title="The Schematic"><div class="titlepage"><div><div><h3 class="title" id="schematic-id00129">The Schematic</h3></div></div></div><p><a class="xref" href="ch16.html#rfid_module_connections" title="Figure 16-3. RFID module connections">Figure 16-3</a> shows the RFID module connections.</p><div class="figure"><a id="rfid_module_connections"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00268"/><img src="httpatomoreillycomsourcenostarchimages1630306.png.jpg" alt="RFID module connections"/></div></div><div class="figure-title">Figure 16-3. RFID module connections</div></div></div><div class="sect2" title="Testing the Schematic"><div class="titlepage"><div><div><h3 class="title" id="testing_the_schematic">Testing the Schematic</h3></div></div></div><p>Once the RFID reader is connected to the Arduino, you can test it by placing the black jumper across the left and center pins of the jumper section. Then, to make the connections between the RFID reader and the Arduino, follow these steps, using female-to-male jumper wires:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Connect the included coil plug to the antenna socket.</p></li><li class="listitem"><p>Connect the reader GND to the Arduino GND.</p></li><li class="listitem"><p>Connect VCC to Arduino 5V.</p></li><li class="listitem"><p>Connect RX to Arduino pin D0.</p></li><li class="listitem"><p>Connect TX to Arduino pin D1.</p></li></ol></div><div class="note" title="Note"><h3 class="title"><a id="ch16note01"/>Note</h3><p><span class="emphasis"><em>When uploading sketches to the RFID-connected Arduino, be sure to remove the wire between the RFID reader RX and Arduino pin D0. Then reconnect it after the sketch has been uploaded successfully. This is because the D0 pin is also used by the Arduino board to communicate and receive sketches.</em></span></p></div><div class="sect3" title="The Test Sketch"><div class="titlepage"><div><div><h4 class="title" id="test_sketch-id00130">The Test Sketch</h4></div></div></div><p>Enter and upload <a class="xref" href="ch16.html#rfid_test_sketch" title="Example 16-1. RFID test sketch">Example 16-1</a>.</p><div class="example"><a id="rfid_test_sketch"/><div class="example-title">Example 16-1. RFID test sketch</div><div class="example-contents"><pre class="programlisting">// Listing 16-1
int data1 = 0;

void setup()
{
  Serial.begin(9600);
}

void loop()
{
  if (Serial.available() &gt; 0) {
    data1 = Serial.read();
    // display incoming number
    Serial.print(" ");
    Serial.print(data1, DEC);
  }
}</pre></div></div></div><div class="sect3" title="Check Serial Monitor"><div class="titlepage"><div><div><h4 class="title" id="check_serial_monitor">Check Serial Monitor</h4></div></div></div><p>Open the Serial Monitor window and wave an RFID tag over the coil. The results should look similar to <a class="xref" href="ch16.html#example_output_from_listing_16-1" title="Figure 16-4. Example output from Example 16-1">Figure 16-4</a>.</p><div class="figure"><a id="example_output_from_listing_16-1"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00269"/><img src="httpatomoreillycomsourcenostarchimages1630308.png.jpg" alt="Example output from"/></div></div><div class="figure-title">Figure 16-4. Example output from <a class="xref" href="ch16.html#rfid_test_sketch" title="Example 16-1. RFID test sketch">Example 16-1</a></div></div><p>Notice that 14 numbers are displayed in the Serial Monitor window. This is the RFID tag’s unique ID number, which we’ll use in future sketches to identify the tag being read. Now record the numbers that result from each of your tags, because you’ll need them for the next few projects.</p></div></div></div><div class="sect1" title="Project #52: Creating a Simple RFID Control System"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash52_creating_a_simple_rfid_co">Project #52: Creating a Simple RFID Control System</h2></div></div></div><p><a id="iddle1404" class="indexterm"/>Now let’s put the RFID system to use. In this project you’ll learn how to trigger an Arduino event when the correct RFID tag is read. This sketch stores two RFID tag numbers; when one of the cards is read by the reader, it will display <span class="emphasis"><em>Accepted</em></span> in the Serial Monitor. If the wrong card is presented, then the Serial Monitor will display <span class="emphasis"><em>Rejected</em></span>. We’ll use this as a base to add RFID controls to existing projects.</p><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00131">The Sketch</h3></div></div></div><p>Enter and upload the following sketch. However, at <span class="gray-background">1</span> and <span class="gray-background">2</span>, replace the <span class="emphasis"><em><code class="literal">x</code></em></span>s in each array with the numbers for each of the RFID tags you generated earlier in the chapter. (We discussed arrays in <a class="xref" href="ch06.html" title="Chapter 6. Numbers, Variables, and Arithmetic">Chapter 6</a>.)</p><a id="pro_id00146"/><pre class="programlisting">  // Project 52 – Creating a Simple RFID Control System

  int data1 = 0;
  int ok = -1;

  // use Listing 16-1 to find your tag numbers
<span class="gray-background">1</span> int tag1[14] = {<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>};
<span class="gray-background">2</span> int tag2[14] = {<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>};

  int newtag[14] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0}; // used for read comparisons

  void setup()
  {
    Serial.flush(); // need to flush serial buffer,
                    // otherwise first read may not be correct
    Serial.begin(9600);
  }

<span class="gray-background">3</span> boolean comparetag(int aa[14], int bb[14])
  {
    boolean ff = false;
    int fg = 0;
    for (int cc = 0 ; cc &lt; 14 ; cc++)
    {
      if (aa[cc] == bb[cc])
      {
        fg++;
      }
    }
    if (fg == 14)
    {
      ff = true;
    }
    return ff;
  }

<span class="gray-background">4</span> void checkmytags()  // compares each tag against the tag just read
  {
    ok = 0; // this variable helps decision-making,
            // if it is 1 we have a match, zero is a read but no match,
            // -1 is no read attempt made
    if (comparetag(newtag, tag1) == true)
    {
<span class="gray-background">5</span>     ok++;
    }
    if (comparetag(newtag, tag2) == true)
    {
<span class="gray-background">6</span>     ok++;
    }
  }

  void loop()
  {
    ok = -1;
    if (Serial.available() &gt; 0) // if a read has been attempted
    {
      // read the incoming number on serial RX
      delay(100);  // needed to allow time for the data
                   // to come in from the serial buffer.
      for (int z = 0 ; z &lt; 14 ; z++) // read the rest of the tag
<span class="gray-background">7</span>     {
        data1 = Serial.read();
        newtag[z] = data1;
      }
      Serial.flush(); // stops multiple reads
      // now to match tags up
<span class="gray-background">8</span>     checkmytags();
    }
<span class="gray-background">9</span>   //now do something based on tag type
    if (ok &gt; 0) // if we had a match
    {
      Serial.println("Accepted");
      ok = -1;
    }
    else if (ok == 0) // if we didn't have a match
    {
      Serial.println("Rejected");
      ok = -1;
    }
  }</pre></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works-id00132">How It Works</h3></div></div></div><p>When a tag is presented to the RFID reader, it sends the tag numbers through the serial port. We capture all 14 of these numbers and place them in the array <code class="literal">newtag[]</code> at <span class="gray-background">7</span>. Next, the tag is compared against the <a id="iddle1163" class="indexterm"/>two stored tag numbers at <span class="gray-background">1</span> and <span class="gray-background">2</span> using the function <code class="literal">checkmytags()</code> at <span class="gray-background">4</span> and <span class="gray-background">8</span>, with the actual comparisons of the tag arrays passed to the function <code class="literal">comparetag()</code> at <span class="gray-background">3</span>.</p><p>The <code class="literal">comparetag()</code> function accepts the two number arrays as parameters and returns (in Boolean) whether the arrays are identical (<code class="literal">true</code>) or different (<code class="literal">false</code>). If a match is made, the variable <code class="literal">OK</code> is set to 1 at <span class="gray-background">5</span> and <span class="gray-background">6</span>. Finally, at <span class="gray-background">9</span>, we have the actions to take once the tag read succeeds.</p><p>After uploading the sketch and reconnecting the wire from Arduino D0 to the RFID reader RX (see <a class="xref" href="ch16.html#rfid_module_connections" title="Figure 16-3. RFID module connections">Figure 16-3</a>), open the Serial Monitor window and present some tags to the reader. The results should be similar to <a class="xref" href="ch16.html#results_of_project_52" title="Figure 16-5. Results of Project 52">Figure 16-5</a>.</p><div class="figure"><a id="results_of_project_52"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00270"/><img src="httpatomoreillycomsourcenostarchimages1630310.png.jpg" alt="Results of Project 52"/></div></div><div class="figure-title">Figure 16-5. Results of Project 52</div></div></div></div><div class="sect1" title="Storing Data in the Arduino’s Built-in EEPROM"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="storing_data_in_the_arduinoapostrophes_b">Storing Data in the Arduino’s Built-in EEPROM</h2></div></div></div><p>When you define and use a variable in your Arduino sketches, the stored data lasts only until the Arduino is reset or the power is turned off. But what if you want to keep the values for future use, such as in the userchangeable secret code for the numeric keypad in <a class="xref" href="ch09.html" title="Chapter 9. Numeric Keypads">Chapter 9</a>? That’s where the <span class="emphasis"><em>EEPROM (electrically erasable read-only memory)</em></span> comes in. The EEPROM stores variables in memory inside an ATmega328 microcontroller, and the variables aren’t lost when the power is turned off.</p><p>The EEPROM in the Arduino can store 1,024-byte variables in positions numbered from 0 to 1,023. Recall that a byte can store an integer with a value between 0 and 255, and you begin to see why it’s perfect for storing RFID tag numbers. To use the EEPROM in our sketches, we first call the EEPROM library (included with the Arduino IDE) using the following:</p><a id="pro_id00147"/><pre class="programlisting">#include &lt;EEPROM.h&gt;</pre><p>Then, to write a value to the EEPROM, we simply use this:</p><a id="pro_id00148"/><pre class="programlisting">EEPROM.write(a, b);</pre><p><a id="iddle1165" class="indexterm"/><a id="iddle1166" class="indexterm"/><a id="iddle1167" class="indexterm"/>Here, <code class="literal">a</code> is the position in which the value (which falls between 0 and 1,023) will be stored, and <code class="literal">b</code> is the variable holding the byte of data we want to store in the EEPROM position number <code class="literal">a</code>.</p><p>To retrieve data from the EEPROM, use this function:</p><a id="pro_id00149"/><pre class="programlisting">value = EEPROM.read(position);</pre><p>This takes the data stored in EEPROM position number <code class="literal">position</code> and stores it in the variable <code class="literal">value</code>.</p><div class="note" title="Note"><h3 class="title"><a id="ch16note02"/>Note</h3><p><span class="emphasis"><em>The EEPROM has a finite life, and it can eventually wear out! According to the manufacturer, Atmel, it can sustain 100,000 write/erase cycles for each position. Reads are unlimited.</em></span></p></div><div class="sect2" title="Reading and Writing to the EEPROM"><div class="titlepage"><div><div><h3 class="title" id="reading_and_writing_to_the_eeprom">Reading and Writing to the EEPROM</h3></div></div></div><p>Here’s an example of how to read and write to the EEPROM. Enter and upload <a class="xref" href="ch16.html#eeprom_demonstration_sketch" title="Example 16-2. EEPROM demonstration sketch">Example 16-2</a>.</p><div class="example"><a id="eeprom_demonstration_sketch"/><div class="example-title">Example 16-2. EEPROM demonstration sketch</div><div class="example-contents"><pre class="programlisting">  // Listing 16-2
  #include &lt;EEPROM.h&gt;
  int zz;

  void setup()
  {
    Serial.begin(9600);
    randomSeed(analogRead(0));
  }

  void loop()
  {
    Serial.println("Writing random numbers...");
    for (int i = 0; i &lt; 1024; i++)
    {
      zz = random(255);
<span class="gray-background">1</span>     EEPROM.write(i, zz);
    }
    Serial.println();
    for (int a = 0; a &lt; 1024; a++)
    {
<span class="gray-background">2</span>     zz = EEPROM.read(a);
      Serial.print("EEPROM position: ");
      Serial.print(a);
      Serial.print(" contains ");
<span class="gray-background">3</span>     Serial.println(zz);
      delay(25);
    }
  }</pre></div></div><p>In the loop at <span class="gray-background">1</span>, a random number between 0 and 255 is stored in each EEPROM position. The stored values are retrieved in the second loop at <span class="gray-background">2</span>, to be displayed in the Serial Monitor at <span class="gray-background">3</span>.</p><p>Once the sketch has been uploaded, open the Serial Monitor and you should see something like <a class="xref" href="ch16.html#example_output_from_listing_16-2" title="Figure 16-6. Example output from Example 16-2">Figure 16-6</a>.</p><div class="figure"><a id="example_output_from_listing_16-2"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00271"/><img src="httpatomoreillycomsourcenostarchimages1630312.png.jpg" alt="Example output from"/></div></div><div class="figure-title">Figure 16-6. Example output from <a class="xref" href="ch16.html#eeprom_demonstration_sketch" title="Example 16-2. EEPROM demonstration sketch">Example 16-2</a></div></div><p>Now you’re ready to create a project using the EEPROM.</p></div></div><div class="sect1" title="Project #53: Creating an RFID Control with “Last Action” Memory"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash53_creating_an_rfid_control">Project #53: Creating an RFID Control with “Last Action” Memory</h2></div></div></div><p>Although Project 52 showed how to use an RFID to control something, such as a light or electric door lock, we had to assume that nothing would be remembered if the system were reset or the power went out. For example, if a light was on and the power went out, then the light would be off once the power returned. However, once the power comes back on, you want the Arduino to remember what was happening before the power went out and return to that state. Let’s solve that problem now.</p><p>In this project, the last action will be stored in the EEPROM (for example, “locked” or “unlocked”). When the sketch restarts after a power failure or an Arduino reset, the system will revert to the previous state stored in the EEPROM.</p><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00133">The Sketch</h3></div></div></div><p>Enter and upload the following sketch. Again, replace the <span class="emphasis"><em><code class="literal">x</code></em></span>s in each array at <span class="gray-background">1</span> and <span class="gray-background">2</span> with the numbers for each of the two RFID tags as you did for Project 52.</p><a id="pro_id00150"/><pre class="programlisting">  // Project 53 – Creating an RFID Control with "Last Action" Memory

  #include &lt;EEPROM.h&gt;

  int data1 = 0;
  int ok = -1;
  int lockStatus = 0;

  // use Listing 16-1 to find your tag numbers
<span class="gray-background">1</span> int tag1[14] = {<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>};
<span class="gray-background">2</span> int tag2[14] = {<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>x</em></span>};

  int newtag[14] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0}; // used for read comparisons

  void setup()
  {
    Serial.flush();
    Serial.begin(9600);
    pinMode(13, OUTPUT);
<span class="gray-background">3</span>   checkLock();
  }

  // comparetag compares two arrays and returns true if identical
  // this is good for comparing tags
  boolean comparetag(int aa[14], int bb[14])
  {
    boolean ff = false;
    int fg = 0;
    for (int cc = 0; cc &lt; 14; cc++)
    {
      if (aa[cc] == bb[cc])
      {
        fg++;
      }
    }
    if (fg == 14)
    {
      ff = true;
    }
    return ff;
  }

  void checkmytags()
  // compares each tag against the tag just read
  {
    ok = 0;
    if (comparetag(newtag, tag1) == true)
    {
      ok++;
    }
    if (comparetag(newtag, tag2) == true)
    {
      ok++;
    }
  }

<span class="gray-background">4</span> void checkLock()
  {
    Serial.print("System Status after restart ");
    lockStatus = EEPROM.read(0);
    if (lockStatus == 1)
    {
      Serial.println("- locked");
      digitalWrite(13, HIGH);
    }
    if (lockStatus == 0)
    {
      Serial.println("- unlocked");
      digitalWrite(13, LOW);
    }
    if ((lockStatus != 1) &amp;&amp; (lockStatus != 0))
    {
      Serial.println("EEPROM fault - Replace Arduino hardware");
    }
  }

  void loop()
  {
    ok = -1;
    if (Serial.available() &gt; 0) // if a read has been attempted
    {
      // read the incoming number on serial RX
      delay(100);
      for (int z = 0; z &lt; 14; z++) // read the rest of the tag
      {
        data1 = Serial.read();
        newtag[z] = data1;
      }
      Serial.flush(); // prevents multiple reads
      // now to match tags up
      checkmytags();
    }
<span class="gray-background">5</span>   if (ok &gt; 0) // if we had a match
    {
      lockStatus = EEPROM.read(0);
      if (lockStatus == 1) // if locked, unlock it
<span class="gray-background">6</span>     {
        Serial.println("Status - unlocked");
        digitalWrite(13, LOW);
        EEPROM.write(0, 0);
      }
      if (lockStatus == 0)
<span class="gray-background">7</span>     {
        Serial.println("Status - locked");
        digitalWrite(13, HIGH);
        EEPROM.write(0, 1);
      }
      if ((lockStatus != 1) &amp;&amp; (lockStatus != 0))
<span class="gray-background">8</span>     {
        Serial.println("EEPROM fault - Replace Arduino hardware");
      }
    }
    else if (ok == 0) // if we didn't have a match
    {
      Serial.println("Incorrect tag");
      ok = -1;
    }
    delay(500);
  }</pre></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works-id00134">How It Works</h3></div></div></div><p>This sketch is a modification of Project 52. We use the onboard LED to simulate the status of something that we want to turn on or off every time an acceptable RFID tag is read. After a tag has been read and matched, the status of the lock is changed at <span class="gray-background">5</span>. We store the status of the lock in the first position of the EEPROM. The status is represented by a number: <code class="literal">0</code> is unlocked and <code class="literal">1</code> is locked. This status will change (from locked to unlocked and back to locked) after every successful tag read at <span class="gray-background">6</span> or <span class="gray-background">7</span>.</p><p>We’ve also introduced a fail-safe in case the EEPROM has worn out. If the value returned from reading the EEPROM is not <code class="literal">0</code> or <code class="literal">1</code>, we should be notified at <span class="gray-background">8</span>. Furthermore, the status is checked when the sketch restarts after a reset using the function <code class="literal">checkLock()</code> at <span class="gray-background">1</span>, <span class="gray-background">2</span>, <span class="gray-background">3</span>, and <span class="gray-background">4</span>, which reads the EEPROM value, determines the last status, and then sets the lock to that status (locked or unlocked).</p></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00135">Looking Ahead</h2></div></div></div><p>Once again we have used an Arduino board to re-create simply what could be a very complex project. You now have a base to add RFID control to your projects to create professional-quality access systems and to control digital outputs with the swipe of an RFID card. We’ll demonstrate this again when we revisit RFID in <a class="xref" href="ch18.html" title="Chapter 18. Real-time Clocks">Chapter 18</a>.</p></div></section></body></html>
