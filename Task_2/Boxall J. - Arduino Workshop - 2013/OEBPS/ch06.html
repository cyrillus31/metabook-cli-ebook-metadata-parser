<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 6. Numbers, Variables, and Arithmetic</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch05.html" title="Chapter 5. Working with Functions"/><link rel="next" href="ch07.html" title="Chapter 7. Liquid Crystal Displays"/></head><body><section class="chapter" title="Chapter 6. Numbers, Variables, and Arithmetic" epub:type="chapter" id="numberscomma_variablescomma_and_arithmet"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Numbers, Variables, and Arithmetic</h2></div></div></div><p>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Generate random numbers</p></li><li class="listitem"><p>Create electronic dice</p></li><li class="listitem"><p>Learn about binary numbers</p></li><li class="listitem"><p>Use shift-register integrated circuits (ICs) to get more digital output pins</p></li><li class="listitem"><p>Test your knowledge of binary numbers with a quiz</p></li><li class="listitem"><p>Learn about arrays of variables</p></li><li class="listitem"><p>Display numbers on seven-segment LED modules</p></li><li class="listitem"><p>Learn how to use the modulo math function</p></li><li class="listitem"><p>Create a digital thermometer</p></li><li class="listitem"><p>Learn about bitwise arithmetic</p></li><li class="listitem"><p>Create fixed and moving images on LED matrix displays</p></li></ul></div><p>You will learn a wide variety of useful new functions that will create more project options, including random number generation, new kinds <a id="iddle1408" class="indexterm"/><a id="iddle1409" class="indexterm"/><a id="iddle1410" class="indexterm"/>of math functions, and variable storage in ordered lists called <span class="emphasis"><em>arrays</em></span>. Furthermore, you will learn how to use LED display modules in numeric and matrix form to display data and simple images. Finally, we put all that together to create a game, a digital thermometer, and more.</p><div class="sect1" title="Generating Random Numbers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="generating_random_numbers">Generating Random Numbers</h2></div></div></div><p>The ability for a program to generate random numbers can be very useful in games and effects. For example, you can use random numbers to play a dice or lottery game with the Arduino, to create lighting effects with LEDs, or to create visual or auditory effects for a quiz game with the Arduino. Unfortunately, the Arduino can’t choose a purely random number by itself. You have to help it by providing a <span class="emphasis"><em>seed,</em></span> an arbitrary starting number used in the calculations to generate a random number.</p><div class="sect2" title="Using Ambient Current to Generate a Random Number"><div class="titlepage"><div><div><h3 class="title" id="using_ambient_current_to_generate_a_rand">Using Ambient Current to Generate a Random Number</h3></div></div></div><p>The easiest way to generate a random number with the Arduino is to write a program that reads the voltage from a free (disconnected) analog pin (for example, analog pin zero) with this line in <code class="literal">void setup()</code>:</p><a id="pro_id00053"/><pre class="programlisting">randomSeed(analogRead(0));</pre><p>Even when nothing is wired to an analog input on the Arduino, static electricity in the environment creates a tiny, measurable voltage. The amount of this voltage is quite random. We can use this measure of ambient voltage as our seed to generate a random number and then allocate it to an integer variable using the <code class="literal">random(lower, upper)</code> function. We can use the parameters <code class="literal">lower</code> and <code class="literal">upper</code> to set the lower and upper limits of the range for the random number. For example, to generate a random number between 100 and 1,000, you would use the following:</p><a id="pro_id00054"/><pre class="programlisting">int a = 0;
a = random(100, 1001);</pre><p>We’ve used the number 1,001 rather than 1,000 because the 1,001 upper limit is <span class="emphasis"><em>exclusive</em></span>, meaning it’s not included in the range.</p><p>That said, to generate a random number between 0 and some number, you can just enter the upper limit. Here’s how you would generate a random number between 0 and 6:</p><a id="pro_id00055"/><pre class="programlisting">a = random(7);</pre><p>The example sketch in <a class="xref" href="ch06.html#random_number_generator" title="Example 6-1. Random number generator">Example 6-1</a> would generate random numbers between 0 and 1,000, as well as numbers between 10 and 50:</p><div class="example"><a id="random_number_generator"/><div class="example-title">Example 6-1. Random number generator</div><div class="example-contents"><pre class="programlisting">// Listing 6-1
int r = 0;

void setup()
{
  randomSeed(analogRead(0));
  Serial.begin(9600);
}

void loop()
{
  Serial.print("Random number between zero and 1000 is: ");
  r = random(0, 1001);
  Serial.println(r);
  Serial.print("Random number between ten and fifty is: ");
  r = random(10, 51);
  Serial.println(r);
  delay(1000);
}</pre></div></div><p><a id="iddle1145" class="indexterm"/><a class="xref" href="ch06.html#output_from_listing_6-1" title="Figure 6-1. Output from Example 6-1">Figure 6-1</a> shows the result displayed on the Serial Monitor.</p><div class="figure"><a id="output_from_listing_6-1"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00110"/><img src="httpatomoreillycomsourcenostarchimages1629982.png.jpg" alt="Output from"/></div></div><div class="figure-title">Figure 6-1. Output from <a class="xref" href="ch06.html#random_number_generator" title="Example 6-1. Random number generator">Example 6-1</a></div></div><p>Now that you know how to generate random numbers, let’s put that knowledge to good use by creating an electronic die.</p></div></div><div class="sect1" title="Project #15: Creating an Electronic Die"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash15_creating_an_electronic_di">Project #15: Creating an Electronic Die</h2></div></div></div><p>Our goal is to light one of six LEDs randomly to mimic the throw of a die. We’ll choose a random number between 1 and 6, and then turn on the corresponding LED to indicate the result. We’ll create a function to select one of six LEDs on the Arduino randomly and to keep the LED on for a certain period of time. When the Arduino running the sketch is turned on or reset, it should rapidly show random LEDs for a specified period of time and then gradually slow until the final LED is lit. The LED matching the resulting randomly chosen number will stay on until the Arduino is reset or turned off.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00042">The Hardware</h3></div></div></div><p>To build the die, we’ll need the following hardware:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Six LEDs of any color (LED1 to LED6)</p></li><li class="listitem"><p>One 560 Ω resistor (R1)</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>One medium-sized breadboard</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div></div><div class="sect2" title="The Schematic"><div class="titlepage"><div><div><h3 class="title" id="schematic-id00043">The Schematic</h3></div></div></div><p>Because only one LED will be lit at a time, a single current-limiting resistor can go between the cathodes of the LEDs and GND. <a class="xref" href="ch06.html#schematic_for_project_15" title="Figure 6-2. Schematic for Project 15">Figure 6-2</a> shows the schematic for our die.</p><div class="figure"><a id="schematic_for_project_15"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00111"/><img src="httpatomoreillycomsourcenostarchimages1629984.png.jpg" alt="Schematic for Project 15"/></div></div><div class="figure-title">Figure 6-2. Schematic for Project 15</div></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00044">The Sketch</h3></div></div></div><p>Here’s the sketch for our die:</p><a id="pro_id00056"/><pre class="programlisting">  // Project 15 - Creating an Electronic Die
  void setup()
  {
    randomSeed(analogRead(0));      // seed the random number generator
    for ( int z = 1 ; z &lt; 7 ; z++ ) // LEDs on pins 1-6 are output
    {
      pinMode(z, OUTPUT);
    }
  }

  void randomLED(int del)
  {
    int r;
    r = random(1, 7);      // get a random number from 1 to 6
    digitalWrite(r, HIGH); // output to the matching LED on digital pin 1-6
    if (del &gt; 0)
    {
<span class="gray-background">1</span>     delay(del);            // hold the LED on for the delay received
    }
<span class="gray-background">2</span>     else if (del == 0)
    {
      do                   // the delay entered was zero, hold the LED on forever
      {}
<span class="gray-background">3</span>     while (1);
    }
    digitalWrite(r, LOW);  // turn off the LED
  }

  void loop()
  {
    int a;
    // cycle the LEDs around for effect
    for ( a = 0 ; a &lt; 100 ; a++ )
    {
      randomLED(50);
    }
    // slow down
<span class="gray-background">4</span>   for ( a = 1 ; a &lt;= 10 ; a++ )
    {
      randomLED(a * 100);
    }
    // and stop at the final random number and LED
    randomLED(0);
  }</pre><p>Here we use a loop in <code class="literal">void setup()</code> to activate the digital output pins. The function <code class="literal">randomLED()</code> receives an integer that is used in the <code class="literal">delay()</code> function at <span class="gray-background">1</span> to keep the LED turned on for the selected time. If the <a id="iddle1086" class="indexterm"/><a id="iddle1089" class="indexterm"/>value of the delay received at <span class="gray-background">2</span> is <code class="literal">0</code>, then the function keeps the LED turned on indefinitely, because we use</p><a id="pro_id00057"/><pre class="programlisting">do {} while (1);</pre><p>at <span class="gray-background">3</span>, which loops forever, because 1 is always 1.</p><p>To “roll the die,” we reset the Arduino to restart the sketch. To create a decreasingly slow change in the LEDs before the final value is displayed, at <span class="gray-background">4</span> we first display a random LED 100 times for 50 milliseconds each time. Next, we slow it down by increasing the delay between LED flashes from 100 to 1,000 milliseconds, with each flash lasting 100 milliseconds. The purpose of this is to simulate the “slowing down” of a die before it finally settles on a value, at which point the Arduino displays the outcome of the roll by keeping one LED lit with this last line:</p><a id="pro_id00058"/><pre class="programlisting">randomLED(0);</pre></div><div class="sect2" title="Modifying the Sketch"><div class="titlepage"><div><div><h3 class="title" id="modifying_the_sketch">Modifying the Sketch</h3></div></div></div><p>We can tinker with this project in many ways. For example, we could add another six LEDs to roll two dice at once, or perhaps display the result using only the built-in LED by blinking it a number of times to indicate the result of the roll. Use your imagination and new skills to have some fun!</p></div></div><div class="sect1" title="A Quick Course in Binary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="quick_course_in_binary">A Quick Course in Binary</h2></div></div></div><p>Most children learn to count using the<span class="emphasis"><em/></span> base-10<span class="emphasis"><em/></span> system, but computers (and the Arduino) count using the binary<span class="emphasis"><em/></span> number system. <span class="emphasis"><em>Binary numbers</em></span> consist of only 1s and 0s—for example, 10101010. In binary, each digit from right to left represents 2 to the power of the column number in which it appears (which increases from right to left). The products in each column are then added to determine the value of the number.</p><p>For example, consider the binary number 11111111, as shown in <a class="xref" href="ch06.html#binary_to_base-10_number_conversion_exam" title="Table 6-1. Binary to base-10 number conversion example">Table 6-1</a>. To convert the number 11111111 in binary to base 10, we add the totals in each column as listed in the bottom row of the table:</p><p>128 + 64 + 32 + 16 + 8 + 4 + 2 + 1</p><p>It is 255. A binary number with eight columns (or <span class="emphasis"><em>bits</em></span>) holds 1 <span class="emphasis"><em>byte</em></span> of data; 1 byte of data can have a numerical value between 0 and 255. The leftmost bit is referred to as the <span class="emphasis"><em>Most Significant Bit (MSB)</em></span>, and the rightmost is the <span class="emphasis"><em>Least Significant Bit (LSB)</em></span>.</p><p>Binary numbers are great for storing certain types of data, such as on/off patterns for LEDs, true/false settings, and the statuses of digital outputs. Binary numbers are the building blocks of all types of data in computers.</p><div class="table"><a id="binary_to_base-10_number_conversion_exam"/><div class="table-title">Table 6-1. Binary to base-10 number conversion example</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/><col class="c5"/><col class="c6"/><col class="c7"/><col class="c8"/><col class="c9"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><a id="iddle1105" class="indexterm"/><a id="iddle1552" class="indexterm"/>2<sup>7</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>6</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>5</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>4</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>3</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>2</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>1</sup></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2<sup>0</sup></p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Binary</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>128</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>64</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>32</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>16</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>8</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; "><p>Base 10</p></td></tr></tbody></table></div></div><div class="sect2" title="Byte Variables"><div class="titlepage"><div><div><h3 class="title" id="byte_variables">Byte Variables</h3></div></div></div><p>One way we can store binary numbers is by using a <span class="emphasis"><em>byte variable.</em></span> For example, we can create the byte variable <code class="literal">outputs</code> using the following code:</p><a id="pro_id00059"/><pre class="programlisting">byte outputs = B11111111;</pre><p>The <code class="literal">B</code> in front of the number tells Arduino to read the number as a binary number (in this case, 11111111) instead of its base-10 equivalent of 255. <a class="xref" href="ch06.html#binary_number_demonstration" title="Example 6-2. Binary number demonstration">Example 6-2</a> demonstrates this further.</p><div class="example"><a id="binary_number_demonstration"/><div class="example-title">Example 6-2. Binary number demonstration</div><div class="example-contents"><pre class="programlisting">  // Listing 6-2

  byte a;

  void setup()
  {
    Serial.begin(9600);
  }

  void loop()
  {
    for ( int count = 0 ; count &lt; 256 ; count++ )
    {
      a = count;
      Serial.print("Base-10 = ");
<span class="gray-background">1</span>     Serial.print(a, DEC);
      Serial.print(" Binary = ");
<span class="gray-background">2</span>     Serial.println(a, BIN);
      delay(1000);
    }
  }</pre></div></div><p>We display byte variables as base-10 numbers using <code class="literal">DEC</code> <span class="gray-background">1</span> or as binary numbers using <code class="literal">BIN</code> <span class="gray-background">2</span> as part of the <code class="literal">Serial.print()</code> function. After uploading the sketch, you should see output in the Serial Monitor similar to that shown in <a class="xref" href="ch06.html#output_from_listing_6-2" title="Figure 6-3. Output from Example 6-2">Figure 6-3</a>.</p><div class="figure"><a id="output_from_listing_6-2"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00112"/><img src="httpatomoreillycomsourcenostarchimages1629986.png.jpg" alt="Output from"/></div></div><div class="figure-title">Figure 6-3. Output from <a class="xref" href="ch06.html#binary_number_demonstration" title="Example 6-2. Binary number demonstration">Example 6-2</a></div></div></div></div><div class="sect1" title="Increasing Digital Outputs with Shift Registers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="increasing_digital_outputs_with_shift_re">Increasing Digital Outputs with Shift Registers</h2></div></div></div><p><a id="iddle1029" class="indexterm"/><a id="iddle1199" class="indexterm"/><a id="iddle1468" class="indexterm"/><a id="iddle1469" class="indexterm"/><a id="iddle1470" class="indexterm"/><a id="iddle1471" class="indexterm"/>The Arduino board has 13 digital pins that we can use as outputs—but sometimes 13 just isn’t enough. To add outputs, we can use a <span class="emphasis"><em>shift register</em></span> and still have plenty of room left on the Arduino for outputs. A shift register is an integrated circuit (IC) with eight digital output pins that can be controlled by sending a byte of data to the IC. For our projects, we will be using the 74HC595 shift register shown in <a class="xref" href="ch06.html#seven4hc595_shift_register_ic" title="Figure 6-4. The 74HC595 shift register IC">Figure 6-4</a>.</p><div class="figure"><a id="seven4hc595_shift_register_ic"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00113"/><img src="httpatomoreillycomsourcenostarchimages1629988.png.jpg" alt="The 74HC595 shift register IC"/></div></div><div class="figure-title">Figure 6-4. The 74HC595 shift register IC</div></div><p>The 74HC595 shift register has eight digital outputs that can operate like the Arduino digital output pins. The shift register itself takes up three Arduino digital output pins, so the net gain is five output pins.</p><p>The principle behind the shift register is simple: We send 1 byte of data (8 bits) to the shift register, and it turns on or off the matching eight outputs based on the 1 byte of data. The bits representing the byte of data match the output pins in order from highest to lowest. So the leftmost bit of the data represents output pin 7 of the shift register, and the rightmost bit of the data represents output pin 0. For example, if we send <code class="literal">B10000110</code> to the shift register, then it will turn on outputs 7, 2, and 1 and will turn off outputs 0 and 3–6 until the next byte of data is received or the power is turned off.</p><p>More than one shift register can also be connected together to provide an extra eight digital output pins for every shift register attached to the same three Arduino pins; this makes shift registers very convenient when you want to control lots of LEDs. Let’s do that now by creating a binary number display.</p></div><div class="sect1" title="Project #16: Creating an LED Binary Number Display"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash16_creating_an_led_binary_nu">Project #16: Creating an LED Binary Number Display</h2></div></div></div><p><a id="iddle1087" class="indexterm"/><a id="iddle1157" class="indexterm"/><a id="iddle1472" class="indexterm"/>In this project, we’ll use eight LEDs to display binary numbers from 0 to 255. Our sketch will use a <code class="literal">for</code> loop to count from 0 to 255 and will send each value to the shift register, which will use LEDs to display the binary equivalent of each number.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00045">The Hardware</h3></div></div></div><p>The following hardware is required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One 74HC595 shift register IC</p></li><li class="listitem"><p>Eight LEDs (LED1 to LED8)</p></li><li class="listitem"><p>Eight 560 Ω resistors (R1 to R8)</p></li><li class="listitem"><p>One breadboard</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div></div><div class="sect2" title="Connecting the 74HC595"><div class="titlepage"><div><div><h3 class="title" id="connecting_the_74hc595">Connecting the 74HC595</h3></div></div></div><p><a class="xref" href="ch06.html#seven4hc595_schematic_symbol" title="Figure 6-5. 74HC595 schematic symbol">Figure 6-5</a> shows the schematic symbol for the 74HC595.</p><div class="figure"><a id="seven4hc595_schematic_symbol"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00114"/><img src="httpatomoreillycomsourcenostarchimages1629990.png.jpg" alt="74HC595 schematic symbol"/></div></div><div class="figure-title">Figure 6-5. 74HC595 schematic symbol</div></div><p>There are 16 pins on our shift register:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Pins 15 and 1 to 7 are the eight output pins that we control (labeled <span class="emphasis"><em>Q0</em></span> to <span class="emphasis"><em>Q7</em></span>, respectively).</p></li><li class="listitem"><p>Q7 outputs the first bit sent to the shift register, down to Q0, which outputs the last.</p></li><li class="listitem"><p>Pin 8 connects to GND.</p></li><li class="listitem"><p>Pin 9 is “data out” and is used to send data to another shift register if one is present.</p></li><li class="listitem"><p>Pin 10 is always connected to 5 V (for example, the 5 V connector on the Arduino).</p></li><li class="listitem"><p>Pins 11 and 12 are called <span class="emphasis"><em>clock</em></span> and <span class="emphasis"><em>latch</em></span>.</p></li><li class="listitem"><p>Pin 13 is called <span class="emphasis"><em>output enable</em></span> and is usually connected to GND.</p></li><li class="listitem"><p>Pin 14 is for incoming bit data sent from the Arduino.</p></li><li class="listitem"><p>Pin 16 is used for power: 5 V from the Arduino.</p></li></ul></div><p>To give you a sense of the way pins are oriented, the semicircular notch on the left end of the body of the shift register IC shown in <a class="xref" href="ch06.html#seven4hc595_shift_register_ic" title="Figure 6-4. The 74HC595 shift register IC">Figure 6-4</a> lies between pins 1 and 16.</p><p>The pins are numbered sequentially around the body in a counterclockwise direction, as shown in <a class="xref" href="ch06.html#schematic_for_project_16" title="Figure 6-6. Schematic for Project 16">Figure 6-6</a>, the schematic for our LED binary number display.</p><div class="figure"><a id="schematic_for_project_16"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00115"/><img src="httpatomoreillycomsourcenostarchimages1629992.png.jpg" alt="Schematic for Project 16"/></div></div><div class="figure-title">Figure 6-6. Schematic for Project 16</div></div><div class="note" title="Note"><h3 class="title"><a id="ch06note01"/>Note</h3><p><span class="emphasis"><em>Once you have finished with this example circuit, keep it assembled. We’ll use it again with the forthcoming project.</em></span></p></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00046">The Sketch</h3></div></div></div><p><a id="iddle1467" class="indexterm"/>And now for the sketch:</p><a id="pro_id00060"/><pre class="programlisting">// Project 16 – Creating an LED Binary Number Display
#define DATA  6          // digital 6 to pin 14 on the 74HC595
#define LATCH 8          // digital 8 to pin 12 on the 74HC595
#define CLOCK 10         // digital 10 to pin 11 on the 74HC595

void setup()
{
   pinMode(LATCH, OUTPUT);
   pinMode(CLOCK, OUTPUT);
   pinMode(DATA, OUTPUT);
}

void loop()
{
   int i;
   for ( i = 0; i &lt; 256; i++ )
   {
     digitalWrite(LATCH, LOW);
     shiftOut(DATA, CLOCK, MSBFIRST, a);
     digitalWrite(LATCH, HIGH);
     delay(200);
   }
}</pre><p>In this sketch, we set the three pins connected to the shift register as outputs in <code class="literal">void setup()</code> and then add a loop in <code class="literal">void loop()</code> that counts from 0 to 255 and repeats. The magic lies inside the loop. When we send a byte of data (for example, 240, or B11110000) to the shift register in the <code class="literal">for</code> loop, three things happen:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The latch pin 12 is set to <code class="literal">LOW</code> (that is, a low signal is applied to it from the Arduino digital output pin 8). This is preparation for setting output pin 12 to <code class="literal">HIGH</code>, which latches the data to the output pins after <code class="literal">shiftOut</code> has completed its task.</p></li><li class="listitem"><p>We send the byte of data (for example, B11110000) from Arduino digital pin 6 to the shift register and tell the <code class="literal">shiftOut</code> function from which direction to interpret the byte of data. For example, if you selected <code class="literal">LSBFIRST</code>, then LEDs 1 to 4 would turn on and the others would turn off. If you used <code class="literal">MSBFIRST</code>, then LEDs 5 to 8 would turn on and the others would turn off.</p></li><li class="listitem"><p>Finally, the latch pin 12 is set to <code class="literal">HIGH</code> (5 V is applied to it). This tells the shift register that all the bits are shifted in and ready. At this point it alters its output to match the data received.</p></li></ul></div></div></div><div class="sect1" title="Project #17: Making a Binary Quiz Game"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash17_making_a_binary_quiz_game">Project #17: Making a Binary Quiz Game</h2></div></div></div><p><a id="iddle1088" class="indexterm"/>In this project we’ll use random numbers, the Serial Monitor, and the circuit created in Project 16 to create a binary quiz game. The Arduino will display a random binary number using the LEDs, and then you will enter the decimal version of the binary number using the Serial Monitor. The Serial Monitor will then tell you whether your answer is correct and the game will continue with a new number.</p><div class="sect2" title="The Algorithm"><div class="titlepage"><div><div><h3 class="title" id="algorithm-id00047">The Algorithm</h3></div></div></div><p>The algorithm can be divided into three functions. The <code class="literal">displayNumber()</code> function will display a binary number using the LEDs. The <code class="literal">getAnswer()</code> function will receive a number from the Serial Monitor and display it to the user. Finally, the <code class="literal">checkAnswer()</code> function will compare the user’s number to the random number generated and display the correct/incorrect status and the correct answer if the guess was incorrect.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00048">The Sketch</h3></div></div></div><p>The sketch generates a random number between 0 and 255, displays it in binary using the LEDs, asks the user for his or her answer, and then displays the results in the Serial Monitor. You’ve already seen all the functions used in the sketch, so although there’s a lot of code here, it should look familiar. We’ll dissect it with comments within the sketch and some commentary following.</p><a id="pro_id00061"/><pre class="programlisting">  // Project 17 - Making a Binary Quiz Game

  #define DATA   6                 // connect to pin 14 on the 74HC595
  #define LATCH  8                 // connect to pin 12 on the 74HC595
  #define CLOCK 10                 // connect to pin 11 on the 74HC595

  int number = 0;
  int answer = 0;

<span class="gray-background">1</span> void setup()
  {
    pinMode(LATCH, OUTPUT);       // set up the 74HC595 pins
    pinMode(CLOCK, OUTPUT);
    pinMode(DATA, OUTPUT);
    Serial.begin(9600);
    randomSeed(analogRead(0));    // initialize the random number generator
    displayNumber(0);             // clear the LEDs
  }

<span class="gray-background">2</span> void displayNumber(byte a)
  {
    // sends byte to be displayed on the LEDs
    digitalWrite(LATCH, LOW);

    shiftOut(DATA, CLOCK, MSBFIRST, a);
    digitalWrite(LATCH, HIGH);
  }

<span class="gray-background">3</span> void getAnswer()
  {
    // receive the answer from the player
    int z = 0;
    Serial.flush();
    while (Serial.available() == 0)
    {
       // do nothing until something comes into the serial buffer
    }
    // one character of serial data is available, begin calculating
    while (Serial.available() &gt; 0)
    {
      // move any previous digit to the next column on the left; in
      // other words, 1 becomes 10 while there is data in the buffer
      answer = answer * 10;
      // read the next number in the buffer and subtract the character '0'
      // from it to convert it to the actual integer number
      z = Serial.read() - '0';
      // add this digit into the accumulating value
      answer = answer + z;
      // allow a short delay for any more numbers to come into Serial.available
      delay(5);
    }
    Serial.print("You entered: ");
    Serial.println(answer);
  }

<span class="gray-background">4</span> void checkAnswer()
  {
    //check the answer from the player and show the results
    if (answer == number)    // Correct!
    {
      Serial.print("Correct! ");
      Serial.print(answer, BIN);
      Serial.print(" equals ");
      Serial.println(number);
      Serial.println();
    }
    else                     // Incorrect
    {
      Serial.print("Incorrect, ");
      Serial.print(number, BIN);
      Serial.print(" equals ");
      Serial.println(number);
      Serial.println();
    }
    answer = 0;
    delay(10000); // give the player time to review his or her answers
  }

  void loop()
  {
    number = random(256);
    displayNumber(number);
    Serial.println("What is the binary number in base-10? ");
    getAnswer();
    checkAnswer();
  }</pre><p><a id="iddle1069" class="indexterm"/>Let’s review how the sketch works. At <span class="gray-background">1</span>, <code class="literal">void setup()</code> configures the digital output pins to use the shift register, starts the Serial Monitor, and seeds the random number generator. At <span class="gray-background">2</span>, the custom function <code class="literal">displayNumber()</code> accepts a byte of data and sends it to the shift register, which uses LEDs to display the byte in binary form via the attached LEDs (as in Project 16). At <span class="gray-background">3</span>, the custom function <code class="literal">getAnswer()</code> accepts a number from the user via the Serial Monitor (as in Project 14) and displays it, as shown in <a class="xref" href="ch06.html#project_17_in_play" title="Figure 6-7. Project 17 in play">Figure 6-7</a>.</p><p>The function <code class="literal">checkAnswer()</code> at <span class="gray-background">4</span> compares the number entered by the player in <code class="literal">getAnswer()</code> against the random number generated by the sketch in <code class="literal">void loop()</code>. The player is then advised of a correct or incorrect answer with corresponding binary and decimal values. Finally, in the main <code class="literal">void loop()</code> from which the program runs, the Arduino generates the random binary number for the quiz, then calls the matching functions to display it with hardware, and then receives and checks the player’s answer.</p><p><a class="xref" href="ch06.html#project_17_in_play" title="Figure 6-7. Project 17 in play">Figure 6-7</a> shows the game in play in the Serial Monitor.</p><div class="figure"><a id="project_17_in_play"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00116"/><img src="httpatomoreillycomsourcenostarchimages1629994.png.jpg" alt="Project 17 in play"/></div></div><div class="figure-title">Figure 6-7. Project 17 in play</div></div></div></div><div class="sect1" title="Arrays"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="arrays">Arrays</h2></div></div></div><p>An <span class="emphasis"><em>array</em></span> is a set of variables or values grouped together so that they can be referenced as a whole. When dealing with lots of related data, you’ll find it a good idea to use arrays to keep your data organized.</p><div class="sect2" title="Defining an Array"><div class="titlepage"><div><div><h3 class="title" id="defining_an_array">Defining an Array</h3></div></div></div><p>Each item in an array is called an <span class="emphasis"><em>element</em></span>. For example, suppose six <code class="literal">float</code> variables contain temperatures taken over the last six hours; instead of <a id="iddle1070" class="indexterm"/>giving them all separate names, we can define an array called <code class="literal">temperatures</code> with six elements like this:</p><a id="pro_id00062"/><pre class="programlisting">float temperatures[6];</pre><p>We can also insert values when defining the array. When we do that, we don’t need to define the array size. Here’s an example:</p><a id="pro_id00063"/><pre class="programlisting">float temperatures[]={11.1, 12.2, 13.3, 14.4, 15.5, 16.6};</pre><p>Notice that this time we didn’t explicitly define the size of the array within the square brackets (<code class="literal">[]</code>); instead, its size is deduced based on the number of elements set by the values inside the curly brackets (<code class="literal">{}</code>).</p></div><div class="sect2" title="Referring to Values in an Array"><div class="titlepage"><div><div><h3 class="title" id="referring_to_values_in_an_array">Referring to Values in an Array</h3></div></div></div><p>We count the elements in an array beginning from the left and starting from 0; the <code class="literal">temperatures[]</code> array has elements numbered 0 to 5. We can refer to individual values within an array by inserting the number of the element in the square brackets. For example, to change the first element in <code class="literal">temperatures[]</code> (currently 16.6) to 12.34, we would use this:</p><a id="pro_id00064"/><pre class="programlisting">temperatures[0] = 12.34;</pre></div><div class="sect2" title="Writing to and Reading from Arrays"><div class="titlepage"><div><div><h3 class="title" id="writing_to_and_reading_from_arrays">Writing to and Reading from Arrays</h3></div></div></div><p>In <a class="xref" href="ch06.html#array_readsoliduswrite_demonstration" title="Example 6-3. Array read/write demonstration">Example 6-3</a>, we demonstrate writing values to and reading values from an array of five elements. The first <code class="literal">for</code> loop in the sketch writes a random number into each of the array’s elements, and the second <code class="literal">for</code> loop retrieves the elements and displays them in the Serial Monitor.</p><div class="example"><a id="array_readsoliduswrite_demonstration"/><div class="example-title">Example 6-3. Array read/write demonstration</div><div class="example-contents"><pre class="programlisting">// Listing 6-3

void setup()
{
  Serial.begin(9600);
  randomSeed(analogRead(0));
}
int array[5];    // define our array of five integer elements
void loop()
{
  int i;
  Serial.println();
  for ( i = 0 ; i &lt; 5 ; i++ )   // write to the array
  {
    array[i] = random(10);      // random numbers from 0 to 9
  }
  for ( i = 0 ; i &lt; 5 ; i++ )   // display the contents of the array
  {
    Serial.print("array[");
    Serial.print(i);
    Serial.print("] contains ");
    Serial.println(array[i]);
  }
  delay(5000);
}</pre></div></div><p><a id="iddle1026" class="indexterm"/><a id="iddle1331" class="indexterm"/><a class="xref" href="ch06.html#listing_6-3_in_action" title="Figure 6-8. Listing 6-3 in action">Figure 6-8</a> shows the output of this sketch in the Serial Monitor.</p><div class="figure"><a id="listing_6-3_in_action"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00117"/><img src="httpatomoreillycomsourcenostarchimages1629996.png.jpg" alt="Listing 6-3 in action"/></div></div><div class="figure-title">Figure 6-8. Listing 6-3 in action</div></div><p>Now that you know how to work with binary numbers, shift registers, and arrays, it’s time you put that knowledge to work. In the next section, we’ll wire up some digital number displays.</p></div></div><div class="sect1" title="Seven-Segment LED Displays"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="seven-segment_led_displays">Seven-Segment LED Displays</h2></div></div></div><p>LEDs are fun, but there are limits to the kinds of data that can be displayed with individual lights. In this section we’ll begin working with numeric digits in the form of seven-segment LED displays, as shown in <a class="xref" href="ch06.html#seven-segment_display_modules" title="Figure 6-9. Seven-segment display modules">Figure 6-9</a>.</p><div class="figure"><a id="seven-segment_display_modules"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00118"/><img src="httpatomoreillycomsourcenostarchimages1629998.png.jpg" alt="Seven-segment display modules"/></div></div><div class="figure-title">Figure 6-9. Seven-segment display modules</div></div><p><a id="iddle1027" class="indexterm"/><a id="iddle1028" class="indexterm"/><a id="iddle1332" class="indexterm"/><a id="iddle1333" class="indexterm"/>These displays are perfect for displaying numbers, and that’s why you’ll find them used in digital alarm clocks, speedometers, and other numeric displays. Each module in a seven-segment LED display consists of eight LEDs. The modules are also available in different colors. To reduce the number of pins used by the display, all of the anodes or cathodes of the LEDs are connected together and are called <span class="emphasis"><em>common-anode</em></span> or <span class="emphasis"><em>common-cathode,</em></span> respectively. Our projects will use common-cathode modules.</p><p>The display’s LEDs are labeled <span class="emphasis"><em>A</em></span> to <span class="emphasis"><em>G</em></span> and <span class="emphasis"><em>DP</em></span> (for the decimal point). There is an anode pin for each LED segment, and the cathodes are connected to one common cathode pin. The layout of seven-segment LED displays is always described as shown in <a class="xref" href="ch06.html#led_map_for_a_typical_seven-segment_disp" title="Figure 6-10. LED map for a typical seven-segment display module">Figure 6-10</a>, with LED segment A at the top, B to its right, and so on. So, for example, if you wanted to display the number <span class="emphasis"><em>7</em></span>, then you would apply current to segments A, B, and C.</p><p>The pins on each LED display module can vary, depending on the manufacturer, but they always follow the basic pattern shown in <a class="xref" href="ch06.html#led_map_for_a_typical_seven-segment_disp" title="Figure 6-10. LED map for a typical seven-segment display module">Figure 6-10</a>. When you use one of these modules, always get the data sheet for the module from the retailer to help save you time determining which pins are which.</p><p>We’ll use the schematic symbol shown in <a class="xref" href="ch06.html#schematic_symbol_for_a_seven-segment_dis" title="Figure 6-11. Schematic symbol for a seven-segment display module">Figure 6-11</a> for our seven-segment LED display modules.</p><div class="figure"><a id="led_map_for_a_typical_seven-segment_disp"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00119"/><img src="httpatomoreillycomsourcenostarchimages1630000.png.jpg" alt="LED map for a typical seven-segment display module"/></div></div><div class="figure-title">Figure 6-10. LED map for a typical seven-segment display module</div></div><div class="figure"><a id="schematic_symbol_for_a_seven-segment_dis"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00120"/><img src="httpatomoreillycomsourcenostarchimages1630002.png.jpg" alt="Schematic symbol for a seven-segment display module"/></div></div><div class="figure-title">Figure 6-11. Schematic symbol for a seven-segment display module</div></div><div class="sect2" title="Controlling the LED"><div class="titlepage"><div><div><h3 class="title" id="controlling_the_led">Controlling the LED</h3></div></div></div><p>We’ll control the LED display using the method discussed in Project 17, by connecting pins A through DP to the shift register outputs Q0 to Q7. Use the matrix shown in <a class="xref" href="ch06.html#display_segment_matrix" title="Table 6-2. Display Segment Matrix">Table 6-2</a> as a guide to help you determine which segments to turn on and off to display a particular number or letter.</p><p>The top row in the matrix is the shift register output pin that controls the segments on the second row. Each row below this shows the digit that can be displayed with the corresponding binary and decimal value to send to the shift register.</p><div class="table"><a id="display_segment_matrix"/><div class="table-title">Table 6-2. Display Segment Matrix</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/><col class="c5"/><col class="c6"/><col class="c7"/><col class="c8"/><col class="c9"/><col class="c10"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>SR</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q3</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q4</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q5</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q6</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Q7</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Segment</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>B</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>C</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>E</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>F</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>G</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>DP</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Decimal</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>0</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>252</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>1</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>96</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>2</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>218</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>3</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>242</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>4</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>102</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>5</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>182</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>6</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>190</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>7</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>224</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>8</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>254</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>9</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>246</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>A</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>238</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>B</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>62</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>C</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>156</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>D</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>122</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>E</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>158</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><span class="strong"><strong>F</strong></span></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; "><p>142</p></td></tr></tbody></table></div></div><p>For example, to display the digit <span class="emphasis"><em>7</em></span> as shown in <a class="xref" href="ch06.html#displaying_the_digit_7" title="Figure 6-12. Displaying the digit 7">Figure 6-12</a>, we need to turn on LED segments A, B, and C, which correspond to the shift register outputs Q0, Q1, and Q2. Therefore, we will send the byte <code class="literal">B1110000</code> into the shift register (with <code class="literal">shiftOut</code> set to <code class="literal">LSBFIRST</code>) to turn on the first three outputs that match the desired LEDs on the module.</p><div class="figure"><a id="displaying_the_digit_7"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00121"/><img src="httpatomoreillycomsourcenostarchimages1630004.png.jpg" alt="Displaying the digit 7"/></div></div><div class="figure-title">Figure 6-12. Displaying the digit 7</div></div><p>In the next example, we’ll create a circuit that displays, in turn, the digits 0 through 9 and then the letters A through F. The cycle repeats with the decimal-point LED turned on.</p></div></div><div class="sect1" title="Project #18: Creating a Single-Digit Display"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash18_creating_a_single-digit_d">Project #18: Creating a Single-Digit Display</h2></div></div></div><p>In this project we’ll assemble a circuit to use a single-digit display.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00049">The Hardware</h3></div></div></div><p>The following hardware is required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One 74HC595 shift register IC</p></li><li class="listitem"><p>One common-cathode seven-segment LED display</p></li><li class="listitem"><p>Eight 560 Ω resistors (R1 to R8)</p></li><li class="listitem"><p>One large breadboard</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div></div><div class="sect2" title="The Schematic"><div class="titlepage"><div><div><h3 class="title" id="schematic-id00050">The Schematic</h3></div></div></div><p>The schematic is shown in <a class="xref" href="ch06.html#schematic_for_project_18" title="Figure 6-13. Schematic for Project 18">Figure 6-13</a>.</p><div class="figure"><a id="schematic_for_project_18"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00122"/><img src="httpatomoreillycomsourcenostarchimages1630006.png.jpg" alt="Schematic for Project 18"/></div></div><div class="figure-title">Figure 6-13. Schematic for Project 18</div></div><p>When wiring the LED module to the shift register, LED pins A through G connect to pins Q0 through Q6, respectively, and DP connects to Q7.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00051">The Sketch</h3></div></div></div><p>In the sketch for Project 18, we store the decimal values (see <a class="xref" href="ch06.html#display_segment_matrix" title="Table 6-2. Display Segment Matrix">Table 6-2</a>) in the <code class="literal">int digits[]</code> array. In the <code class="literal">void loop</code>, we send these values to the shift register in sequential order at <span class="gray-background">1</span> and then repeat the process with the decimal point on by adding 1 to the value sent to the shift register at <span class="gray-background">2</span>:</p><a id="pro_id00065"/><pre class="programlisting">  // Project 18 - Creating a Single-Digit Display
  #define DATA  6                       // connect to pin 14 on the 74HC595
  #define LATCH 8                       // connect to pin 12 on the 74HC595
  #define CLOCK 10                      // connect to pin 11 on the 74HC595

  // set up the array with the segments for 0 to 9, A to F (from Table 6-2)
  int digits[] = {252, 96, 218, 242, 102, 182, 190, 224, 254, 246, 238, 62, 156,
  122, 158, 142};

  void setup()
  {
    pinMode(LATCH, OUTPUT);
    pinMode(CLOCK, OUTPUT);
    pinMode(DATA, OUTPUT);
  }

  void loop()
  {
    int i;
    for ( i = 0 ; i &lt; 16 ; i++ )   // display digits 0-9, A-F
    {
      digitalWrite(LATCH, LOW);
<span class="gray-background">1</span> shiftOut(DATA, CLOCK, LSBFIRST, digits[i]);
      digitalWrite(LATCH, HIGH);
      delay(250);
    }
    for ( i = 0 ; i &lt; 16 ; i++ )   // display digits 0-9, A-F with DP
    {
      digitalWrite(LATCH, LOW);
<span class="gray-background">2</span> shiftOut(DATA, CLOCK, LSBFIRST, digits[i]+1); // +1 is to turn on the DP bit
      digitalWrite(LATCH, HIGH);
      delay(250);
    }
  }</pre><p>Seven-segment LCD displays are bright and easy to read. For example, <a class="xref" href="ch06.html#digit_displayed_by_project_18" title="Figure 6-14. Digit displayed by Project 18">Figure 6-14</a> shows the digit 9 with the decimal point displayed as a result of this sketch.</p><div class="figure"><a id="digit_displayed_by_project_18"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00123"/><img src="httpatomoreillycomsourcenostarchimages1630008.png.jpg" alt="Digit displayed by Project 18"/></div></div><div class="figure-title">Figure 6-14. Digit displayed by Project 18</div></div></div><div class="sect2" title="Displaying Double Digits"><div class="titlepage"><div><div><h3 class="title" id="displaying_double_digits">Displaying Double Digits</h3></div></div></div><p>To use more than one shift register to control additional digital outputs, connect pin 9 of the 74HC595 (which receives data from the Arduino) to pin 14 of the second shift register. Once you’ve made this connection, 2 bytes of data will sent: the first to control the second shift register and the second to control the first shift register. Here’s an example:</p><a id="pro_id00066"/><pre class="programlisting">digitalWrite(LATCH, LOW);
shiftOut(DATA, CLOCK, MSBFIRST, 254); // data for second 74HC595
shiftOut(DATA, CLOCK, MSBFIRST, 254); // data for first 74HC595
digitalWrite(LATCH, HIGH);</pre></div></div><div class="sect1" title="Project #19: Controlling Two Seven-Segment LED Display Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash19_controlling_two_seven-seg">Project #19: Controlling Two Seven-Segment LED Display Modules</h2></div></div></div><p>This project will show you how to control two, seven-segment LED display modules so that you can display two-digit numbers.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00052">The Hardware</h3></div></div></div><p>The following hardware is required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Two 74HC595 shift register ICs</p></li><li class="listitem"><p>Two common-cathode seven-segment LED displays</p></li><li class="listitem"><p>Sixteen 560 Ω resistors (R1 to 16)</p></li><li class="listitem"><p>One large breadboard</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div></div><div class="sect2" title="The Schematic"><div class="titlepage"><div><div><h3 class="title" id="schematic-id00053">The Schematic</h3></div></div></div><p><a class="xref" href="ch06.html#schematic_for_project_19" title="Figure 6-15. Schematic for Project 19">Figure 6-15</a> shows the schematic for two display modules.</p><div class="figure"><a id="schematic_for_project_19"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00124"/><img src="httpatomoreillycomsourcenostarchimages1630010.png.jpg" alt="Schematic for Project 19"/></div></div><div class="figure-title">Figure 6-15. Schematic for Project 19</div></div><p>Note that the shift registers’ data and clock pins are connected to each other and then to the Arduino. The data line from Arduino digital pin 6 runs to shift register 1, and then a link from pin 9 of shift register 1 runs to pin 14 of shift register 2.</p><p>To display a number between 0 and 99, we’ll need a more complicated sketch. If a number is less than 10, then we can just send the number followed by a 0, as the right digit displays the number and the left digit displays 0. However, if the number is greater than 10, then we need to determine each of the number’s two digits and send each to the shift registers separately. To make this process easier, we’ll use the math function modulo.</p></div><div class="sect2" title="Modulo"><div class="titlepage"><div><div><h3 class="title" id="modulo">Modulo</h3></div></div></div><p><a id="iddle1018" class="indexterm"/><a id="iddle1358" class="indexterm"/><span class="emphasis"><em>Modulo</em></span> is a function that returns the remainder of a division operation. For example, 10 modulo (or <span class="emphasis"><em>mod</em></span>) 7 equals 3—in other words, the remainder of 10 divided by 7 equals 3. We use the percent sign (<code class="literal">%</code>) to represent modulo. The following example uses modulo in a sketch:</p><a id="pro_id00067"/><pre class="programlisting">int a = 8;
int b = 3;
c = a % b;</pre><p>In this example, the value of <code class="literal">c</code> will be 2. So to determine a two-digit number’s right-hand digit, we use the modulo function<span class="emphasis"><em>,</em></span> which returns the remainder when dividing the two numbers.</p><p>To automate displaying a single- or double-digit number, we’ll create the function <code class="literal">displayNumber()</code> for our sketch. We use modulo as part of this function to separate the digits of a two-digit number. For example, to display the number <span class="emphasis"><em>23</em></span>, we first isolate the left-hand digit by dividing 23 by 10, which equals 2 (and a fraction that we can ignore). To isolate the right-hand digit, we perform 23 modulo 10, which equals 3.</p><a id="pro_id00068"/><pre class="programlisting">  // Project 19 - Controlling Two Seven-Segment LED Display Modules
  // set up the array with the segments for 0 to 9, A to F (from Table 6-2)
  int digits[] = {252, 96, 218, 242, 102, 182, 190, 224, 254, 246, 238, 62, 156,
  122, 158, 142};

  void displayNumber(int n)
  {
    int left, right=0;
<span class="gray-background">1</span>   if (n &lt; 10)
    {
      digitalWrite(LATCH, LOW);
      shiftOut(DATA, CLOCK, LSBFIRST, digits[n]);
      shiftOut(DATA, CLOCK, LSBFIRST, 0);
      digitalWrite(LATCH, HIGH);
    }
    else if (n &gt;= 10)
    {
<span class="gray-background">2</span>     right = n % 10; // remainder of dividing the number to display by 10
      left = n / 10;  // quotient of dividing the number to display by 10
      digitalWrite(LATCH, LOW);
      shiftOut(DATA, CLOCK, LSBFIRST, digits[right]);
      shiftOut(DATA, CLOCK, LSBFIRST, digits[left]);
      digitalWrite(LATCH, HIGH);
    }
  }
<span class="gray-background">3</span> void loop()
  {
    int i;
    for ( i = 0 ; i &lt; 100 ; i++ )

    {
      displayNumber(i);
      delay(100);
    }
  }</pre><p><a id="iddle1513" class="indexterm"/>At <span class="gray-background">1</span>, the function checks to see if the number to be displayed is less than 10. If so, it sends the data for the number and a blank digit to the shift registers. However, if the number is greater than 10, then the function uses modulo and division at <span class="gray-background">2</span> to separate the digits and then sends them to the shift registers separately. Finally, in <code class="literal">void loop()</code> at <span class="gray-background">3</span> we set up and call the function to display the numbers from 0 to 99.</p></div></div><div class="sect1" title="Project #20: Creating a Digital Thermometer"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash20_creating_a_digital_thermo">Project #20: Creating a Digital Thermometer</h2></div></div></div><p>In this project we’ll add the TMP36 temperature sensor we created in <a class="xref" href="ch04.html" title="Chapter 4. Building Blocks">Chapter 4</a> to the double-digit circuit constructed for Project 19 to create a digital thermometer. The algorithm is simple: we read the voltage returned from the TMP36 (using the method from Project 12) and convert the reading to degrees Celsius.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00054">The Hardware</h3></div></div></div><p>The following hardware is required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The double-digit circuit from Project 19</p></li><li class="listitem"><p>One TMP36 temperature sensor</p></li></ul></div><p>Connect the center output lead of the TMP36 to analog pin 5, the left lead to 5 V, and the right lead to GND, and you’re ready to measure.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00055">The Sketch</h3></div></div></div><p>Here is the sketch:</p><a id="pro_id00069"/><pre class="programlisting">// Project 20 - Creating a Digital Thermometer
#define DATA  6             // connect to pin 14 on the 74HC595
#define LATCH 8             // connect to pin 12 on the 74HC595
#define CLOCK 10            // connect to pin 11 on the 74HC595

int temp = 0;
float voltage = 0;
float celsius = 0;
float sensor = 0;
int digits[]={
  252, 96, 218, 242, 102, 182, 190, 224, 254, 246, 238, 62, 156, 122, 158, 142};

void setup()
{
  pinMode(LATCH, OUTPUT);
  pinMode(CLOCK, OUTPUT);
  pinMode(DATA, OUTPUT);
}

void displayNumber(int n)
{
  int left, right = 0;
  if (n &lt; 10)
  {
    digitalWrite(LATCH, LOW);
    shiftOut(DATA, CLOCK, LSBFIRST, digits[n]);
    shiftOut(DATA, CLOCK, LSBFIRST, digits[0]);
    digitalWrite(LATCH, HIGH);
  }
  if (n &gt;= 10)
  {
    right = n % 10;
    left = n / 10;
    digitalWrite(LATCH, LOW);
    shiftOut(DATA, CLOCK, LSBFIRST, digits[right]);
    shiftOut(DATA, CLOCK, LSBFIRST, digits[left]);
    digitalWrite(LATCH, HIGH);

  }
}

void loop()
{
  sensor = analogRead(5);
  voltage = (sensor * 5000) / 1024; // convert raw sensor value to millivolts
  voltage = voltage - 500;          // remove voltage offset
  celsius = voltage / 10;           // convert millivolts to Celsius
  temp = int(celsius); // change the floating point temperature to an int
  displayNumber(temp);
  delay(500);
}</pre><p><a id="iddle1326" class="indexterm"/>The sketch is simple and borrows code from previous projects: <code class="literal">displayNumber()</code> from Project 19 and the temperature calculations from Project 12. The <code class="literal">delay(500);</code> function in the second-to-last line of the sketch keeps the display from changing too quickly when the temperature fluctuates.</p></div></div><div class="sect1" title="LED Matrix Display Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="led_matrix_display_modules">LED Matrix Display Modules</h2></div></div></div><p>If you enjoyed experimenting with blinking LEDs, then you’re going to love LED matrix modules. An <span class="emphasis"><em>LED matrix module</em></span> consists of several rows and columns of LEDs that you can control individually or in groups. The example that we’ll use (shown in <a class="xref" href="ch06.html#led_matrix" title="Figure 6-16. LED matrix">Figure 6-16</a>) has eight rows and eight columns of red LEDs for a total of 64 LEDs.</p><div class="figure"><a id="led_matrix"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00125"/><img src="httpatomoreillycomsourcenostarchimages1630012.png.jpg" alt="LED matrix"/></div></div><div class="figure-title">Figure 6-16. LED matrix</div></div><p><a id="iddle1328" class="indexterm"/>In this project we’ll build one circuit, and then we’ll use various sketches to create different effects.</p><div class="sect2" title="The LED Matrix Schematic"><div class="titlepage"><div><div><h3 class="title" id="led_matrix_schematic">The LED Matrix Schematic</h3></div></div></div><p>The schematic symbol for the matrix looks a bit complex, as shown in <a class="xref" href="ch06.html#led_matrix_schematic_symbol" title="Figure 6-17. LED matrix schematic symbol">Figure 6-17</a>.</p><div class="figure"><a id="led_matrix_schematic_symbol"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00126"/><img src="httpatomoreillycomsourcenostarchimages1630014.png.jpg" alt="LED matrix schematic symbol"/></div></div><div class="figure-title">Figure 6-17. LED matrix schematic symbol</div></div><p>Notice that the numbering of the rows and columns of LEDs does not match the order of the pins beneath the matrix; see the circled pin numbers in <a class="xref" href="ch06.html#led_matrix_schematic_symbol" title="Figure 6-17. LED matrix schematic symbol">Figure 6-17</a>. On the underside of our matrix, pin 1 is indicated at the bottom right. For example, in <a class="xref" href="ch06.html#pins_on_the_led_matrix_with_a_tiny_1_pri" title="Figure 6-18. Pins on the LED matrix with a tiny 1 printed below the bottom-right pin">Figure 6-18</a>, you can see a tiny <span class="emphasis"><em>1</em></span> printed below the pin.</p><div class="figure"><a id="pins_on_the_led_matrix_with_a_tiny_1_pri"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00127"/><img src="httpatomoreillycomsourcenostarchimages1630016.png.jpg" alt="Pins on the LED matrix with a tiny 1 printed below the bottom-right pin"/></div></div><div class="figure-title">Figure 6-18. Pins on the LED matrix with a tiny 1 printed below the bottom-right pin</div></div><p>The pins on the LED matrix are numbered clockwise, with pin 8 at the bottom left and pin 16 at the top right. We’ll control the matrix with two 74HC595 shift registers in a way that’s similar to the method used in Project 19.</p><p><a class="xref" href="ch06.html#matrix_circuit_schematic" title="Figure 6-19. Matrix circuit schematic">Figure 6-19</a> shows the schematic for our project. Resistors R1 through R8 are 560 ohms each. One shift register controls the rows of LEDs, and the other controls the columns. The LED matrix (not shown here) is connected to the outputs at the bottom of this schematic with the pin connections listed in <a class="xref" href="ch06.html#matrix_to_74hc595_link_table" title="Table 6-3. Matrix to 74HC595 link table">Table 6-3</a>.</p><div class="table"><a id="matrix_to_74hc595_link_table"/><div class="table-title">Table 6-3. Matrix to 74HC595 link table</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Row SR Pin</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Matrix Pin</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Column SR Pin</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Matrix Pin</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>15</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>9</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>15</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>13</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>14</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>3</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>8</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>4</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>12</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>10</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>6</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>11</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>15</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; "><p>16</p></td></tr></tbody></table></div></div></div><div class="sect2" title="Making the Connections"><div class="titlepage"><div><div><h3 class="title" id="making_the_connections">Making the Connections</h3></div></div></div><p>Make the connections between the shift registers and the LED matrix (don’t forget the resistors between the output pins of the shift register, which controls the matrix rows, and the matrix row pins), as shown in <a class="xref" href="ch06.html#matrix_to_74hc595_link_table" title="Table 6-3. Matrix to 74HC595 link table">Table 6-3</a>.</p><div class="figure"><a id="matrix_circuit_schematic"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00128"/><img src="httpatomoreillycomsourcenostarchimages1630018.png.jpg" alt="Matrix circuit schematic"/></div></div><div class="figure-title">Figure 6-19. Matrix circuit schematic</div></div><p><a id="iddle1001" class="indexterm"/><a id="iddle1020" class="indexterm"/><a id="iddle1090" class="indexterm"/><a id="iddle1091" class="indexterm"/><a id="iddle1094" class="indexterm"/><a id="iddle1375" class="indexterm"/>Now to get the matrix working. The shift register marked “rows” in <a class="xref" href="ch06.html#matrix_circuit_schematic" title="Figure 6-19. Matrix circuit schematic">Figure 6-19</a> allows current to flow into each row of the matrix, and the “columns” shift register allows current to flow from each of the columns of the matrix to GND. We’ll use a simple sketch to test the setup in the next project. To turn on an LED, we need to control the matching row and column pins of the shift registers.</p></div></div><div class="sect1" title="Bitwise Arithmetic"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="bitwise_arithmetic">Bitwise Arithmetic</h2></div></div></div><p>We can use <span class="emphasis"><em>bitwise arithmetic</em></span> to manipulate integer and byte variables using their binary representations. The value in using bitwise arithmetic, rather than base-10 arithmetic, is that bitwise can help increase the speed of controlling digital input and output pins and can compare numbers in binary form.</p><p>There are six <span class="emphasis"><em>bitwise operators</em></span>: AND, OR, XOR, NOT, bitshift left, and bitshift right. Each is discussed in the following sections. (Although these examples use binary numbers, the same operations could be performed using integers and bytes.)</p><div class="sect2" title="The Bitwise AND Operator"><div class="titlepage"><div><div><h3 class="title" id="bitwise_and_operator">The Bitwise AND Operator</h3></div></div></div><p>The AND operator (<code class="literal">&amp;</code>) is used to compare two binary numbers bit by bit. If the bits in the same column of both numbers are 1, then the resulting value’s bit is set to 1; if the bits are not 1, then the result is set to 0. Consider, for example, these 3-byte variables:</p><a id="pro_id00070"/><pre class="programlisting">byte a = B00110011;
byte b = B01010001;
byte c = 0;</pre><p>The result of the comparison</p><a id="pro_id00071"/><pre class="programlisting">c = a &amp; b;</pre><p>will be 00010001. Expanding this result in a text-comment diagram can show this in more detail:</p><a id="pro_id00072"/><pre class="programlisting">byte a = B00110011;
//        ||||||||
byte b = B01010001;
//        ||||||||
//        00010001  c = a &amp; b; // c is equal to a 'AND'ed with b</pre></div><div class="sect2" title="The Bitwise OR Operator"><div class="titlepage"><div><div><h3 class="title" id="bitwise_or_operator">The Bitwise OR Operator</h3></div></div></div><p>The OR operator (<code class="literal">|</code>) compares two binary numbers, but instead of returning a 1 if both numbers in a column are 1, it returns a 1 if <span class="emphasis"><em>either</em></span> value in the column is 1. If both numbers in a column are 0, then 0 is returned.</p><p><a id="iddle1092" class="indexterm"/><a id="iddle1093" class="indexterm"/><a id="iddle1095" class="indexterm"/><a id="iddle1369" class="indexterm"/><a id="iddle1580" class="indexterm"/>Using the same demonstration bytes as before,</p><a id="pro_id00073"/><pre class="programlisting">byte a = B00110011;
byte b = B01010001;
byte c = 0;</pre><p>the result of the comparison</p><a id="pro_id00074"/><pre class="programlisting">c = a | b;</pre><p>will be 01110011.</p></div><div class="sect2" title="The Bitwise XOR Operator"><div class="titlepage"><div><div><h3 class="title" id="bitwise_xor_operator">The Bitwise XOR Operator</h3></div></div></div><p>The XOR operator (<code class="literal">^</code>) returns a 1 result if the bits are different and a 0 result if they are the same.</p><p>Using our demonstration bytes again,</p><a id="pro_id00075"/><pre class="programlisting">byte a = B00111100;
byte b = B01011010;
byte c = 0;</pre><p>the result of the comparison</p><a id="pro_id00076"/><pre class="programlisting">c = a ^ b;</pre><p>will be 01100110.</p></div><div class="sect2" title="The Bitwise NOT Operator"><div class="titlepage"><div><div><h3 class="title" id="bitwise_not_operator">The Bitwise NOT Operator</h3></div></div></div><p>The NOT operator (<code class="literal">~</code>) simply reverses, or flips, the bits in each column: 0s are changed to 1s, and 1s are changed to 0s. Consider this example: If we store a bitwise NOT of byte <code class="literal">a</code> in byte <code class="literal">b</code> like so,</p><a id="pro_id00077"/><pre class="programlisting">byte a = B00111100;
byte b = 0;
b = ~a;</pre><p>then <code class="literal">b</code> contains 11000011.</p></div><div class="sect2" title="Bitshift Left and Right"><div class="titlepage"><div><div><h3 class="title" id="bitshift_left_and_right">Bitshift Left and Right</h3></div></div></div><p>The bitshift left (<code class="literal">&lt;&lt;</code>) and bitshift right (<code class="literal">&gt;&gt;</code>) operators move bits to the left or right by a certain number of positions. For example, if the contents of <code class="literal">a</code> are shifted left four spaces, like so,</p><a id="pro_id00078"/><pre class="programlisting">byte a = B00100101;
byte b = a &lt;&lt; 4;</pre><p><a id="iddle1329" class="indexterm"/>then the result is the value 01010000 for <code class="literal">b</code>. The bits in <code class="literal">a</code> are moved left four spaces, and the empty spaces are filled with 0s.</p><p>If we shift in the other direction, like so,</p><a id="pro_id00079"/><pre class="programlisting">byte a = B11110001;
byte b = a &gt;&gt; 4;</pre><p>then the value for <code class="literal">b</code> will be 00001111.</p></div></div><div class="sect1" title="Project #21: Creating an LED Matrix"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash21_creating_an_led_matrix">Project #21: Creating an LED Matrix</h2></div></div></div><p>The purpose of this project is to demonstrate the use of the LED matrix; we’ll turn on every second column and row in the matrix, as shown in <a class="xref" href="ch06.html#checkerboard_matrix_template" title="Figure 6-20. Checkerboard matrix template">Figure 6-20</a>.</p><div class="figure"><a id="checkerboard_matrix_template"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00129"/><img src="httpatomoreillycomsourcenostarchimages1630020.png.jpg" alt="Checkerboard matrix template"/></div></div><div class="figure-title">Figure 6-20. Checkerboard matrix template</div></div><p>To create this display pattern, we’ll send <code class="literal">B10101010</code> to the rows shift register and <code class="literal">~B10101010</code> to the columns shift register. The 1s and 0s in each byte match the rows and columns of the matrix.</p><div class="note" title="Note"><h3 class="title"><a id="ch06note02"/>Note</h3><p><span class="emphasis"><em>Note the use of the bitwise NOT (<code class="literal">~</code>) on the columns byte. A columns shift register bit needs to be 0 to turn on an LED from the column connections. However, a rows shift register bit needs to be 1 to turn on the LED from the rows connections. Therefore, we use the bitwise arithmetic <code class="literal">~</code> to invert the byte of data being sent to the second shift register that drives the columns.</em></span></p></div><p>To create the effect shown in <a class="xref" href="ch06.html#checkerboard_matrix_template" title="Figure 6-20. Checkerboard matrix template">Figure 6-20</a>, use the following sketch:</p><a id="pro_id00080"/><pre class="programlisting">// Project 21 – Creating an LED Matrix
#define DATA  6      // connect to pin 14 on the 74HC595
#define LATCH 8      // connect to pin 12 on the 74HC595
#define CLOCK 10     // connect to pin 11 on the 74HC595

void setup()
{
  pinMode(LATCH, OUTPUT);
  pinMode(CLOCK, OUTPUT);
  pinMode(DATA, OUTPUT);
}

void loop()
{
  digitalWrite(LATCH, LOW);
  shiftOut(DATA, CLOCK, MSBFIRST, ~B10101010); // columns
  shiftOut(DATA, CLOCK, MSBFIRST,  B10101010); // rows
  digitalWrite(LATCH, HIGH);
  do {} while (1); // do nothing
}</pre><p>The result is shown in <a class="xref" href="ch06.html#result_of_project_21" title="Figure 6-21. Result of Project 21">Figure 6-21</a>. We have turned on every other LED inside the matrix to form a checkerboard pattern.</p><div class="figure"><a id="result_of_project_21"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00130"/><img src="httpatomoreillycomsourcenostarchimages1630022.png.jpg" alt="Result of Project 21"/></div></div><div class="figure-title">Figure 6-21. Result of Project 21</div></div></div><div class="sect1" title="Project #22: Creating Images on an LED Matrix"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash22_creating_images_on_an_led">Project #22: Creating Images on an LED Matrix</h2></div></div></div><p>To display an image or pattern on the LED matrix, we need a function that turns on only one LED at a time. However, to display an image, we need to turn on and off the LEDs that represent the image very quickly in order to create <span class="emphasis"><em>persistence of vision (POV)</em></span> effects. Persistence of vision produces an image that remains in our eye for a fraction of a second after the image is gone. We can harness this effect to create custom images by “scanning” the matrix to display one row of LEDs at a time, very quickly. This technique can be useful for creating animation, for displaying data, and for creating various other artistic effects.</p><p>We will demonstrate controlling individual LEDs in the next two projects. In the following sketch, the function <code class="literal">void setLED()</code> accepts a row and column number and the duration to keep the LED turned on. Then it randomly turns on LEDs one at a time.</p><a id="pro_id00081"/><pre class="programlisting">  // Project 22 - Creating Images on an LED Matrix
  #define DATA  6        // connect to pin 14 on the 74HC595
  #define LATCH 8        // connect to pin 12 on the 74HC595
  #define CLOCK 10       // connect to pin 11 on the 74HC595

  void setup()
  {
    pinMode(LATCH, OUTPUT);
    pinMode(CLOCK, OUTPUT);
    pinMode(DATA, OUTPUT);
    randomSeed(analogRead(0));
  }

<span class="gray-background">1</span> int binary[] = {1, 2, 4, 8, 16, 32, 64, 128};
  int r, c = 0;

  void setLED(int row, int column, int del)
  {
    digitalWrite(LATCH, LOW);
    shiftOut(DATA, CLOCK, MSBFIRST, ~binary[column]);    // columns
    shiftOut(DATA, CLOCK, MSBFIRST,  binary[row]);       // rows
    digitalWrite(LATCH, HIGH);
    delay(del);
  }

  void loop()
  {
    r = random(8);
    c = random(8);
    setLED(r, c, 1);  // set a random row and column on for 1 millisecond
  }</pre><p>Instead of sending binary numbers directly to the <code class="literal">shiftOut()</code> functions to control which lights are turned on, we use a lookup table in the form of an array, <code class="literal">int binary[]</code>, at <span class="gray-background">1</span>. This lookup table contains the decimal equivalent for each bit of the byte sent to the shift register. For example, to turn on the LED at row 4, column 4, we send <code class="literal">binary[3]</code> (which is 8, or <code class="literal">B00001000</code>) to both shift registers (with the addition of <code class="literal">~</code> for the column). This is a convenient way of converting desired row or column numbers into a form the shift register can use; you don’t need to think in binary, just the row or column you need to turn on.</p><p>By running Project 22 with a delay of 1 millisecond, the LEDs turn on and off so fast that the eye perceives that more than one LED is lit at a time; this demonstrates the concept of POV: It creates the illusion that more than one LED is lit at once, when in fact only one LED is lit at once. An example of this is shown in <a class="xref" href="ch06.html#project_22_at_work" title="Figure 6-22. Project 22 at work">Figure 6-22</a>.</p><div class="figure"><a id="project_22_at_work"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00131"/><img src="httpatomoreillycomsourcenostarchimages1630024.png.jpg" alt="Project 22 at work"/></div></div><div class="figure-title">Figure 6-22. Project 22 at work</div></div></div><div class="sect1" title="Project #23: Displaying an Image on an LED Matrix"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash23_displaying_an_image_on_an">Project #23: Displaying an Image on an LED Matrix</h2></div></div></div><p>In this project we’ll display the image on the matrix shown in <a class="xref" href="ch06.html#layout_for_our_pov_display_example" title="Figure 6-23. Layout for our POV display example">Figure 6-23</a>.</p><div class="figure"><a id="layout_for_our_pov_display_example"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00132"/><img src="httpatomoreillycomsourcenostarchimages1630026.png.jpg" alt="Layout for our POV display example"/></div></div><div class="figure-title">Figure 6-23. Layout for our POV display example</div></div><p>We can define each row as a binary number and place these numbers in an array:</p><a id="pro_id00082"/><pre class="programlisting">byte smile[] = {B00000000,
                B00000110,
                B01000110,
                B00000000,
                B00011000,
                B00000000,
                B11000011,
                B01111110};</pre><p>Notice how the 1s in the array resemble the lit LEDs in the layout in <a class="xref" href="ch06.html#layout_for_our_pov_display_example" title="Figure 6-23. Layout for our POV display example">Figure 6-23</a>. Our use of binary numbers makes developing an image very easy. By experimenting with <code class="literal">MSBFIRST</code> and <code class="literal">LSBFIRST</code> in the <code class="literal">shiftOut()</code> functions, you can flip each row around, as shown next. We use a <code class="literal">for</code> loop at <span class="gray-background">1</span> to display each row in turn:</p><a id="pro_id00083"/><pre class="programlisting">  // Project 23 - Displaying an Image on an LED Matrix
  #define DATA  6     // connect to pin 14 on the 74HC595
  #define LATCH 8     // connect to pin 12 on the 74HC595
  #define CLOCK 10    // connect to pin 11 on the 74HC595

  byte smile[] = {B00000000, B00000110, B01000110, B00000000, B00011000,
  B00000000, B11000011, B01111110};
  int binary[] = {1, 2, 4, 8, 16, 32, 64, 128};

  void setup()
  {
    pinMode(LATCH, OUTPUT);
    pinMode(CLOCK, OUTPUT);
    pinMode(DATA, OUTPUT);
  }

  void loop()
  {
    int i;
<span class="gray-background">1</span>   for ( i = 0 ; i &lt; 8 ; i++ )
    {
      digitalWrite(LATCH, LOW);
      shiftOut(DATA, CLOCK, MSBFIRST, ~smile[a]);  // columns
      shiftOut(DATA, CLOCK, LSBFIRST,  binary[a]); // rows
      digitalWrite(LATCH, HIGH);
      delay(1);
    }
  }</pre><p><a id="iddle1327" class="indexterm"/>The result is a winking smiley face, as shown in <a class="xref" href="ch06.html#result_of_project_23" title="Figure 6-24. Result of Project 23">Figure 6-24</a>.</p><div class="figure"><a id="result_of_project_23"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00133"/><img src="httpatomoreillycomsourcenostarchimages1630028.png.jpg" alt="Result of Project 23"/></div></div><div class="figure-title">Figure 6-24. Result of Project 23</div></div></div><div class="sect1" title="Project #24: Animating an LED Matrix"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash24_animating_an_led_matrix">Project #24: Animating an LED Matrix</h2></div></div></div><p>Using some bitwise arithmetic, we can scroll the image we created in Project 23 off the display in either direction. For example, to have the face move to the right until its gone, we display the image, then shift each bit in the row over by one using <code class="literal">&gt;&gt;</code>, and then display the image again.</p><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00056">The Sketch</h3></div></div></div><p>Here’s the sketch for our animation demonstration:</p><a id="pro_id00084"/><pre class="programlisting">  // Project 24 - Animating an LED Matrix
  #define DATA 6    // connect to pin 14 on the 74HC595
  #define LATCH 8   // connect to pin 12 on the 74HC595
  #define CLOCK 10  // connect to pin 11 on the 74HC595

  byte smile[] = {B00000000, B00000110, B01000110, B00000000, B00011000,
  B00000000, B11000011, B01111110};
  int binary[] = {1, 2, 4, 8, 16, 32, 64, 128};

  void setup()
  {
    pinMode(LATCH, OUTPUT);
    pinMode(CLOCK, OUTPUT);
    pinMode(DATA, OUTPUT);
  }

  void loop()
  {
     int a, hold, shift;
<span class="gray-background">1</span>    for ( shift = 0 ; shift &lt; 9 ; shift++ )
    {
<span class="gray-background">2</span>     for ( hold = 0 ; hold &lt; 25 ; hold++ )
      {
        for ( a = 0 ; a &lt; 8 ; a++ )
        {
          digitalWrite(LATCH, LOW);
<span class="gray-background">3</span>         shiftOut(DATA, CLOCK, MSBFIRST, ~smile[a]&gt;&gt;shift); // columns
          shiftOut(DATA, CLOCK, LSBFIRST,  binary[a]);       // rows
          digitalWrite(LATCH, HIGH);
          delay(1);
        }
      }
    }
  }</pre><p>The sketch holds the image on the matrix for 25 display cycles using a <code class="literal">for</code> loop at <span class="gray-background">2</span>. The variable <code class="literal">shift</code> is the amount by which each byte will shift to the right. After each loop has completed, the variable <code class="literal">shift</code> is increased by 1 as shown at <span class="gray-background">1</span>. Next, the display cycles repeat, and the image moves to the right by one LED column. By changing <code class="literal">MSBFIRST</code> to <code class="literal">LSBFIRST</code> in the third for loop at <span class="gray-background">3</span>, we can change the direction that the face scrolls.</p></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00057">Looking Ahead</h2></div></div></div><p>In this chapter you have learned a lot of fundamental skills that will be used over and over in your own projects. LED displays are relatively hardy, so enjoy experimenting with them and making various display effects. However, there is a limit to what can be displayed, so in the next chapter we make use of much more detailed display methods for text and graphics.</p></div></section></body></html>
