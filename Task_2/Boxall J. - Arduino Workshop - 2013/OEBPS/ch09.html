<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 9. Numeric Keypads</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch08.html" title="Chapter 8. Expanding Your Arduino"/><link rel="next" href="ch10.html" title="Chapter 10. Accepting User Input with Touchscreens"/></head><body><section class="chapter" title="Chapter 9. Numeric Keypads" epub:type="chapter" id="numeric_keypads"><div class="titlepage"><div><div><h2 class="title">Chapter 9. Numeric Keypads</h2></div></div></div><p><a id="iddle1189" class="indexterm"/><a id="iddle1306" class="indexterm"/><a id="iddle1370" class="indexterm"/><a id="iddle1381" class="indexterm"/>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Learn how to connect numeric keypads to your Arduino</p></li><li class="listitem"><p>Read values from the keypad in a sketch</p></li><li class="listitem"><p>Expand on decision systems with the <code class="literal">switch-case</code> function</p></li><li class="listitem"><p>Create a PIN-controlled lock or switch</p></li></ul></div><div class="sect1" title="Using a Numeric Keypad"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="using_a_numeric_keypad">Using a Numeric Keypad</h2></div></div></div><p>As your projects become more involved, you might want to accept numeric input from users when your Arduino isn’t connected to a PC—for example, if you’d like to have the ability to turn something on or off by entering a secret number. One option would be to wire up 10 or more push buttons to various digital input pins (for the numbers 0 through 9); but it’s much easier to use a numeric keypad like the one shown in <a class="xref" href="ch09.html#numeric_keypad" title="Figure 9-1. Numeric keypad">Figure 9-1</a>.</p><div class="figure"><a id="numeric_keypad"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00176"/><img src="httpatomoreillycomsourcenostarchimages1630114.png.jpg" alt="Numeric keypad"/></div></div><div class="figure-title">Figure 9-1. Numeric keypad</div></div><p><a id="iddle1190" class="indexterm"/><a id="iddle1371" class="indexterm"/>One of the benefits of using a keypad is that it uses only 7 pins for 12 active buttons, and with the use of a clever Arduino library, you won’t need to add pull-down resistors for debouncing as we did in <a class="xref" href="ch04.html" title="Chapter 4. Building Blocks">Chapter 4</a>. You can download and then install the <span class="emphasis"><em>Keypad</em></span> library from <span class="emphasis"><em><a class="ulink" href="http://arduino.cc/playground/uploads/Code/Keypad.zip" target="_top">http://arduino.cc/playground/uploads/Code/Keypad.zip</a></em></span>.</p><div class="sect2" title="Wiring a Keypad"><div class="titlepage"><div><div><h3 class="title" id="wiring_a_keypad">Wiring a Keypad</h3></div></div></div><p>Physically wiring the keypad to the Arduino is easy. On the back of the keypad are seven pins, as shown in <a class="xref" href="ch09.html#keypad_pins" title="Figure 9-2. Keypad pins">Figure 9-2</a>.</p><div class="figure"><a id="keypad_pins"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00177"/><img src="httpatomoreillycomsourcenostarchimages1630116.png.jpg" alt="Keypad pins"/></div></div><div class="figure-title">Figure 9-2. Keypad pins</div></div><p>The pins are numbered 1 to 7, from left to right. For all of the keypad projects in this book, you’ll make the connections shown in <a class="xref" href="ch09.html#keypad-to-arduino_connections" title="Table 9-1. Keypad-to-Arduino Connections">Table 9-1</a>.</p><div class="table"><a id="keypad-to-arduino_connections"/><div class="table-title">Table 9-1. Keypad-to-Arduino Connections</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Keypad Pin Number</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Arduino Pin</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 5</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 4</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 3</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 2</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 8</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Digital 7</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; "><p>Digital 6</p></td></tr></tbody></table></div></div></div><div class="sect2" title="Programming for the Keypad"><div class="titlepage"><div><div><h3 class="title" id="programming_for_the_keypad">Programming for the Keypad</h3></div></div></div><p>When you write a sketch for the keypad, you must include certain lines of code to enable the keypad, as identified in the following example sketch. The required code starts at <span class="gray-background">1</span> and ends at <span class="gray-background">5</span>.</p><p>Before moving forward, test the keypad by entering and uploading <a class="xref" href="ch09.html#numeric_keypad_demonstration_sketch" title="Example 9-1. Numeric keypad demonstration sketch">Example 9-1</a>:</p><div class="example"><a id="numeric_keypad_demonstration_sketch"/><div class="example-title">Example 9-1. Numeric keypad demonstration sketch</div><div class="example-contents"><pre class="programlisting">  // Listing 9-1

<span class="gray-background">1</span> // Beginning of necessary code

  #include "Keypad.h"
  const byte ROWS = 4;            // set display to four rows
  const byte COLS = 3;            // set display to three columns
  char keys[ROWS][COLS] =
   {{'1','2','3'},
    {'4','5','6'},
    {'7','8','9'},
<span class="gray-background">2</span>   {'*','0','#'}};
<span class="gray-background">3</span> byte rowPins[ROWS] = {5, 4, 3, 2};
<span class="gray-background">4</span> byte colPins[COLS] = {8, 7, 6};
  Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

<span class="gray-background">5</span> // End of necessary code

  void setup()
  {
    Serial.begin(9600);
  }

  void loop()
  {
    char key = keypad.getKey();
    if (key != NO_KEY)
    {
      Serial.print(key);
    }
  }</pre></div></div><p>At <span class="gray-background">2</span>, we introduce the <code class="literal">char</code> variable type that contains one character, such as a letter, number, or symbol, that can be generated with a computer keyboard. In this case, it contains the keypad’s numbers and symbols. The lines of code at <span class="gray-background">3</span> and <span class="gray-background">4</span> define which pins are used on the Arduino. Using these lines and <a class="xref" href="ch09.html#keypad-to-arduino_connections" title="Table 9-1. Keypad-to-Arduino Connections">Table 9-1</a>, you can change the digital pins used for input if you want.</p></div><div class="sect2" title="Testing the Sketch"><div class="titlepage"><div><div><h3 class="title" id="testing_the_sketch">Testing the Sketch</h3></div></div></div><p>After uploading the sketch, open the Serial Monitor and press some keys on the keypad. The characters for the keys you pressed will be displayed in the Serial Monitor, as shown in <a class="xref" href="ch09.html#results_of_pressing_keys_on_the_keypad" title="Figure 9-3. Results of pressing keys on the keypad">Figure 9-3</a>.</p><div class="figure"><a id="results_of_pressing_keys_on_the_keypad"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00178"/><img src="httpatomoreillycomsourcenostarchimages1630118.png.jpg" alt="Results of pressing keys on the keypad"/></div></div><div class="figure-title">Figure 9-3. Results of pressing keys on the keypad</div></div></div></div><div class="sect1" title="Making Decisions with switch-case"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="making_decisions_with_switch-case">Making Decisions with switch-case</h2></div></div></div><p><a id="iddle1498" class="indexterm"/>When you need to compare two or more variables, you’ll often find it easier to use a <code class="literal">switch</code>-<code class="literal">case</code> statement instead of an <code class="literal">if</code>-<code class="literal">then</code> statement, because <code class="literal">switch</code>-<code class="literal">case</code> statements can make an indefinite number of comparisons and run code when the comparison is found to be true. For example, if we had the integer variable <code class="literal">xx</code> with a possible value of 1, 2, or 3 and we wanted to run certain code based on whether a value was 1, 2, or 3, then we could use code like the following to replace our <code class="literal">if</code>-<code class="literal">then</code> statement:</p><a id="pro_id00119"/><pre class="programlisting">switch(xx)
{
    case 1:
     // do something as the value of xx is 1
    break;              // finish and move on with sketch
    case 2:
    // do something as the value of xx is 2
    break;
    case 3:
    // do something as the value of xx is 3
    break;
    default:
    // do something if xx is not 1, 2 or 3
    // default is optional
}</pre><p>The optional <code class="literal">default:</code> section at the end of this code segment lets you choose to run some code when true comparisons no longer exist in the <code class="literal">switch</code>-<code class="literal">case</code> statement.</p></div><div class="sect1" title="Project #33: Creating a Keypad-Controlled Lock"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash33_creating_a_keypad-control">Project #33: Creating a Keypad-Controlled Lock</h2></div></div></div><p>In this project, we’ll create the beginning part of a keypad-controlled lock. We’ll use the basic setup described in the sketch in <a class="xref" href="ch09.html#numeric_keypad_demonstration_sketch" title="Example 9-1. Numeric keypad demonstration sketch">Example 9-1</a>, but we’ll also include a secret code that will need to be entered on the keypad. The Serial Monitor will tell the user who types a code into the keypad whether the code is correct or not.</p><p><a id="iddle1305" class="indexterm"/>The sketch will call different functions, depending on whether the sixdigit secret code is correct. The secret code is stored in the sketch but is not displayed to the user. To activate and deactivate the lock, the user must press <span class="strong"><strong>*</strong></span> and then the secret number, followed by <span class="strong"><strong>#</strong></span>.</p><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00075">The Sketch</h3></div></div></div><p>Enter and upload this sketch:</p><a id="pro_id00120"/><pre class="programlisting">  // Project 33 - Creating a Keypad-Controlled Lock

  // Beginning of necessary code

  #include "Keypad.h"
  const byte ROWS = 4;                  // set display to four rows
  const byte COLS = 3;                  // set display to three columns
  char keys[ROWS][COLS] =
   {{'1','2','3'},
    {'4','5','6'},
    {'7','8','9'},
    {'*','0','#'}};
  byte rowPins[ROWS] = {5, 4, 3, 2};
  byte colPins[COLS] = {8, 7, 6};
  Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );

  // End of necessary code

<span class="gray-background">1</span> char PIN[6]={'1','2','3','4','5','6'}; // our secret number
  char attempt[6]={0,0,0,0,0,0};
  int z=0;

  void setup()
  {
    Serial.begin(9600);
  }

  void correctPIN()  // do this if the correct PIN is entered
  {
    Serial.println("Correct PIN entered...");
  }

  void incorrectPIN() // do this if an incorrect PIN is entered
  {
    Serial.println("Incorrect PIN entered!");
  }

  void checkPIN()
  {
    int correct=0;
    int i;
<span class="gray-background">2</span>   for ( i = 0; i &lt; 6 ; i++ )
    {

      if (attempt[q]==PIN[q])
      {
        correct++;
      }
    }
    if (correct==6)
    {
<span class="gray-background">3</span>     correctPIN();
    } else
    {
<span class="gray-background">4</span>     incorrectPIN();
    }
    for (int zz=0; zz&lt;6; zz++) // remove previously entered code attempt from
    {
      attempt[zz]=0;
    }
  }

  void readKeypad()
  {
    char key = keypad.getKey();
    if (key != NO_KEY)
    {
<span class="gray-background">5</span>     switch(key)
      {
      case '*':
        z=0;
        break;
      case '#':
        delay(100);  // removes the possibility of switch bounce
        checkPIN();
        break;
      default:
        attempt[z]=key;
        z++;
      }
    }
  }

  void loop()
  {
<span class="gray-background">6</span>   readKeypad();
  }</pre></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works">How It Works</h3></div></div></div><p><a id="iddle1100" class="indexterm"/>After the usual setup routines (as described in <a class="xref" href="ch09.html#numeric_keypad_demonstration_sketch" title="Example 9-1. Numeric keypad demonstration sketch">Example 9-1</a>), the sketch continually “listens” to the keypad by running the function <code class="literal">readKeypad()</code> at <span class="gray-background">6</span>. After a key is pressed, the value of the key is examined using a <code class="literal">switch-case</code> statement at <span class="gray-background">5</span>. The values of the keys pressed on the keypad are stored in the array <code class="literal">attempt[]</code>, and when the user presses #, the function <code class="literal">checkPin()</code> is called.</p><p>At <span class="gray-background">2</span>, the values of keys pressed are compared against the PIN stored in the array <code class="literal">PIN[]</code> at <span class="gray-background">1</span>, which holds the secret number. If the correct sequence is entered, the function <code class="literal">correctPin()</code> at <span class="gray-background">3</span> is called, where you can add your own code to execute; but if the incorrect sequence is entered, the function <code class="literal">incorrectPin()</code> is called at <span class="gray-background">4</span>. Finally, once the user’s entry has been checked, it is removed from memory and the code is ready for the next test.</p></div><div class="sect2" title="Testing the Sketch"><div class="titlepage"><div><div><h3 class="title" id="testing_the_sketch-id00076">Testing the Sketch</h3></div></div></div><p>After you’ve uploaded the sketch to the Arduino, open the Serial Monitor window, press the asterisk key (*) on the numeric keypad, type the secret number, and then press the pound sign key (#) when you’ve finished. Try entering both correct and incorrect numbers. Your results should be similar to the output shown in <a class="xref" href="ch09.html#results_from_entering_correct_and_incorr" title="Figure 9-4. Results from entering correct and incorrect PINs">Figure 9-4</a>.</p><div class="figure"><a id="results_from_entering_correct_and_incorr"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00179"/><img src="httpatomoreillycomsourcenostarchimages1630120.png.jpg" alt="Results from entering correct and incorrect PINs"/></div></div><div class="figure-title">Figure 9-4. Results from entering correct and incorrect PINs</div></div><p>This example served as a perfect foundation for your own PIN-activated devices, such as locks, alarms, or anything else you can imagine. Just be sure to replace the code in <code class="literal">correctPIN()</code> and <code class="literal">incorrectPIN()</code> with the required code to run when a correct or incorrect sequence is entered.</p></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00077">Looking Ahead</h2></div></div></div><p>Once again, you have learned another way to gather input for your Arduino. You’ve also gained the foundational knowledge to create a useful method of controlling a sketch using a numeric keypad, as well as the foundations for a combination lock to access anything that your Arduino can control. You’ve also learned the very useful <code class="literal">switch</code>-<code class="literal">case</code> function. Moving on to the next chapter you’ll learn about another form of input: the touchscreen.</p></div></section></body></html>
