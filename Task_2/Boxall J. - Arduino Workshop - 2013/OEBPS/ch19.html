<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 19. The Internet</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch18.html" title="Chapter 18. Real-time Clocks"/><link rel="next" href="ch20.html" title="Chapter 20. Cellular Communications"/></head><body><section class="chapter" title="Chapter 19. The Internet" epub:type="chapter" id="internet"><div class="titlepage"><div><div><h2 class="title">Chapter 19. The Internet</h2></div></div></div><p>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Build a web server to display data on a web page</p></li><li class="listitem"><p>Use your Arduino to send tweets on Twitter</p></li><li class="listitem"><p>Remotely control Arduino digital outputs from a web browser</p></li></ul></div><p>In this chapter you’ll learn how to connect your Arduino to the outside world via the Internet. By doing this, you can broadcast data from your Arduino and remotely control your Arduino from a web browser.</p><div class="sect1" title="What You’ll Need"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="what_youapostrophell_need">What You’ll Need</h2></div></div></div><p>To build these Internet-related projects, you will need some common hardware, cable, and information.</p><p>Let’s start with the hardware. You’ll need an Ethernet shield with the W5100 controller chip. You have two options to consider: You can use the genuine Arduino-brand Ethernet shield, as shown in <a class="xref" href="ch19.html#arduino_ethernet_shield" title="Figure 19-1. Arduino Ethernet shield">Figure 19-1</a>, or you can use an Arduino Uno–compatible board with integrated Ethernet hardware, such as the Freetronics EtherTen shown in <a class="xref" href="ch19.html#freetronics_etherten" title="Figure 19-2. Freetronics EtherTen">Figure 19-2</a>. The latter is a good <a id="iddle1215" class="indexterm"/><a id="iddle1224" class="indexterm"/>choice for new projects or those for which you want to save physical space and money. As you can see, the EtherTen has the connectors for Arduino shields, a USB port, an Ethernet socket, and a microSD card socket.</p><div class="figure"><a id="arduino_ethernet_shield"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00290"/><img src="httpatomoreillycomsourcenostarchimages1630350.png.jpg" alt="Arduino Ethernet shield"/></div></div><div class="figure-title">Figure 19-1. Arduino Ethernet shield</div></div><div class="figure"><a id="freetronics_etherten"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00291"/><img src="httpatomoreillycomsourcenostarchimages1630352.png.jpg" alt="Freetronics EtherTen"/></div></div><div class="figure-title">Figure 19-2. Freetronics EtherTen</div></div><p>Regardless of your choice of hardware, you’ll also need a standard 10/100 CAT5, CAT5E, or CAT6 network cable to connect your Ethernet shield to your network router or Internet modem.</p><p>In addition, you’ll need the IP address of your network’s router gateway or modem, which should look something like this: 192.168.0.1. You’ll also need your computer’s IP address in the same format as your router’s IP address.</p><p>Finally, if you want to communicate with your Arduino from outside your home or local area network, you’ll need a static, public IP address. A static IP address is a fixed address assigned to your physical Internet connection by your Internet service provider (ISP). Your Internet connection <a id="iddle1565" class="indexterm"/>may not have a static IP address by default; contact your ISP to have this activated if necessary. If your ISP cannot offer a static IP or if it costs too much, you can get one through a third-party company, such as no-ip (<span class="emphasis"><em><a class="ulink" href="http://www.noip.com/" target="_top">http://www.noip.com/</a></em></span>) or Dyn (<span class="emphasis"><em><a class="ulink" href="http://dyn.com/dns/" target="_top">http://dyn.com/dns/</a></em></span>). They can set you up with a web address that does not change and will divert users to your current IP address.</p><p>Now let’s put our hardware to the test with a simple project.</p></div><div class="sect1" title="Project #60: Building a Remote-Monitoring Station"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash60_building_a_remote-monitor">Project #60: Building a Remote-Monitoring Station</h2></div></div></div><p>In projects in previous chapters, we gathered data from sensors to measure temperature and light. In this project, you’ll learn how to display those values on a simple web page that you can access from almost any web-enabled device. This project will display the values of the analog input pins and the status of digital inputs zero to nine on a simple web page as the basis for a remote-monitoring situation.</p><p>Using this framework, you can add sensors with analog and digital outputs such as temperature, light, and switch sensors and then display the sensors’ status on a web page.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00156">The Hardware</h3></div></div></div><p>Here’s what you’ll need to create this project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One USB cable</p></li><li class="listitem"><p>One network cable</p></li><li class="listitem"><p>One Arduino Uno and Ethernet shield, or one Freetronics EtherTen</p></li></ul></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00157">The Sketch</h3></div></div></div><p>Enter the following sketch, but <span class="emphasis"><em>don’t upload it</em></span> yet:</p><a id="pro_id00170"/><pre class="programlisting">  /* Project 60 – Building a Remote-Monitoring Station
   created 18 Dec 2009 by David A. Mellis, modified 9 Apr 2012 by Tom Igoe
   modified 20 Mar 2013 by John Boxall
   */

  #include &lt;SPI.h&gt;
  #include &lt;Ethernet.h&gt;

<span class="gray-background">1</span> IPAddress ip(<span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span>); //  Replace this with your project's IP address
<span class="gray-background">2</span> byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED };
  EthernetServer server(80);

  void setup()
  {
    // Start the Ethernet connection and server
    Ethernet.begin(mac, ip);
    server.begin();
    for (int z=0; z&lt;10; z++)
    {
      pinMode(z, INPUT); // set digital pins 0 to 9 to inputs
    }
  }

  void loop()
  {
    // listen for incoming clients (incoming web page request connections)
    EthernetClient client = server.available();
    if (client) {
      // an http request ends with a blank line
      boolean currentLineIsBlank = true;
      while (client.connected()) {
        if (client.available()) {
          char c = client.read();
          if (c == '\n' &amp;&amp; currentLineIsBlank) {
            client.println("HTTP/1.1 200 OK");
            client.println("Content-Type: text/html");
            client.println("Connection: close");
            client.println();
            client.println("&lt;!DOCTYPE HTML&gt;");
            client.println("&lt;html&gt;");
            // add a meta refresh tag, so the browser pulls again every 5 sec:
<span class="gray-background">3</span>           client.println("&lt;meta http-equiv=\"refresh\" content=\"5\"&gt;");
            // output the value of each analog input pin onto the web page
            for (int analogChannel = 0; analogChannel &lt; 6; analogChannel++) {
              int sensorReading = analogRead(analogChannel);
<span class="gray-background">4</span>             client.print("analog input ");
              client.print(analogChannel);
              client.print(" is ");
              client.print(sensorReading);
              client.println("&lt;br /&gt;");
            }
            // output the value of digital pins 0 to 9 onto the web page
            for (int digitalChannel = 0; digitalChannel &lt; 10; digitalChannel++) {
              boolean pinStatus = digitalRead(digitalChannel);
              client.print("digital pin ");
              client.print(digitalChannel);
              client.print(" is ");
              client.print(pinStatus);
              client.println("&lt;br /&gt;");
            }
            client.println("&lt;/html&gt;");
            break;
          }
          if (c == '\n') {
            // you're starting a new line
            currentLineIsBlank = true;
          }
          else if (c != '\r') {
            // you've gotten a character on the current line
            currentLineIsBlank = false;
          }
        }
      }
      // give the web browser time to receive the data
      delay(1);
      // close the connection:
      client.stop();
     }
  }</pre><p><a id="iddle1303" class="indexterm"/><a id="iddle1304" class="indexterm"/>We’ll discuss this sketch in more detail a bit later. First, before uploading the sketch, you’ll need to enter an IP address for your Ethernet shield so that it can be found on your local network or modem. You can determine the first three parts of the address by checking your router’s IP address. For example, if your router’s address is 192.168.0.1, change the last digit to something random and different from that of other devices on your network, using a number between 1 and 254 that isn’t already in use on your network. Enter this at <span class="gray-background">1</span> in the sketch, like so:</p><a id="pro_id00171"/><pre class="programlisting">IPAddress ip(192, 168, 0, 69); // Ethernet shield's IP address</pre><p>Once you’ve made that change, save and upload your sketch. Next, insert the Ethernet shield into your Arduino if required, connect the network cable into your router or modem and the Ethernet connector, and power on your Arduino board.</p><p>Wait about 20 seconds, and then using a web browser on any device or computer on your network, enter the IP address from <span class="gray-background">1</span>. If you see something like <a class="xref" href="ch19.html#values_of_the_pins_monitored_by_our_stat" title="Figure 19-3. Values of the pins monitored by our station shown as a web page on any web-connected device with a web browser">Figure 19-3</a>, the framework of your monitoring station is working correctly.</p><div class="figure"><a id="values_of_the_pins_monitored_by_our_stat"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00292"/><img src="httpatomoreillycomsourcenostarchimages1630354.png.jpg" alt="Values of the pins monitored by our station shown as a web page on any web-connected device with a web browser"/></div></div><div class="figure-title">Figure 19-3. Values of the pins monitored by our station shown as a web page on any web-connected device with a web browser</div></div></div><div class="sect2" title="Troubleshooting"><div class="titlepage"><div><div><h3 class="title" id="troubleshooting">Troubleshooting</h3></div></div></div><p>If this project doesn’t work for you, try the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Check that the IP address is set correctly in the sketch at <span class="gray-background">1</span>.</p></li><li class="listitem"><p>Check that the sketch is correct and uploaded to your Arduino.</p></li><li class="listitem"><p>Double-check the local network. You might check to see if a connected computer can access the Internet. If so, check that the Arduino board has power and is connected to the router or modem.</p></li><li class="listitem"><p><a id="iddle1123" class="indexterm"/><a id="iddle1124" class="indexterm"/><a id="iddle1262" class="indexterm"/><a id="iddle1347" class="indexterm"/>If you’re accessing the project web page from a smartphone, make sure your smartphone is accessing your local Wi-Fi network and not the cell phone company’s cellular network.</p></li><li class="listitem"><p>If none of the Ethernet shield’s LEDs are blinking when the Arduino has power and the Ethernet cable is connected to the shield and router or modem, try another patch lead.</p></li></ul></div></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works-id00158">How It Works</h3></div></div></div><p>If and when your monitoring station is working, you can return to the most important parts of the sketch. The code from the beginning until <span class="gray-background">3</span> is required because it activates the Ethernet hardware, loads the necessary libraries, and starts the Ethernet hardware in <code class="literal">void setup</code>. Prior to <span class="gray-background">3</span>, the <code class="literal">client.print</code> statements are where the sketch sets up the web page to allow it to be read by the web browser. From <span class="gray-background">3</span> on, you can use the functions <code class="literal">client.print</code> and <code class="literal">client.println</code> to display information on the web page as you would with the Serial Monitor. For example, the following code is used to display the first six lines of the web page shown in <a class="xref" href="ch19.html#values_of_the_pins_monitored_by_our_stat" title="Figure 19-3. Values of the pins monitored by our station shown as a web page on any web-connected device with a web browser">Figure 19-3</a>.</p><a id="pro_id00172"/><pre class="programlisting">client.print("analog input ");
client.print(analogChannel);
client.print(" is ");
client.print(sensorReading);</pre><p>At <span class="gray-background">4</span> in the sketch, you see an example of writing text and the contents of a variable to the web page. Here you can use HTML to control the look of your displayed web page, as long as you don’t overtax your Arduino’s memory. In other words, you can use as much HTML code as you like until you reach the maximum sketch size, which is dictated by the amount of memory in your Arduino board. (The sizes for each board type are described in <a class="xref" href="ch11.html#microcontroller_comparison_chart" title="Table 11-2. Microcontroller Comparison Chart">Table 11-2</a>.)</p><p>One thing to notice is the MAC address that networks can use to detect individual pieces of hardware connected to the network. Each piece of hardware on a network has a unique MAC address, which can be changed by altering one of the hexadecimal values at <span class="gray-background">2</span>. If two or more Arduino-based projects are using one network, you must enter a different MAC address for each device at <span class="gray-background">2</span>.</p><p>Finally, if you want to view your web page from a device that is not connected to your local network, such as a tablet or phone using a cellular connection, then you’ll need to use a technique called <span class="emphasis"><em>port forwarding</em></span> in your network router or modem, with the public IP set up from an organization such as no-ip (<span class="emphasis"><em><a class="ulink" href="http://www.no-ip.com/" target="_top">http://www.no-ip.com/</a></em></span>) or Dyn (<span class="emphasis"><em><a class="ulink" href="http://dyn.com/dns/" target="_top">http://dyn.com/dns/</a></em></span>). Port forwarding is often unique to the make and model of your router, so do an Internet search for <span class="emphasis"><em>router port forwarding</em></span> or visit a tutorial site such as <span class="emphasis"><em><a class="ulink" href="http://www.wikihow.com/Port-Forward/" target="_top">http://www.wikihow.com/Port-Forward/</a></em></span> for more information.</p><p>Now that you know how to broadcast text and variables over a web page, let’s use the Arduino to tweet.</p></div></div><div class="sect1" title="Project #61: Creating an Arduino Tweeter"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash61_creating_an_arduino_tweet">Project #61: Creating an Arduino Tweeter</h2></div></div></div><p><a id="iddle1539" class="indexterm"/><a id="iddle1540" class="indexterm"/>In this project, you’ll learn how to make your Arduino send tweets through Twitter. You can receive all sorts of information that can be generated by a sketch from any device that can access Twitter. If, for example, you want hourly temperature updates from home while you’re abroad or even notifications when the kids come home, this can offer an inexpensive solution.</p><p>Your Arduino will need its own Twitter account, so do the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Visit <span class="emphasis"><em><a class="ulink" href="http://twitter.com/" target="_top">http://twitter.com/</a></em></span> and create your Arduino’s Twitter account. Make note of the username and password.</p></li><li class="listitem"><p>Get a “token” from the third-party handler website <span class="emphasis"><em><a class="ulink" href="http://arduino-tweet.appspot.com/" target="_top">http://arduino-tweet.appspot.com/</a></em></span>, which creates a bridge between your Arduino and the Twitter service. You’ll need to follow only step 1 on this site.</p></li><li class="listitem"><p>Copy and paste the token (along with your Arduino’s new Twitter account details) into a text file on your computer.</p></li><li class="listitem"><p>Download and install the Twitter Arduino library from <span class="emphasis"><em><a class="ulink" href="http://playground.arduino.cc/Code/TwitterLibrary/" target="_top">http://playground.arduino.cc/Code/TwitterLibrary/</a></em></span>.</p></li></ol></div><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00159">The Hardware</h3></div></div></div><p>Here’s what you’ll need to create this project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One USB cable</p></li><li class="listitem"><p>One network cable</p></li><li class="listitem"><p>One Arduino Uno and Ethernet shield, or one Freetronics EtherTen</p></li></ul></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00160">The Sketch</h3></div></div></div><p>Enter the following sketch, but <span class="emphasis"><em>don’t upload it</em></span> yet:</p><a id="pro_id00173"/><pre class="programlisting">  // Project 61 - Creating an Arduino Tweeter
  #include &lt;SPI.h&gt;
  #include &lt;Ethernet.h&gt;
  #include &lt;Twitter.h&gt;

<span class="gray-background">1</span> byte ip[] = { <span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span>,<span class="emphasis"><em>xxx</em></span> };
<span class="gray-background">2</span> byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED };
<span class="gray-background">3</span> Twitter twitter("<span class="emphasis"><em>token</em></span>");

<span class="gray-background">4</span> char msg[] = "I'm alive!"; // message to tweet

  void setup()
  {
    delay(30000);
    Ethernet.begin(mac, ip);
    Serial.begin(9600);
  }

  void loop()
  {
    Serial.println("connecting ...");
    if (twitter.post(msg)) {
      int status = twitter.wait();
<span class="gray-background">5</span>     if (status == 200) {
        Serial.println("OK.");
      } else {
        Serial.print("failed : code ");
        Serial.println(status);
      }
    } else {
      Serial.println("connection failed.");
    }
    do {} while (1);
  }</pre><p><a id="iddle1501" class="indexterm"/>As with Project 60, insert the IP address at <span class="gray-background">1</span> and modify the MAC address if necessary at <span class="gray-background">2</span>. Then insert the Twitter token between the double quotes at <span class="gray-background">3</span>. Finally, insert the text that you want to tweet at <span class="gray-background">4</span>. Now upload the sketch and connect your hardware to the network. (Don’t forget to follow your Arduino’s Twitter account with your own account!) After a minute or so, visit your Twitter page and the message should be displayed, as shown in <a class="xref" href="ch19.html#your_arduinoapostrophes_tweet" title="Figure 19-4. Your Arduino’s tweet">Figure 19-4</a>.</p><div class="figure"><a id="your_arduinoapostrophes_tweet"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00293"/><img src="httpatomoreillycomsourcenostarchimages1630356.png.jpg" alt="Your Arduino’s tweet"/></div></div><div class="figure-title">Figure 19-4. Your Arduino’s tweet</div></div><p>When you’re creating your Arduino tweeter, keep in mind that you can send no more than one tweet per minute and that each message must be unique. (These are Twitter’s rules.) When sending tweets, Twitter also replies with a status code. The sketch will receive and display this in the Serial Monitor using the code at <span class="gray-background">5</span>, an example of which is shown in <a class="xref" href="ch19.html#results_of_tweeting_too_quickly" title="Figure 19-5. Results of tweeting too quickly">Figure 19-5</a>. If you receive a “403” message like this, either your token is incorrect or you’re sending tweets too quickly. (For a complete list of Twitter error codes, see <span class="emphasis"><em><a class="ulink" href="http://dev.twitter.com/docs/error-codes-responses/" target="_top">http://dev.twitter.com/docs/error-codes-responses/</a></em></span>.)</p></div></div><div class="sect1" title="Controlling Your Arduino from the Web"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="controlling_your_arduino_from_the_web">Controlling Your Arduino from the Web</h2></div></div></div><p>You can control your Arduino from a web browser in several different ways. After doing some research, I’ve found a method that is reliable, secure, and free: Teleduino.</p><p><a id="iddle1503" class="indexterm"/><a id="iddle1505" class="indexterm"/><a id="iddle1507" class="indexterm"/>Teleduino is a free service created by New Zealand Arduino enthusiast Nathan Kennedy. It’s a simple yet powerful tool for interacting with an Arduino over the Internet. It doesn’t require any special or customized Arduino sketches; instead, you simply enter a special URL into a web browser to control the Arduino. You can use Teleduino to control digital output pins and servos, or to send I<sup>2</sup>C commands, and more features are being added all the time. In Project 62, you’ll learn how to configure Teleduino and remotely control digital outputs from a web-enabled device.</p><div class="figure"><a id="results_of_tweeting_too_quickly"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00294"/><img src="httpatomoreillycomsourcenostarchimages1630358.png.jpg" alt="Results of tweeting too quickly"/></div></div><div class="figure-title">Figure 19-5. Results of tweeting too quickly</div></div><div class="note" title="Note"><h3 class="title"><a id="ch19note01"/>Note</h3><p><span class="emphasis"><em>Teleduino works only with the Arduino Uno and compatible boards that use the ATmega328 microcontroller.</em></span></p></div></div><div class="sect1" title="Project #62: Setting Up a Remote Control for Your Arduino"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash62_setting_up_a_remote_contr">Project #62: Setting Up a Remote Control for Your Arduino</h2></div></div></div><p>Before starting your first Teleduino project, you must register with the Teleduino service and obtain a unique key to identify your Arduino. To do so, visit <span class="emphasis"><em><a class="ulink" href="https://www.teleduino.org/tools/request-key/" target="_top">https://www.teleduino.org/tools/request-key/</a></em></span> and enter the required information. You should receive an email with your key, which will look something like this: <code class="literal">187654321Z9AEFF952ABCDEF8534B2BBF</code>.</p><p>Next, convert your key into an array variable by visiting <span class="emphasis"><em><a class="ulink" href="https://www.teleduino.org/tools/arduino-sketch-key/" target="_top">https://www.teleduino.org/tools/arduino-sketch-key/</a></em></span>. Enter your key, and the page should return an array similar to that shown in <a class="xref" href="ch19.html#teleduino_key_as_an_array" title="Figure 19-6. A Teleduino key as an array">Figure 19-6</a>.</p><div class="figure"><a id="teleduino_key_as_an_array"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00295"/><img src="httpatomoreillycomsourcenostarchimages1630360.png" alt="A Teleduino key as an array"/></div></div><div class="figure-title">Figure 19-6. A Teleduino key as an array</div></div><p>Each key is unique to a single Arduino, but you can get more keys if you want to run more than one Teleduino project at a time.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00161">The Hardware</h3></div></div></div><p>Here’s what you’ll need to create this project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One USB cable</p></li><li class="listitem"><p>One network cable</p></li><li class="listitem"><p>One Arduino Uno and Ethernet shield, or one Freetronics EtherTen</p></li><li class="listitem"><p>One 560 Ω resistor (R1)</p></li><li class="listitem"><p>One breadboard</p></li><li class="listitem"><p>One LED of any color</p></li></ul></div><p>Assemble your hardware and connect an LED to digital pin 8, as shown in <a class="xref" href="ch19.html#schematic_for_project_62" title="Figure 19-7. Schematic for Project 62">Figure 19-7</a>.</p><div class="figure"><a id="schematic_for_project_62"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00296"/><img src="httpatomoreillycomsourcenostarchimages1630362.png.jpg" alt="Schematic for Project 62"/></div></div><div class="figure-title">Figure 19-7. Schematic for Project 62</div></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00162">The Sketch</h3></div></div></div><p>Teleduino projects use only one sketch, which is included with the Teleduino library. Here’s how to access the sketch:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Download and install the Teleduino library from <span class="emphasis"><em><a class="ulink" href="https://www.teleduino.org/downloads/" target="_top">https://www.teleduino.org/downloads/</a></em></span>.</p></li><li class="listitem"><p>Restart the Arduino IDE and select <span class="strong"><strong>File</strong></span> ▸ <span class="strong"><strong>Examples</strong></span> ▸ <span class="strong"><strong>Teleduino328</strong></span> ▸ <span class="strong"><strong>TeleduinoEthernetClientProxy</strong></span>.</p></li><li class="listitem"><p>You should now see the Teleduino sketch. Before uploading it to your Arduino, replace the default key with your key array. The variable you need to replace should be on line 36 of the sketch. Once you’ve replaced it, save the sketch, and then upload it to your Arduino.</p></li></ol></div><p><a id="iddle1502" class="indexterm"/><a id="iddle1506" class="indexterm"/>Now connect your hardware to the network and watch the LED. After a minute or so, it should blink a few times and then rest. The number of blinks represents the status of the Teleduino service, as shown in <a class="xref" href="ch19.html#teleduino_status_blink_code" title="Table 19-1. Teleduino Status Blink Code">Table 19-1</a>.</p><div class="table"><a id="teleduino_status_blink_code"/><div class="table-title">Table 19-1. Teleduino Status Blink Code</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Number of blinks</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Message</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Initializing</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Starting network connection</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Connecting to the Teleduino server</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Authentication successful</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Session already exists</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Invalid or unauthorized key</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>10</p></td><td style="vertical-align: top; "><p>Connection dropped</p></td></tr></tbody></table></div></div><p>If you see five blinks, then another Arduino is already programmed with your key and connected to the Teleduino server. At 10 blinks, you should check your hardware and Internet connections. Once the Arduino has connected, it should blink once every 5 seconds or so. Because the status LED is controlled by digital pin 8, you can’t use that pin for any other purpose while you’re using Teleduino.</p></div><div class="sect2" title="Controlling Your Arduino Remotely"><div class="titlepage"><div><div><h3 class="title" id="controlling_your_arduino_remotely">Controlling Your Arduino Remotely</h3></div></div></div><p>To control your Teleduino remotely, you can use any device with a web browser. The command to control the Arduino is sent by entering a URL that you create: <span class="emphasis"><em><a class="ulink" href="http://us01.proxy.teleduino.org/api/1.0/328.php?k=&lt;YOURKEY&gt;&amp;r=setDigitalOutput&amp;pin=&lt;X&gt;&amp;output=&lt;S&gt;" target="_top">http://us01.proxy.teleduino.org/api/1.0/328.php?k=&lt;YOURKEY&gt;&amp;r=setDigitalOutput&amp;pin=&lt;X&gt;&amp;output=&lt;S&gt;</a></em></span>.</p><p>You’ll need to change three parameters in the URL: First, replace <span class="emphasis"><em>&lt;YOURKEY&gt;</em></span> with the long alphanumeric key you received from the Teleduino site. Next, replace <span class="emphasis"><em>&lt;X&gt;</em></span> with the digital pin number you want to control. Third, change the <span class="emphasis"><em>&lt;S&gt;</em></span> to 0 for LOW or 1 for HIGH to alter the digital output. For example, to turn digital pin 7 to HIGH, you would enter: <span class="emphasis"><em>http://us01.proxy.teleduino.org/api/1.0/328.php?k=&lt;YOURKEY&gt;&amp;r=setDigitalOutput&amp;pin=7&amp;output=1”</em></span>.</p><p>After the command succeeds, you should see something like the following in the web browser:</p><a id="pro_id00174"/><pre class="programlisting">{"status":200,"message":"OK","response"
{"result":0,"time":0.22814512252808,"values":[]}}</pre><p>If the command fails, you should see an error message like this:</p><a id="pro_id00175"/><pre class="programlisting">{"status":403,"message":"Key is offline or invalid.","response":[]}</pre><p><a id="iddle1504" class="indexterm"/>You can send commands to change the digital pins HIGH or LOW by modifying the URL. After you have created the URLs for your project, bookmark them in your browser or create a local web page with the required links as buttons. For example, you might have a URL bookmarked to set digital pin 7 to HIGH and another bookmarked to set it back to LOW.</p><p>In some situations, the status of your Arduino outputs could be critical. As a fail-safe in case your Arduino resets itself due to a power outage or other interruption, set the default state for the digital pins. With your project connected to the Teleduino service, visit <span class="emphasis"><em><a class="ulink" href="https://www.teleduino.org/tools/manage-presets/" target="_top">https://www.teleduino.org/tools/manage-presets/</a></em></span>. After entering your unique key, you should see a screen of options that allow you to select the mode and value for the digital pins, as shown in <a class="xref" href="ch19.html#default_pin_status_setup_page" title="Figure 19-8. Default pin status setup page">Figure 19-8</a>.</p><div class="figure"><a id="default_pin_status_setup_page"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00297"/><img src="httpatomoreillycomsourcenostarchimages1630364.png" alt="Default pin status setup page"/></div></div><div class="figure-title">Figure 19-8. Default pin status setup page</div></div></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00163">Looking Ahead</h2></div></div></div><p>Along with easily monitoring your Arduino over the Internet and having it send tweets on Twitter, you can control your Arduino projects over the Internet without creating any complex sketches, having much networking knowledge, or incurring monthly expenses. By using remote control over the Web, you can control the Arduino from almost anywhere and extend the reach of your Arduino’s ability to send data. The three projects in this chapter provide a framework with which you can build upon and design your own remote control projects.</p><p>The next chapter, which is the last one in the book, shows you how to make your Arduino send and receive commands over a cellular network connection.</p></div></section></body></html>
