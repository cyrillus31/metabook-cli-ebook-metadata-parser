<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 5. Working with Functions</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch04.html" title="Chapter 4. Building Blocks"/><link rel="next" href="ch06.html" title="Chapter 6. Numbers, Variables, and Arithmetic"/></head><body><section class="chapter" title="Chapter 5. Working with Functions" epub:type="chapter" id="working_with_functions"><div class="titlepage"><div><div><h2 class="title">Chapter 5. Working with Functions</h2></div></div></div><p><a id="iddle1226" class="indexterm"/>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Create your own functions</p></li><li class="listitem"><p>Learn to make decisions with <code class="literal">while</code> and <code class="literal">do-while</code></p></li><li class="listitem"><p>Send and receive data between your Arduino and the Serial Monitor window</p></li><li class="listitem"><p>Learn about <code class="literal">long</code> variables</p></li></ul></div><p>You’ll learn new methods to make your Arduino sketches easier to read and simpler to design by creating your own functions. You can also create modular, reusable code that will save you time again and again. We’ll introduce a way to make decisions that control blocks of code, and you’ll learn about a type of integer variable called the <code class="literal">long</code>. Then you will use your own functions to create a new type of thermometer.</p><p>A <span class="emphasis"><em>function</em></span> consists of a set of instructions that we can use anywhere in our sketches. Although many functions are available in the Arduino language, sometimes you won’t find one to suit your specific needs—or you may need to run part of a sketch repeatedly to make it work, which is a waste of memory. In both of these situations, you might wish you had a better function to do what you need to do. The good news is that there is such a function—the one you create yourself.</p><div class="sect1" title="Project #9: Creating a Function to Repeat an Action"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash9_creating_a_function_to_rep">Project #9: Creating a Function to Repeat an Action</h2></div></div></div><p>You can write simple functions to repeat actions on demand. For example, the following function will turn the built-in LED on (at <span class="gray-background">1</span> and <span class="gray-background">3</span>) and off (at <span class="gray-background">2</span> and <span class="gray-background">4</span>) twice.</p><a id="pro_id00035"/><pre class="programlisting">  void blinkLED()
  {
<span class="gray-background">1</span>     digitalWrite(13, HIGH);
      delay(1000);
<span class="gray-background">2</span>     digitalWrite(13, LOW);
      delay(1000);
<span class="gray-background">3</span>     digitalWrite(13, HIGH);
      delay(1000);
<span class="gray-background">4</span>     digitalWrite(13, LOW);
      delay(1000);
  }</pre><p>Here is the function being used within a complete sketch, which you can upload to the Arduino:</p><a id="pro_id00036"/><pre class="programlisting">  // Project 9 - Creating a Function to Repeat an Action

  #define LED 13
  #define del 200

  void setup()
  {
    pinMode(LED, OUTPUT);
  }

  void blinkLED()
  {
    digitalWrite(LED, HIGH);
    delay(del);
    digitalWrite(LED, LOW);
    delay(del);
    digitalWrite(LED, HIGH);
    delay(del);
    digitalWrite(LED, LOW);
    delay(del);
  }

  void loop()
  {
<span class="gray-background">1</span>   blinkLED();
    delay(1000);
  }</pre><p>When the <code class="literal">blinkLED()</code> function is called in <code class="literal">void loop()</code> at <span class="gray-background">1</span>, the Arduino will run the commands within the <code class="literal">void blinkLED()</code> section. In other words, you have created your own function and used it when necessary.</p></div><div class="sect1" title="Project #10: Creating a Function to Set the Number of Blinks"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash10_creating_a_function_to_se">Project #10: Creating a Function to Set the Number of Blinks</h2></div></div></div><p>The function we just created is pretty limited. What if we want to set the number of blinks and the delay? No problem; we can create a function that lets us change values, like this:</p><a id="pro_id00037"/><pre class="programlisting">void blinkLED(int cycles, int del)
{
  for ( int z = 0 ; z &lt; cycles ; z++ )
  {
    digitalWrite(LED, HIGH);
    delay(del);
    digitalWrite(LED, LOW);
    delay(del);
  }
}</pre><p>Our new <code class="literal">void blinkLED()</code> function accepts two integer values: <code class="literal">cycles</code> (the number of times we want to blink the LED) and <code class="literal">del</code> (the delay time between turning the LED on and off). So if we wanted to blink the LED 12 times, with a 100-millisecond delay, then we would use <code class="literal">blinkLED(12, 100)</code>. Enter the following sketch into the IDE to experiment with this function:</p><a id="pro_id00038"/><pre class="programlisting">  // Project 10 - Creating a Function to Set the Number of Blinks

  #define LED 13

  void setup()
  {
    pinMode(LED, OUTPUT);
  }

  void blinkLED(int cycles, int del)
  {
    for ( int z = 0 ; z &lt; cycles ; z++ )
    {
      digitalWrite(LED, HIGH);
      delay(del);
      digitalWrite(LED, LOW);
      delay(del);
    }
  }

  void loop()
  {
<span class="gray-background">1</span>   blinkLED(12, 100);
    delay(1000);
  }</pre><p>You can see at <span class="gray-background">1</span> that the values of <code class="literal">12</code> and <code class="literal">100</code> (for the number of blinks and the delay, respectively) are passed into our custom function <code class="literal">blinkLED()</code>, where <code class="literal">cycles</code> will have a value of <code class="literal">12</code> and <code class="literal">del</code> will have a value of <code class="literal">100</code>. Therefore, the LED will blink 12 times with a delay of 100 milliseconds between blinks.</p></div><div class="sect1" title="Creating a Function to Return a Value"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="creating_a_function_to_return_a_value">Creating a Function to Return a Value</h2></div></div></div><p>In addition to creating functions that accept values entered as parameters (as <code class="literal">void blinkLED()</code> did in Project 10), you can also create functions that return a value, in the same way that <code class="literal">analogRead()</code> returns a value between 0 and 1,023 when measuring an analog input, as demonstrated in Project 8. The <code class="literal">void</code> that appears at the start of functions up to this point means that the function doesn’t return anything—that is, the function’s return value is <code class="literal">void</code>. Let’s create some useful functions that return actual values.</p><p>Consider this function that converts degrees Celsius to Fahrenheit:</p><a id="pro_id00039"/><pre class="programlisting">float convertTemp(float celsius)
{
  float fahrenheit = 0;
  fahrenheit = (1.8 * celsius) + 32;
  return fahrenheit;
}</pre><p>In the first line, we define the function name (<code class="literal">convertTemp</code>), its return variable type (<code class="literal">float</code>), and any variables that we might want to pass into the function (<code class="literal">float celsius</code>). To use this function, we send it an existing variable. For example, if we wanted to convert 40 degrees Celsius to Fahrenheit and store the result in a <code class="literal">float</code> variable called <code class="literal">tempf</code>, then we would call <code class="literal">convertTemp</code> like so:</p><a id="pro_id00040"/><pre class="programlisting">tempf = convertTemp(40);</pre><p>This would place <code class="literal">40</code> into the <code class="literal">convertTemp</code> variable <code class="literal">celsius</code> and use it in the calculation <code class="literal">fahrenheit = (1.8 * celsius) + 32</code> in the <code class="literal">convertTemp</code> function. The result is then returned into the variable <code class="literal">tempf</code> with the <code class="literal">convertTemp</code> line <code class="literal">return fahrenheit</code>.</p></div><div class="sect1" title="Project #11: Creating a Quick-Read Thermometer That Blinks the Temperature"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash11_creating_a_quick-read_the">Project #11: Creating a Quick-Read Thermometer That Blinks the Temperature</h2></div></div></div><p>Now that you know how to create custom functions, we’ll make a quick-read thermometer using the TMP36 temperature sensor from <a class="xref" href="ch04.html" title="Chapter 4. Building Blocks">Chapter 4</a> and the Arduino’s built-in LED. If the temperature is below 20 degrees Celsius, the LED will blink twice and then pause; if the temperature falls <a id="iddle1516" class="indexterm"/>between 20 and 26 degrees, the LED will blink four times and then pause; and if the temperature is above 26 degrees, the LED will blink six times.</p><p>We’ll make our sketch more modular by breaking it up into distinct functions that will make the sketch easier to follow, and the functions will be reusable. Our thermometer will perform two main tasks: measure and categorize the temperature, and blink the LED a certain number of times (determined by the temperature).</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00037">The Hardware</h3></div></div></div><p>The required hardware is minimal:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One TMP36 temperature sensor</p></li><li class="listitem"><p>One breadboard</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div></div><div class="sect2" title="The Schematic"><div class="titlepage"><div><div><h3 class="title" id="schematic-id00038">The Schematic</h3></div></div></div><p>The circuit is very simple, as shown in <a class="xref" href="ch05.html#schematic_for_project_11" title="Figure 5-1. Schematic for Project 11">Figure 5-1</a>.</p><div class="figure"><a id="schematic_for_project_11"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00104"/><img src="httpatomoreillycomsourcenostarchimages1629970.png.jpg" alt="Schematic for Project 11"/></div></div><div class="figure-title">Figure 5-1. Schematic for Project 11</div></div></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00039">The Sketch</h3></div></div></div><p>We’ll need to create two functions for the sketch. The first one will read the value from the TMP36, convert it to Celsius, and then return a value of <span class="emphasis"><em>2</em></span>, <span class="emphasis"><em>4</em></span>, or <span class="emphasis"><em>6</em></span>, corresponding to the number of times the LED should blink. We’ll alter the sketch from Project 8 for this purpose.</p><p>For our second function, we’ll use <code class="literal">blinkLed()</code> from Project 9. Our <code class="literal">void</code> loop will call the functions in order and then pause for 2 seconds before restarting.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note01"/>Note</h3><p><span class="emphasis"><em>Remember to save your modified project sketches with new filenames so that you don’t accidentally delete your existing work!</em></span></p></div><p>For the sketch, enter this code into the IDE:</p><a id="pro_id00041"/><pre class="programlisting">// Project 11 - Creating a Quick-Read Thermometer That Blinks the Temperature

#define LED 13

int blinks = 0;

void setup()
{
  pinMode(LED, OUTPUT);
}

int checkTemp()
{
  float voltage  = 0;
  float celsius  = 0;
  float hotTemp  = 26;
  float coldTemp = 20;
  float sensor   = 0;
  int result;
  // read the temperature sensor and convert the result to degrees Celsius

  sensor = analogRead(0);
  voltage = (sensor * 5000) / 1024; // convert raw sensor value to millivolts
  voltage = voltage - 500;          // remove voltage offset
  celsius = voltage / 10;           // convert millivolts to Celsius

  // act on temperature range
  if (celsius &lt; coldTemp)
  {
    result = 2;
  }
else if (celsius &gt;= coldTemp &amp;&amp; celsius &lt;= hotTemp)
  {
    result = 4;
  }
  else
  {
    result = 6;    // (celsius &gt; hotTemp)
  }
  return result;
}

void blinkLED(int cycles, int del)
{
  for ( int z = 0 ; z &lt; cycles ; z++ )
  {
    digitalWrite(LED, HIGH);
    delay(del);
    digitalWrite(LED, LOW);
    delay(del);
  }
}

void loop()
{
  blinks = checkTemp();
  blinkLED(blinks, 500);
  delay(2000);
}</pre><p>Because we use custom functions, all we have to do in <code class="literal">void_loop()</code> is call them and set the delay. The function <code class="literal">checkTemp()</code> returns a value to the integer variable <code class="literal">blinks</code>, and then <code class="literal">blinkLED()</code> will blink the LED <code class="literal">blinks</code> times with a delay of 500 milliseconds. The sketch then pauses for 2 seconds before repeating.</p><p>Upload the sketch and watch the LED to see this thermometer in action. (Be sure to keep this circuit assembled, since we’ll use it in the following examples.)</p></div></div><div class="sect1" title="Displaying Data from the Arduino in the Serial Monitor"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="displaying_data_from_the_arduino_in_the">Displaying Data from the Arduino in the Serial Monitor</h2></div></div></div><p>So far, we have sent sketches to the Arduino and used the LEDs to show us output (such as temperature and traffic signals). Blinking LEDs make it easy to get feedback from the Arduino, but blinking lights can tell us only so much. In this section you’ll learn how to use the Arduino’s cable connection and the IDE’s Serial Monitor window to display data from the Arduino and send data to the Arduino from the computer keyboard.</p><div class="sect2" title="The Serial Monitor"><div class="titlepage"><div><div><h3 class="title" id="serial_monitor">The Serial Monitor</h3></div></div></div><p><a id="iddle1440" class="indexterm"/><a id="iddle1444" class="indexterm"/><a id="iddle1446" class="indexterm"/><a id="iddle1448" class="indexterm"/>To open the Serial Monitor, start the IDE and click the Serial Monitor icon button on the tool bar, shown in <a class="xref" href="ch05.html#serial_monitor_icon_button_on_the_ide_to" title="Figure 5-2. Serial Monitor icon button on the IDE tool bar">Figure 5-2</a>. The Serial Monitor should open and look similar to <a class="xref" href="ch05.html#serial_monitor-id00040" title="Figure 5-3. Serial Monitor">Figure 5-3</a>.</p><div class="figure"><a id="serial_monitor_icon_button_on_the_ide_to"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00105"/><img src="httpatomoreillycomsourcenostarchimages1629972.png.jpg" alt="Serial Monitor icon button on the IDE tool bar"/></div></div><div class="figure-title">Figure 5-2. Serial Monitor icon button on the IDE tool bar</div></div><div class="figure"><a id="serial_monitor-id00040"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00106"/><img src="httpatomoreillycomsourcenostarchimages1629974.png.jpg" alt="Serial Monitor"/></div></div><div class="figure-title">Figure 5-3. Serial Monitor</div></div><p>As you can see in <a class="xref" href="ch05.html#serial_monitor-id00040" title="Figure 5-3. Serial Monitor">Figure 5-3</a>, the Serial Monitor displays an input field at the top, consisting of a single row and a Send button, and an output window below it, where data from the Arduino is displayed. When the Autoscroll box is checked, the most recent output is displayed, and once the screen is full, older data rolls off the screen as newer output is received. If you uncheck Autoscroll, you can manually examine the data using a vertical scroll bar.</p><div class="sect3" title="Starting the Serial Monitor"><div class="titlepage"><div><div><h4 class="title" id="starting_the_serial_monitor">Starting the Serial Monitor</h4></div></div></div><p>Before we can use the Serial Monitor, we need to activate it by adding this function to our sketch in <code class="literal">void setup()</code>:</p><a id="pro_id00042"/><pre class="programlisting">Serial.begin(9600);</pre><p>The value <code class="literal">9600</code> is the speed at which the data will travel between the computer and the Arduino, also known as <span class="emphasis"><em>baud</em></span>. This value must match the speed setting at the bottom right of the Serial Monitor, as shown in <a class="xref" href="ch05.html#serial_monitor-id00040" title="Figure 5-3. Serial Monitor">Figure 5-3</a>.</p></div><div class="sect3" title="Sending Text to the Serial Monitor"><div class="titlepage"><div><div><h4 class="title" id="sending_text_to_the_serial_monitor">Sending Text to the Serial Monitor</h4></div></div></div><p>To send text to the Serial Monitor to be displayed in the output window, you can use <code class="literal">Serial.print</code>:</p><a id="pro_id00043"/><pre class="programlisting">Serial.print("Arduino for Everyone!");</pre><p><a id="iddle1449" class="indexterm"/>This sends the text between the quotation marks to the Serial Monitor’s output window.</p><p>You can also use <code class="literal">Serial.println</code> to display text and then force any following text to start on the next line:</p><a id="pro_id00044"/><pre class="programlisting">Serial.println("Arduino for Everyone!");</pre></div><div class="sect3" title="Displaying the Contents of Variables"><div class="titlepage"><div><div><h4 class="title" id="displaying_the_contents_of_variables">Displaying the Contents of Variables</h4></div></div></div><p>You can also display the contents of variables on the Serial Monitor. For example, this would display the contents of the variable <code class="literal">results</code>:</p><a id="pro_id00045"/><pre class="programlisting">Serial.println(results);</pre><p>If the variable is a <code class="literal">float</code>, the display will default to two decimal places. You can specify the number of decimal places used as a number between 0 and 6 by entering a second parameter after the variable name. For example, to display the <code class="literal">float</code> variable <code class="literal">results</code> to four decimal places, you would enter the following:</p><a id="pro_id00046"/><pre class="programlisting">Serial.print(results,4);</pre></div></div></div><div class="sect1" title="Project #12: Displaying the Temperature in the Serial Monitor"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash12_displaying_the_temperatur">Project #12: Displaying the Temperature in the Serial Monitor</h2></div></div></div><p>Using the hardware from Project 8, we’ll display temperature data in Celsius and Fahrenheit in the Serial Monitor window. To do this, we’ll create one function to determine the temperature values and another to display them in the Serial Monitor.</p><p>Enter this code into the IDE:</p><a id="pro_id00047"/><pre class="programlisting">  // Project 12 - Displaying the Temperature in the Serial Monitor

  float celsius    = 0;
  float fahrenheit = 0;

  void setup()
  {
    Serial.begin(9600);
  }

<span class="gray-background">1</span> void findTemps()
  {
    float voltage = 0;
    float sensor  = 0;

    // read the temperature sensor and convert the result to degrees C and F
    sensor  = analogRead(0);
    voltage = (sensor * 5000) / 1024;  // convert the raw sensor value to millivolts
    voltage = voltage - 500;           // remove the voltage offset
    celsius = voltage / 10;            // convert millivolts to Celsius
    fahrenheit = (1.8 * celsius) + 32; // convert Celsius to Fahrenheit
  }

<span class="gray-background">2</span> void displayTemps()
  {
     Serial.print("Temperature is ");
     Serial.print(celsius, 2);
     Serial.print(" deg. C / ");
     Serial.print(fahrenheit, 2);
     Serial.println(" deg. F");
  // use .println here so the next reading starts on a new line
  }

  void loop()
  {
    findTemps();
    displayTemps();
    delay(1000);
  }</pre><p>A lot is happening in this sketch, but we’ve created two functions, <code class="literal">findTemps()</code> at <span class="gray-background">1</span> and <code class="literal">displayTemps()</code> at <span class="gray-background">2</span>, to simplify things. These functions are called in <code class="literal">void loop()</code>, which is quite simple. Thus you see one reason to create your own functions: to make your sketches easier to understand and the code more modular and possibly reusable.</p><p>After uploading the sketch, wait a few seconds, and then display the Serial Monitor. The temperature in your area should be displayed in a similar manner to that shown in <a class="xref" href="ch05.html#result_from_project_12" title="Figure 5-4. Result from Project 12">Figure 5-4</a>.</p><div class="figure"><a id="result_from_project_12"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00107"/><img src="httpatomoreillycomsourcenostarchimages1629976.png.jpg" alt="Result from Project 12"/></div></div><div class="figure-title">Figure 5-4. Result from Project 12</div></div><div class="sect2" title="Debugging with the Serial Monitor"><div class="titlepage"><div><div><h3 class="title" id="debugging_with_the_serial_monitor">Debugging with the Serial Monitor</h3></div></div></div><p><a id="iddle1158" class="indexterm"/><a id="iddle1445" class="indexterm"/><a id="iddle1566" class="indexterm"/>The Serial Monitor can be used to help <span class="emphasis"><em>debug</em></span> (locate and fix errors) your sketch. For example, if you insert <code class="literal">Serial.println();</code> statements in your sketch containing brief notes about the location in the sketch, then you can see when the Arduino passes each statement. For example, you might use the line</p><a id="pro_id00048"/><pre class="programlisting">Serial.println("now in findTemps()");</pre><p>inside the function <code class="literal">findTemps()</code> to let you know when the Arduino is running that particular function.</p></div></div><div class="sect1" title="Making Decisions with while Statements"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="making_decisions_with_while_statements">Making Decisions with while Statements</h2></div></div></div><p>You can use <code class="literal">while()</code> statements in a sketch to repeat instructions, as long as (<span class="emphasis"><em>while</em></span>) a given condition is true. The condition is always tested <span class="emphasis"><em>before</em></span> the code in the <code class="literal">while()</code> statement is executed. For example, <code class="literal">while ( temperature &gt; 30 )</code> will test to determine if the value of temperature is greater than 30. You can use any comparison operator within the parentheses to create the condition.</p><p>In the following listing, the Arduino will count up to 10 seconds and then continue with its program:</p><a id="pro_id00049"/><pre class="programlisting">int a = 0; // an integer
while ( a &lt; 10 )
{
    a = a + 1;
    delay(1000);
}</pre><p>This sketch starts with the variable <code class="literal">a</code> set to <code class="literal">0</code>. It then adds 1 to the value of <code class="literal">a</code> (which starts at 0), waits 1 second (<code class="literal">delay(1000)</code>), and then repeats the process until <code class="literal">a</code> has a value of 10 (<code class="literal">while ( a &lt; 10 )</code>). Once <code class="literal">a</code> is equal to 10, the comparison in the <code class="literal">while</code> statement is false; therefore, the Arduino will continue on with the sketch after the <code class="literal">while</code> loop brackets.</p><div class="sect2" title="do-while"><div class="titlepage"><div><div><h3 class="title" id="do-while">do-while</h3></div></div></div><p>In contrast to <code class="literal">while</code>, the <code class="literal">do-while()</code> structure places the test <span class="emphasis"><em>after</em></span> the code within the <code class="literal">do-while</code> statement is executed. Here’s an example:</p><a id="pro_id00050"/><pre class="programlisting">int a = 0; // an integer
do
{
    delay(1000);
    a = a + 1;
} while ( a &lt; 100 );</pre><p>In this case, the code between the curly brackets will execute <span class="emphasis"><em>before</em></span> the conditions of the test (<code class="literal">while ( a &lt; 100 )</code>) have been checked. As a result, <a id="iddle1366" class="indexterm"/><a id="iddle1441" class="indexterm"/><a id="iddle1447" class="indexterm"/>even if the conditions are not met, the loop will run once. You’ll decide whether to use a <code class="literal">while</code> or a <code class="literal">do-while</code> function when designing your particular project.</p></div></div><div class="sect1" title="Sending Data from the Serial Monitor to the Arduino"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="sending_data_from_the_serial_monitor_to">Sending Data from the Serial Monitor to the Arduino</h2></div></div></div><p>To send data from the Serial Monitor to the Arduino, we need the Arduino to listen to the <span class="emphasis"><em>serial buffer</em></span>—the part of the Arduino that receives data from the outside world via the serial pins (digital 0 and 1) that are also connected to the USB circuit and cable to your computer. The serial buffer holds incoming data from the Serial Monitor’s input window.</p></div><div class="sect1" title="Project #13: Multiplying a Number by Two"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash13_multiplying_a_number_by_t">Project #13: Multiplying a Number by Two</h2></div></div></div><p>To demonstrate the process of sending and receiving data via the Serial Monitor, let’s dissect the following sketch. This sketch accepts a single digit from the user, multiplies it by 2, and then displays the result in the Serial Monitor’s output window.</p><a id="pro_id00051"/><pre class="programlisting">  // Project 13 - Multiplying a Number by Two

  int number;

  void setup()
  {
    Serial.begin(9600);
  }
  void loop()
  {
    number = 0;     // zero the incoming number ready for a new read
    Serial.flush(); // clear any "junk" out of the serial buffer before waiting
<span class="gray-background">1</span>   while (Serial.available() == 0)
    {
      // do nothing until something enters the serial buffer
    }
<span class="gray-background">2</span>   while (Serial.available() &gt; 0)
    {
      number = Serial.read() - '0';
  // read the number in the serial buffer,
  // remove the ASCII text offset for zero: '0'
    }
    // Show me the number!
    Serial.print("You entered: ");
    Serial.println(number);
    Serial.print(number);
    Serial.print(" multiplied by two is ");
    number = number * 2;
    Serial.println(number);
  }</pre><p><a id="iddle1344" class="indexterm"/><a id="iddle1439" class="indexterm"/><a id="iddle1442" class="indexterm"/><a id="iddle1555" class="indexterm"/>The <code class="literal">Serial.available()</code> test in the first <code class="literal">while</code> statement at <span class="gray-background">1</span> returns 0 if nothing is entered yet into the Serial Monitor by the user. In other words, it tells the Arduino, “Do nothing until the user enters something.” The next <code class="literal">while</code> statement at <span class="gray-background">2</span> detects the number in the serial buffer and converts the text code that represents the data entered into an actual integer number. Afterward, the Arduino displays the number from the serial buffer and the multiplication results.</p><p>The <code class="literal">Serial.flush()</code> function at the start of the sketch clears the serial buffer just in case any unexpected data is in it, readying it to receive the next available data. <a class="xref" href="ch05.html#sample_input_and_output_for_project_13" title="Figure 5-5. Sample input and output for Project 13">Figure 5-5</a> shows the Serial Monitor window after the sketch has run.</p><div class="figure"><a id="sample_input_and_output_for_project_13"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00108"/><img src="httpatomoreillycomsourcenostarchimages1629978.png.jpg" alt="Sample input and output for Project 13"/></div></div><div class="figure-title">Figure 5-5. Sample input and output for Project 13</div></div><p>Although you can now enter numerical data into the Serial Monitor for the Arduino to process, using integer variables limits the range of numbers available. We can use <code class="literal">long</code> variables to increase this range, as discussed next.</p></div><div class="sect1" title="long Variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="long_variables">long Variables</h2></div></div></div><p>To use the Serial Monitor to accept numbers with more than one digit, we need to add some new code to our sketch, as you’ll see shortly. When working with larger numbers, however, the <code class="literal">int</code> variable type can be limiting because it has a maximum value of 32,767. Fortunately, we can extend this limitation by using the <code class="literal">long</code> variable type. A <code class="literal">long</code> variable is a whole number between −2,147,483,648 and 2,147,483,647, a much larger range than that of an <code class="literal">int</code> variable (−32,768 to 32,767).</p></div><div class="sect1" title="Project #14: Using long Variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash14_using_long_variables">Project #14: Using long Variables</h2></div></div></div><p>We’ll use the Serial Monitor to accept <code class="literal">long</code> variables and numbers larger than one digit. This sketch accepts a number of many digits, multiplies that number by 2, and then returns the result to the Serial Monitor.</p><a id="pro_id00052"/><pre class="programlisting">// Project 14 - Using long Variables

long number = 0;
long a = 0;

void setup()
{
  Serial.begin(9600);
}

void loop()
{
  number = 0;     // zero the incoming number ready for a new read
  Serial.flush(); // clear any "junk" out of the serial buffer before waiting
  while (Serial.available() == 0)
  {
    // do nothing until something comes into the serial buffer,
    // when something does come in, Serial.available will return how many
    // characters are waiting in the buffer to process
  }
  // one character of serial data is available, begin calculating
  while (Serial.available() &gt; 0)
  {
    // move any previous digit to the next column on the left;
    // in other words, 1 becomes 10 while there is data in the buffer
    number = number * 10;
    // read the next number in the buffer and subtract the character 0
    // from it to convert it to the actual integer number
    a = Serial.read() - '0';
    // add this value a into the accumulating number
    number = number + a;
    // allow a short delay for more serial data to come into Serial.available
    delay(5);
  }
  Serial.print("You entered: ");
  Serial.println(number);
  Serial.print(number);
  Serial.print(" multiplied by two is ");
  number = number * 2;
  Serial.println(number);
}</pre><p>In this example, two <code class="literal">while</code> loops allow the Arduino to accept multiple digits from the Serial Monitor. When the first digit is entered (the leftmost digit of the number entered), it is converted to a number and then added to the total variable <code class="literal">number</code>. If that’s the only digit, the sketch moves on. If another digit is entered (for example, the <span class="emphasis"><em>2</em></span> in <span class="emphasis"><em>42</em></span>), then the total is multiplied by 10 to shift the first digit to the left, and then the new digit is added to the total. This cycle repeats until the rightmost digit has been added to the total.</p><p><a class="xref" href="ch05.html#sample_input_and_output_from_project_14" title="Figure 5-6. Sample input and output from Project 14">Figure 5-6</a> shows the input and output of this sketch.</p><div class="figure"><a id="sample_input_and_output_from_project_14"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00109"/><img src="httpatomoreillycomsourcenostarchimages1629980.png.jpg" alt="Sample input and output from Project 14"/></div></div><div class="figure-title">Figure 5-6. Sample input and output from Project 14</div></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00041">Looking Ahead</h2></div></div></div><p>Although this chapter may have seemed a little dry, the ability to create your own functions is an important skill that will simplify your sketches and save time and effort. You will make good use of this knowledge in the next chapter.</p></div></section></body></html>
