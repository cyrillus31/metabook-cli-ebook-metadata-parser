<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 7. Liquid Crystal Displays</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch06.html" title="Chapter 6. Numbers, Variables, and Arithmetic"/><link rel="next" href="ch08.html" title="Chapter 8. Expanding Your Arduino"/></head><body><section class="chapter" title="Chapter 7. Liquid Crystal Displays" epub:type="chapter" id="liquid_crystal_displays"><div class="titlepage"><div><div><h2 class="title">Chapter 7. Liquid Crystal Displays</h2></div></div></div><p>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use character LCD modules to display text and numeric data</p></li><li class="listitem"><p>Create custom characters to display on character LCD modules</p></li><li class="listitem"><p>Use large graphic LCD modules to display text and data</p></li><li class="listitem"><p>Create a temperature history graphing thermometer display</p></li></ul></div><p>For some projects, you’ll want to display information to the user somewhere other than a desktop computer monitor. One of the easiest and most versatile ways to display information is with a liquid crystal display (LCD) module and your Arduino. You can display text, custom characters, numeric data using a character LCD module, and graphics with a graphic LCD module.</p><div class="sect1" title="Character LCD Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="character_lcd_modules">Character LCD Modules</h2></div></div></div><p><a id="iddle1338" class="indexterm"/>LCD modules that display characters such as text and numbers are the most inexpensive and simplest to use of all LCDs. They can be purchased in various sizes, which are measured by the number of rows and columns of characters they can display. Some include a backlight and allow you to choose the color of the character and the background color. Any LCD with an HD44780- or KS0066-compatible interface should work with your Arduino. The first LCD we’ll use is a 16-character–by–2-row LCD module with a backlight, as shown in <a class="xref" href="ch07.html#example_lcd_with_trimpot_and_header_pins" title="Figure 7-1. Example LCD with trimpot and header pins">Figure 7-1</a>.</p><div class="figure"><a id="example_lcd_with_trimpot_and_header_pins"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00134"/><img src="httpatomoreillycomsourcenostarchimages1630030.png.jpg" alt="Example LCD with trimpot and header pins"/></div></div><div class="figure-title">Figure 7-1. Example LCD with trimpot and header pins</div></div><p>The <span class="emphasis"><em>trimpot</em></span> (the variable resistor for the LCD) has a value of 10 kΩ and is used to adjust the display contrast. The header pins are soldered into the row of holes along the top of the LCD to make insertion into our breadboard straightforward. The holes along the top of the LCD are numbered 1 through 16. Number 1 is closest to the corner of the module and marked as VSS (connected to GND) in the schematic shown in <a class="xref" href="ch07.html#basic_lcd_schematic" title="Figure 7-2. Basic LCD schematic">Figure 7-2</a>. We’ll refer to this schematic for all of the LCD examples in this book.</p><div class="figure"><a id="basic_lcd_schematic"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00135"/><img src="httpatomoreillycomsourcenostarchimages1630032.png.jpg" alt="Basic LCD schematic"/></div></div><div class="figure-title">Figure 7-2. Basic LCD schematic</div></div><div class="sect2" title="Using a Character LCD in a Sketch"><div class="titlepage"><div><div><h3 class="title" id="using_a_character_lcd_in_a_sketch">Using a Character LCD in a Sketch</h3></div></div></div><p><a id="iddle1014" class="indexterm"/><a id="iddle1273" class="indexterm"/><a id="iddle1341" class="indexterm"/>To use the character LCD shown in <a class="xref" href="ch07.html#example_lcd_with_trimpot_and_header_pins" title="Figure 7-1. Example LCD with trimpot and header pins">Figure 7-1</a>, we will first explain the required functions and how they work through some simple demonstrations. Enter and upload the basic sketch shown in <a class="xref" href="ch07.html#lcd_demonstration_sketch" title="Example 7-1. LCD demonstration sketch">Example 7-1</a>:</p><div class="example"><a id="lcd_demonstration_sketch"/><div class="example-title">Example 7-1. LCD demonstration sketch</div><div class="example-contents"><pre class="programlisting">// Listing 7-1
#include &lt;LiquidCrystal.h&gt;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7
void setup()
{
   lcd.begin(16, 2);
   lcd.clear();
}
void loop()
{
  lcd.setCursor(0, 5);
  lcd.print("Hello");
  lcd.setCursor(1, 6);
  lcd.print("world!");
  delay(10000);
}</pre></div></div><p><a id="iddle1182" class="indexterm"/><a id="iddle1235" class="indexterm"/><a id="iddle1252" class="indexterm"/><a id="iddle1260" class="indexterm"/><a id="iddle1308" class="indexterm"/><a id="iddle1309" class="indexterm"/><a id="iddle1310" class="indexterm"/><a id="iddle1312" class="indexterm"/><a id="iddle1313" class="indexterm"/><a id="iddle1314" class="indexterm"/><a id="iddle1315" class="indexterm"/><a id="iddle1337" class="indexterm"/><a id="iddle1340" class="indexterm"/><a id="iddle1342" class="indexterm"/><a class="xref" href="ch07.html#lcd_demonstration_quotation_markhello_wo" title="Figure 7-3. LCD demonstration: “Hello world!”">Figure 7-3</a> shows the result of <a class="xref" href="ch07.html#lcd_demonstration_sketch" title="Example 7-1. LCD demonstration sketch">Example 7-1</a>.</p><div class="figure"><a id="lcd_demonstration_quotation_markhello_wo"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00136"/><img src="httpatomoreillycomsourcenostarchimages1630034.png.jpg" alt="LCD demonstration: “Hello world!”"/></div></div><div class="figure-title">Figure 7-3. LCD demonstration: “Hello world!”</div></div><p>Now to see how the sketch in <a class="xref" href="ch07.html#lcd_demonstration_sketch" title="Example 7-1. LCD demonstration sketch">Example 7-1</a> works. First we need to include two initial lines in the sketch. Their purpose is to include the library for LCD modules (which is automatically installed with the Arduino IDE), and then we need to tell the library which pins are connected to the Arduino. To do this, we add the following lines <span class="emphasis"><em>before</em></span> the <code class="literal">void setup()</code> method:</p><a id="pro_id00085"/><pre class="programlisting">#include &lt;LiquidCrystal.h&gt;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7</pre><p>If you need to use different digital pins on the Arduino, adjust the pin numbers in the second line of this code.</p><p>Next, in <code class="literal">void setup()</code>, we tell the Arduino the size of the LCD in columns and rows. For example, here’s how we’d tell the Arduino that the LCD has two rows of 16 characters each:</p><a id="pro_id00086"/><pre class="programlisting">lcd.begin(16, 2);</pre></div><div class="sect2" title="Displaying Text"><div class="titlepage"><div><div><h3 class="title" id="displaying_text">Displaying Text</h3></div></div></div><p>With the LCD setup complete, clear the LCD’s display with the following:</p><a id="pro_id00087"/><pre class="programlisting">lcd.clear();</pre><p>Then, to position the cursor, which is the starting point for the text, use this:</p><a id="pro_id00088"/><pre class="programlisting">lcd.setCursor(x, y);</pre><p>Here, <code class="literal">x</code> is the column (0 to 15) and <code class="literal">y</code> is the row (0 or 1). So, for example, to display the word <span class="emphasis"><em>text</em></span>, you would enter the following:</p><a id="pro_id00089"/><pre class="programlisting">lcd.print("text");</pre><p>Now that you can position and locate text, let’s move on to displaying variable data.</p></div><div class="sect2" title="Displaying Variables or Numbers"><div class="titlepage"><div><div><h3 class="title" id="displaying_variables_or_numbers">Displaying Variables or Numbers</h3></div></div></div><p>To display the contents of variables on the LCD screen, use this line:</p><a id="pro_id00090"/><pre class="programlisting">lcd.print(variable);</pre><p>If you are displaying a float variable, you can specify the number of decimal places to use. For example, <code class="literal">lcd.print(pi, 3)</code> in the following example tells the Arduino to display the value of pi to three decimal places, as shown in <a class="xref" href="ch07.html#lcd_displaying_a_floating-point_number" title="Figure 7-4. LCD displaying a floating-point number">Figure 7-4</a>:</p><a id="pro_id00091"/><pre class="programlisting">float pi = 3.141592654;
lcd.print("pi: ");
lcd.print(pi, 3);</pre><div class="figure"><a id="lcd_displaying_a_floating-point_number"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00137"/><img src="httpatomoreillycomsourcenostarchimages1630036.png.jpg" alt="LCD displaying a floating-point number"/></div></div><div class="figure-title">Figure 7-4. LCD displaying a floating-point number</div></div><p>When you want to display an integer on the LCD screen, you can display it in hexadecimal or binary, as shown in <a class="xref" href="ch07.html#functions_for_displaying_binary_and_hexa" title="Example 7-2. Functions for displaying binary and hexadecimal numbers">Example 7-2</a>.</p><div class="example"><a id="functions_for_displaying_binary_and_hexa"/><div class="example-title">Example 7-2. Functions for displaying binary and hexadecimal numbers</div><div class="example-contents"><pre class="programlisting">// Listing 7-2
  int zz = 170;
  lcd.setCursor(0, 0);
  lcd.print("Binary: ");
  lcd.print(zz, BIN);    // display 170 in binary
  lcd.setCursor(0, 1);
  lcd.print("Hexadecimal: ");
  lcd.print(zz, HX);     // display 170 in hexadecimal</pre></div></div><p>The LCD will then display the text shown in <a class="xref" href="ch07.html#results_of_the_code_in_listing_7-2" title="Figure 7-5. Results of the code in Example 7-2">Figure 7-5</a>.</p><div class="figure"><a id="results_of_the_code_in_listing_7-2"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00138"/><img src="httpatomoreillycomsourcenostarchimages1630038.png.jpg" alt="Results of the code in"/></div></div><div class="figure-title">Figure 7-5. Results of the code in <a class="xref" href="ch07.html#functions_for_displaying_binary_and_hexa" title="Example 7-2. Functions for displaying binary and hexadecimal numbers">Example 7-2</a></div></div></div></div><div class="sect1" title="Project #25: Defining Custom Characters"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash25_defining_custom_character">Project #25: Defining Custom Characters</h2></div></div></div><p><a id="iddle1311" class="indexterm"/><a id="iddle1339" class="indexterm"/>In addition to using the standard letters, numbers, and symbols available on your keyboard, you can define up to eight of your own characters in each sketch. Notice in the LCD module that each character is made up of eight rows of five dots, or <span class="emphasis"><em>pixels</em></span>. <a class="xref" href="ch07.html#each_character_is_made_up_of_eight_rows" title="Figure 7-6. Each character is made up of eight rows of five pixels.">Figure 7-6</a> shows a close-up.</p><div class="figure"><a id="each_character_is_made_up_of_eight_rows"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00139"/><img src="httpatomoreillycomsourcenostarchimages1630040.png.jpg" alt="Each character is made up of eight rows of five pixels."/></div></div><div class="figure-title">Figure 7-6. Each character is made up of eight rows of five pixels.</div></div><p>To display your own characters, you must first define each one using an <span class="emphasis"><em>array</em></span>. For example, to create a smiley face, you could use the following:</p><a id="pro_id00092"/><pre class="programlisting">byte a[8] = {  B00000,
               B01010,
               B01010,
               B00000,
               B00100,
               B10001,
               B01110,
               B00000  };</pre><p>Each number in the array addresses an individual pixel in the display. A 0 turns off a pixel, and a 1 turns it on. The elements in the array represent the rows of pixels in the display; the top element is the top row, the next element is the second row down, and so on.</p><div class="note" title="Note"><h3 class="title"><a id="ch07note01"/>Note</h3><p><span class="emphasis"><em>When you’re planning your custom characters, it can be helpful to plan the character using some graph paper. Each square that is filled in represents a 1, and each empty square represents a 0 in the array.</em></span></p></div><p>In this example, since the first element is <code class="literal">B00000</code>, all the pixels in the top row are turned off because we see only 0s. In the next element, <code class="literal">B01010</code>, every other pixel is turned on, and the 1s form the top of the eyes. Each row and pixel continues to fill out the characters.</p><p>Next, assign the array (which defines your new character) to the first of the eight custom character slots in <code class="literal">void setup()</code> with the following function:</p><a id="pro_id00093"/><pre class="programlisting">lcd.createChar(0, a); // assign the array a[8] to custom character slot 0</pre><p><a id="iddle1257" class="indexterm"/><a id="iddle1316" class="indexterm"/>Finally, to display the character, add the following in <code class="literal">void loop()</code>:</p><a id="pro_id00094"/><pre class="programlisting">lcd.write(0);</pre><p>To display our custom character, we’d use the following code:</p><a id="pro_id00095"/><pre class="programlisting">// Project 25 - Defining Custom Characters
#include &lt;LiquidCrystal.h&gt;
LiquidCrystal lcd(4, 5, 6, 7, 8, 9);  // pins for RS, E, DB4, DB5, DB6, DB7
byte a[8] = {  B00000,
               B01010,
               B01010,
               B00000,
               B00100,
               B10001,
               B01110,
               B00000  };
void setup()
{
   lcd.begin(16, 2);
   lcd.createChar(0, a);
}
void loop()
{
   lcd.write(0);  // write the custom character 0 to the next cursor position
}</pre><p><a class="xref" href="ch07.html#result_of_project_25" title="Figure 7-7. The result of Project 25">Figure 7-7</a> shows the smiley faces displayed on the LCD screen.</p><div class="figure"><a id="result_of_project_25"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00140"/><img src="httpatomoreillycomsourcenostarchimages1630042.png.jpg" alt="The result of Project 25"/></div></div><div class="figure-title">Figure 7-7. The result of Project 25</div></div><p>Character LCD modules are simple to use and somewhat versatile. For example, using what you’ve learned, you could create a detailed digital thermometer by combining this LCD and the temperature-measurement part of Project 20. However, if you need to display a lot of data or graphical items, you will need to use a <span class="emphasis"><em>graphic LCD module</em></span>.</p></div><div class="sect1" title="Graphic LCD Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="graphic_lcd_modules">Graphic LCD Modules</h2></div></div></div><p>Graphic LCD modules are larger and more expensive than character modules, but they’re also more versatile. You can use them not only to display text but also to draw lines, dots, circles, and more to create visual <a id="iddle1254" class="indexterm"/>effects. The graphic LCD used in this book is a 128-by-64-pixel module with a KS0108B-compatible interface, as shown in <a class="xref" href="ch07.html#graphic_lcd_module" title="Figure 7-8. A graphic LCD module">Figure 7-8</a>.</p><p>As with the character LCD, the graphic LCD’s trimpot has a value of 10 kΩ and is used to adjust the display contrast. The header pins are soldered to the row of holes along the bottom of the LCD to make insertion into a breadboard more convenient, with the holes numbered 1 through 20. The pin closest to the corner of the module is pin 1.</p><div class="figure"><a id="graphic_lcd_module"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00141"/><img src="httpatomoreillycomsourcenostarchimages1630044.png.jpg" alt="A graphic LCD module"/></div></div><div class="figure-title">Figure 7-8. A graphic LCD module</div></div><div class="sect2" title="Connecting the Graphic LCD"><div class="titlepage"><div><div><h3 class="title" id="connecting_the_graphic_lcd">Connecting the Graphic LCD</h3></div></div></div><p>Before you can use the graphic LCD, you’ll need to connect 20 wires between the LCD and the Arduino. Make the connections as shown in <a class="xref" href="ch07.html#graphic_lcd-to-arduino_connections" title="Table 7-1. Graphic LCD-to-Arduino Connections">Table 7-1</a>.</p><div class="table"><a id="graphic_lcd-to-arduino_connections"/><div class="table-title">Table 7-1. Graphic LCD-to-Arduino Connections</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>LCD Pin Number</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>To Arduino Pin</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>LCD Pin Function</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5 V</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>VDD</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>GND</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>VSS (GND)</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Center of 10 kΩ trimpot</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>VO (Contrast)</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D8</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB0</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D9</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB1</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D10</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB2</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D11</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB3</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>8</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D4</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB4</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>9</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D5</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB5</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>10</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D6</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB6</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>11</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>D7</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>DB7</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>12</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A0</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>CS2</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>13</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>CS1</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>14</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>RST</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>/RESET</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>15</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>R/W</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>16</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A3</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>D/I</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>17</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>A4</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>E</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>18</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Outer leg of trimpot, other trimpot leg to 5 V</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>VEE (trimpot voltage)</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>19</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5 V through a 22 Ω resistor</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>LED backlight anode (+)</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>20</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>GND</p></td><td style="vertical-align: top; "><p>LED backlight cathode (−)</p></td></tr></tbody></table></div></div></div><div class="sect2" title="Using the LCD"><div class="titlepage"><div><div><h3 class="title" id="using_the_lcd">Using the LCD</h3></div></div></div><p><a id="iddle1227" class="indexterm"/><a id="iddle1228" class="indexterm"/><a id="iddle1236" class="indexterm"/><a id="iddle1237" class="indexterm"/><a id="iddle1238" class="indexterm"/><a id="iddle1239" class="indexterm"/><a id="iddle1253" class="indexterm"/>After the LCD is wired up, you can download and install the Arduino library for the graphic LCD module. Download the latest version of the library from <span class="emphasis"><em><a class="ulink" href="http://code.google.com/p/glcd-arduino/downloads/list/" target="_top">http://code.google.com/p/glcd-arduino/downloads/list/</a></em></span> and install it in the same manner described in <a class="xref" href="ch08.html#expanding_sketches_with_libraries" title="Expanding Sketches with Libraries">Expanding Sketches with Libraries</a>.</p><p>Now, to use the LCD, insert the following before the <code class="literal">void setup()</code>:</p><a id="pro_id00096"/><pre class="programlisting">#include &lt;glcd.h&gt;                // include the graphics LCD library
#include "fonts/SystemFont5x7.h" // include the standard character fonts for it</pre><p>Then, after <code class="literal">void setup()</code>, add the following lines to prepare the display:</p><a id="pro_id00097"/><pre class="programlisting">GLCD.Init(NON_INVERTED);    // use INVERTED to invert pixels being on or off
GLCD.SelectFont(System5x7); // choose a font for use on the display
GLCD.ClearScreen();         // clear the LCD screen</pre></div><div class="sect2" title="Controlling the Display"><div class="titlepage"><div><div><h3 class="title" id="controlling_the_display">Controlling the Display</h3></div></div></div><p>The graphic LCD’s display will show up to eight rows of 20 characters of text. To position the text cursor, enter the following, replacing the <span class="emphasis"><em><code class="literal">x</code></em></span> and <span class="emphasis"><em><code class="literal">y</code></em></span> with actual coordinates:</p><a id="pro_id00098"/><pre class="programlisting">GLCD.CursorTo(<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>);</pre><p>To display particular text, replace <span class="emphasis"><em><code class="literal">text</code></em></span> in the following example with the text you want to display:</p><a id="pro_id00099"/><pre class="programlisting">GLCD.Puts("<span class="emphasis"><em>text</em></span>");</pre><p>To display an integer, use the following code, replacing <span class="emphasis"><em><code class="literal">number</code></em></span> with the number you want to display:</p><a id="pro_id00100"/><pre class="programlisting">GLCD.PrintNumber(<span class="emphasis"><em>number</em></span>);</pre></div></div><div class="sect1" title="Project #26: Seeing the Text Functions in Action"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash26_seeing_the_text_functions">Project #26: Seeing the Text Functions in Action</h2></div></div></div><p>The text functions are demonstrated in this sketch:</p><a id="pro_id00101"/><pre class="programlisting">// Project 26 - Seeing the Text Functions in Action
#include &lt;glcd.h&gt;                // include the graphics LCD library
#include "fonts/SystemFont5x7.h" // include the standard character fonts for it

int j = 7;

void setup()
{
  GLCD.Init(NON_INVERTED);
  GLCD.ClearScreen();
  GLCD.SelectFont(System5x7);
}

void loop()
{
  GLCD.ClearScreen();
  GLCD.CursorTo(1, 1);
  GLCD.Puts("Hello, world.");
  GLCD.CursorTo(1, 2);
  GLCD.Puts("I hope you are ");
  GLCD.CursorTo(1, 3);
  GLCD.Puts("enjoying this");
  GLCD.CursorTo(1, 4);
  GLCD.Puts("book. ");
  GLCD.CursorTo(1, 5);
  GLCD.Puts("This is from ");
  GLCD.CursorTo(1, 6);
  GLCD.Puts("chapter ");
  GLCD.PrintNumber(j);
  GLCD.Puts(".");
  do {} while (1);
}</pre><p><a id="iddle1256" class="indexterm"/>The sketch should display the output shown in <a class="xref" href="ch07.html#output_from_project_26" title="Figure 7-9. Output from Project 26">Figure 7-9</a>.</p><div class="figure"><a id="output_from_project_26"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00142"/><img src="httpatomoreillycomsourcenostarchimages1630046.png.jpg" alt="Output from Project 26"/></div></div><div class="figure-title">Figure 7-9. Output from Project 26</div></div><div class="sect2" title="Creating More Complex Display Effects"><div class="titlepage"><div><div><h3 class="title" id="creating_more_complex_display_effects">Creating More Complex Display Effects</h3></div></div></div><p>Now let’s look at a few functions we can use to create various display effects. Keep in mind that the graphic LCD screen has a resolution of 128 columns of 64 pixels, but when we refer to them in various functions, they are counted from 0 to 127 across and 0 to 63 down.</p><p><a id="iddle1229" class="indexterm"/><a id="iddle1230" class="indexterm"/><a id="iddle1231" class="indexterm"/><a id="iddle1232" class="indexterm"/><a id="iddle1233" class="indexterm"/><a id="iddle1234" class="indexterm"/><a id="iddle1240" class="indexterm"/><a id="iddle1255" class="indexterm"/><a id="iddle1514" class="indexterm"/>This graphical function will turn on a single pixel at position <span class="emphasis"><em><code class="literal">x</code></em></span>, <span class="emphasis"><em><code class="literal">y</code></em></span> with the color set to <code class="literal">BLACK</code>, or it will turn off a single pixel with the color set to <code class="literal">WHITE</code>. The <code class="literal">color</code> parameter always sets black to on and white to off.</p><a id="pro_id00102"/><pre class="programlisting">GLCD.SetDot(<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, <span class="emphasis"><em>color</em></span>); // color is BLACK or WHITE</pre><p>The next function draws a rectangle with the upper-left corner at <span class="emphasis"><em><code class="literal">x</code></em></span>, <span class="emphasis"><em><code class="literal">y</code></em></span>. The width is <span class="emphasis"><em><code class="literal">w</code></em></span>, and the depth or vertical size is <span class="emphasis"><em><code class="literal">h</code></em></span>. The resulting rectangle will have a black outline and a white background.</p><a id="pro_id00103"/><pre class="programlisting">GLCD.DrawRect(<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, <span class="emphasis"><em>w</em></span>, <span class="emphasis"><em>h</em></span>, <span class="emphasis"><em>color</em></span>);</pre><p>This function draws a filled rectangle with the same parameters:</p><a id="pro_id00104"/><pre class="programlisting">GLCD.FillRect(<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, <span class="emphasis"><em>w</em></span>, <span class="emphasis"><em>h</em></span>, <span class="emphasis"><em>color</em></span>);</pre><p>This function draws a rectangle with the same parameters but with rounded corners of radius <span class="emphasis"><em><code class="literal">r</code></em></span>.</p><a id="pro_id00105"/><pre class="programlisting">GLCD.DrawRoundRect(x, y, w, h, r, color);</pre><p>This function draws a circle with the center at <code class="literal">x</code>, <code class="literal">y</code> and a radius of <code class="literal">r</code> pixels:</p><a id="pro_id00106"/><pre class="programlisting">GLCD.DrawCircle(x, y, r, color);</pre><p>This draws a vertical line starting from point <span class="emphasis"><em><code class="literal">x</code></em></span>, <span class="emphasis"><em><code class="literal">y</code></em></span>  with a length of <code class="literal">l</code> pixel.</p><a id="pro_id00107"/><pre class="programlisting">GLCD.DrawVertLine(x, y, l, color);</pre><p>And this draws a horizontal line starting from point <span class="emphasis"><em><code class="literal">x, y</code></em></span> with a length of <code class="literal">l</code> pixel.</p><a id="pro_id00108"/><pre class="programlisting">GLCD.DrawHoriLine(x, y, l, color);</pre><p>With the functions discussed so far and some imagination, you can create a variety of display effects or display data graphically. In the next section, we’ll build on our quick-read thermometer example using the LCD screen and some of these functions.</p></div></div><div class="sect1" title="Project #27: Creating a Temperature History Monitor"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash27_creating_a_temperature_hi">Project #27: Creating a Temperature History Monitor</h2></div></div></div><p>In this project, our goal is to measure the temperature once every 20 minutes and display the last 100 readings in a line graph. Each reading will be represented as a pixel, with the temperature on the vertical axis and time on the horizontal. The most current reading will appear on the left, and the display will continually scroll the readings from left to right. The current temperature will also be displayed as a numeral.</p><div class="sect2" title="The Algorithm"><div class="titlepage"><div><div><h3 class="title" id="algorithm-id00058">The Algorithm</h3></div></div></div><p>Although it may sound complex, this project is fairly easy and actually requires only two functions. The first function takes a temperature reading from the TMP36 temperature sensor and stores it in an array of 100 values. Each time a new reading is taken, the previous 99 readings are moved down the array to make way for the new reading, and the oldest reading is erased. The second function draws on the LCD screen. It displays the current temperature, a scale for the graph, and the positions of each pixel for the display of the temperature data over time.</p></div><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00059">The Hardware</h3></div></div></div><p>Here’s what you’ll need to create this project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One 128-by-64-pixel KS0108B graphic LCD module with pins for breadboard use</p></li><li class="listitem"><p>One 10 kΩ trimpot</p></li><li class="listitem"><p>One TMP36 temperature sensor</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>One breadboard</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div><p>Connect the graphic LCD as described in <a class="xref" href="ch07.html#graphic_lcd-to-arduino_connections" title="Table 7-1. Graphic LCD-to-Arduino Connections">Table 7-1</a>, and connect the TMP36 sensor to 5 V, analog 5, and GND.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00060">The Sketch</h3></div></div></div><p>Enter and upload the following sketch, which also includes relevant comments about the functions used.</p><a id="pro_id00109"/><pre class="programlisting">// Project 27 - Creating a Temperature History Monitor

#include &lt;glcd.h&gt;                // include the graphics LCD library
#include &lt;fonts/SystemFont5x7.h&gt; // include the standard character fonts for it

int tcurrent;
int tempArray[100];

void setup()
{
  GLCD.Init(NON_INVERTED); // configure GLCD
  GLCD.ClearScreen();      // turn off all GLCD pixels
  GLCD.SelectFont(System5x7);
}

void getTemp() // function to read temperature from TMP36
{
  float sum = 0;
  float voltage = 0;
  float sensor = 0;
  float celsius;

  // read the temperature sensor and convert the result to degrees C
  sensor   = analogRead(5);
  voltage  = (sensor * 5000) / 1024;
  voltage  = voltage - 500;
  celsius  = voltage / 10;
  tcurrent = int(celsius);

  // insert the new temperature at the start of the array of past temperatures
  for (int a = 99 ; a &gt;= 0 ; --a )
  {
    tempArray[a] = tempArray[a-1];
  }
  tempArray[0] = tcurrent;
}

void drawScreen() // generate GLCD display effects
{
  int q;
  GLCD.ClearScreen();
  GLCD.CursorTo(5, 0);
  GLCD.Puts("Current:");
  GLCD.PrintNumber(tcurrent);
  GLCD.CursorTo(0, 1);
  GLCD.PrintNumber(40);
  GLCD.CursorTo(0, 2);
  GLCD.PrintNumber(32);
  GLCD.CursorTo(0, 3);
  GLCD.PrintNumber(24);
  GLCD.CursorTo(0, 4);
  GLCD.PrintNumber(16);
  GLCD.CursorTo(1, 5);
  GLCD.PrintNumber(8);
  GLCD.CursorTo(1, 6);
  GLCD.PrintNumber(0);
  for (int a = 28 ; a &lt; 127 ; a++)
  {
    q = (55 - tempArray[a-28]);
    GLCD.SetDot(a, q, BLACK);
  }
}

void loop()
{
  getTemp();
  drawScreen();
  for (int a = 0 ; a &lt; 20 ; a++) // wait 20 minutes until the next reading
  {
    delay(60000);          // wait 1 minute
  }
}</pre></div><div class="sect2" title="The Result"><div class="titlepage"><div><div><h3 class="title" id="result">The Result</h3></div></div></div><p>The resulting display should look something like <a class="xref" href="ch07.html#results_of_project_27" title="Figure 7-10. Results of Project 27">Figure 7-10</a>.</p><div class="figure"><a id="results_of_project_27"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00143"/><img src="httpatomoreillycomsourcenostarchimages1630048.png.jpg" alt="Results of Project 27"/></div></div><div class="figure-title">Figure 7-10. Results of Project 27</div></div></div><div class="sect2" title="Modifying the Sketch"><div class="titlepage"><div><div><h3 class="title" id="modifying_the_sketch-id00061">Modifying the Sketch</h3></div></div></div><p>Some people can better interpret data in a visual way instead of just reading numbers. This type of project could also be used to display other kinds of data, such as the voltage from various sensors as measured by analog input pins. Or you could add another temperature sensor and show both values at once. Almost anything that returns a value can be displayed using the graphic LCD module.</p></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00062">Looking Ahead</h2></div></div></div><p>Now that you have experience with LCDs, you can see that the Arduino is in fact a small computer: It can accept and process incoming data and display it to the outside world. But this is only the beginning. In the next chapter you’ll work on making your own Arduino protoshields, record data to microSD memory cards, and learn about libraries and Arduino timing functions.</p></div></section></body></html>
