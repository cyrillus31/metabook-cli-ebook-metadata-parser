<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 10. Accepting User Input with Touchscreens</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="Arduino Workshop: A hands-on introduction with 65 projects"/><link rel="prev" href="ch09.html" title="Chapter 9. Numeric Keypads"/><link rel="next" href="ch11.html" title="Chapter 11. Meet the Arduino Family"/></head><body><section class="chapter" title="Chapter 10. Accepting User Input with Touchscreens" epub:type="chapter" id="accepting_user_input_with_touchscreens"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Accepting User Input with Touchscreens</h2></div></div></div><p>In this chapter you will</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Learn how to connect a resistive touchscreen to your Arduino</p></li><li class="listitem"><p>Discover the values that can be returned from the touchscreen</p></li><li class="listitem"><p>Create a simple on/off touch switch</p></li><li class="listitem"><p>Create an on/off touch switch with a dimmer-style control</p></li></ul></div><p>We see touchscreens everywhere today: smartphones, tablets, and portable video-game systems. So why not use a touchscreen to accept input from a user?</p><div class="sect1" title="Touchscreens"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="touchscreens">Touchscreens</h2></div></div></div><p>Touchscreens can be quite expensive, but we’ll use an inexpensive model available from SparkFun (part numbers LCD-08977 and BOB-09170), originally designed for the Nintendo DS game console.</p><p>This touchscreen, which measures about 2 by 2 3/4 inches, is shown mounted on a breadboard in <a class="xref" href="ch10.html#touchscreen_mounted_on_a_solderless_brea" title="Figure 10-1. Touchscreen mounted on a solderless breadboard">Figure 10-1</a>.</p><div class="figure"><a id="touchscreen_mounted_on_a_solderless_brea"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00180"/><img src="httpatomoreillycomsourcenostarchimages1630122.png.jpg" alt="Touchscreen mounted on a solderless breadboard"/></div></div><div class="figure-title">Figure 10-1. Touchscreen mounted on a solderless breadboard</div></div><p><a id="iddle1203" class="indexterm"/><a id="iddle1526" class="indexterm"/><a id="iddle1527" class="indexterm"/><a id="iddle1528" class="indexterm"/>Notice the horizontal ribbon cable connected into the small circuit board at the upper-right corner (it’s circled in the figure). This <span class="emphasis"><em>breakout board</em></span> is used to attach the Arduino and the breadboard to the touchscreen; <a class="xref" href="ch10.html#touchscreen_connector_board" title="Figure 10-2. Touchscreen connector board">Figure 10-2</a> shows a close-up of the board.</p><div class="figure"><a id="touchscreen_connector_board"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00181"/><img src="httpatomoreillycomsourcenostarchimages1630124.png.jpg" alt="Touchscreen connector board"/></div></div><div class="figure-title">Figure 10-2. Touchscreen connector board</div></div><div class="sect2" title="Connecting the Touchscreen"><div class="titlepage"><div><div><h3 class="title" id="connecting_the_touchscreen">Connecting the Touchscreen</h3></div></div></div><p>Connect the touchscreen breakout board to an Arduino as shown in <a class="xref" href="ch10.html#touchscreen_breakout_board_connections" title="Table 10-1. Touchscreen breakout board connections">Table 10-1</a>.</p><div class="table"><a id="touchscreen_breakout_board_connections"/><div class="table-title">Table 10-1. Touchscreen breakout board connections</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Breakout Board Pin</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Arduino Pin</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Y1</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>A0</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>X2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>A1</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Y2</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>A2</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>X2</p></td><td style="vertical-align: top; "><p>A3</p></td></tr></tbody></table></div></div></div></div><div class="sect1" title="Project #34: Addressing Areas on the Touchscreen"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash34_addressing_areas_on_the_t">Project #34: Addressing Areas on the Touchscreen</h2></div></div></div><p>The touchscreen has two layers of resistive coating between the top layer of plastic film and the bottom layer of glass. One coating acts as the x-axis, and the other is the y-axis. As current passes through each coating, the resistance of the coating varies depending on where it has been touched, so when each current is measured, the X and Y positions of the touched area can be determined.</p><p>In this project, we’ll use the Arduino to record touched locations on the screen and to convert the touches to integers that can be used to reference areas of the screen.</p><div class="sect2" title="The Hardware"><div class="titlepage"><div><div><h3 class="title" id="hardware-id00078">The Hardware</h3></div></div></div><p>The following hardware is required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Touchscreen and breakout board</p></li><li class="listitem"><p>One 10 kΩ trimpot</p></li><li class="listitem"><p>One 16×2-character LCD module</p></li><li class="listitem"><p>Various connecting wires</p></li><li class="listitem"><p>One breadboard</p></li><li class="listitem"><p>Arduino and USB cable</p></li></ul></div><p>Connect the touchscreen as described in <a class="xref" href="ch10.html#touchscreen_breakout_board_connections" title="Table 10-1. Touchscreen breakout board connections">Table 10-1</a>, and connect the LCD module as described in <a class="xref" href="ch07.html#basic_lcd_schematic" title="Figure 7-2. Basic LCD schematic">Figure 7-2</a>.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00079">The Sketch</h3></div></div></div><p>Enter and upload the following sketch. I’ve highlighted important aspects of the sketch with comments:</p><a id="pro_id00121"/><pre class="programlisting">  // Project 34 - Addressing Areas on the Touchscreen

  #include &lt;LiquidCrystal.h&gt;
  LiquidCrystal lcd(4,5,6,7,8,9);

  int x,y = 0;

  void setup()
  {
    lcd.begin(16,2);
    lcd.clear();
  }

<span class="gray-background">1</span> int readX()   // returns the value of the touchscreen's x-axis
  {
    int xr=0;
    pinMode(A0, INPUT);
    pinMode(A1, OUTPUT);
    pinMode(A2, INPUT);
    pinMode(A3, OUTPUT);
    digitalWrite(A1, LOW);   // set A1 to GND
    digitalWrite(A3, HIGH);  // set A3 as 5V
    delay(5);
    xr=analogRead(0);        // store the value of the x-axis
    return xr;
  }

<span class="gray-background">2</span> int readY()     // returns the value of the touchscreen's y-axis
  {
    int yr=0;
    pinMode(A0, OUTPUT);    // A0
    pinMode(A1, INPUT);     // A1
    pinMode(A2, OUTPUT);    // A2
    pinMode(A3, INPUT);     // A3
    digitalWrite(14, LOW);  // set A0 to GND
    digitalWrite(16, HIGH); // set A2 as 5V
    delay(5);
    yr=analogRead(1); // store the value of the y-axis
    return yr;
  }

  void loop()
  {
    lcd.setCursor(0,0);
<span class="gray-background">3</span>   lcd.print(" x = ");
    x=readX();
    lcd.print(x);
    y=readY();
    lcd.setCursor(0,1);
<span class="gray-background">4</span>   lcd.print(" y = ");
    lcd.print(y);
    delay (200);
  }</pre><p>The functions <code class="literal">readX()</code> and <code class="literal">readY()</code> at <span class="gray-background">1</span> and <span class="gray-background">2</span> read the currents from the touchscreen’s resistive layers, measure the current using <code class="literal">analogRead()</code>, and return the read value. The sketch rapidly runs these two functions to provide a real-time position of the screen area being touched and displays this on the LCD at <span class="gray-background">3</span> and <span class="gray-background">4</span>. (The <code class="literal">delay(5)</code> in each function is required to allow the input/output pins time to change their states.)</p></div><div class="sect2" title="Testing the Sketch"><div class="titlepage"><div><div><h3 class="title" id="testing_the_sketch-id00080">Testing the Sketch</h3></div></div></div><p>To test the sketch, monitor the LCD module while you touch the screen, and notice how the X and Y values change relative to the touched position on the screen. Also notice the values displayed when the screen is not being touched, such as those shown in <a class="xref" href="ch10.html#values_that_appear_when_the_touchscreen" title="Figure 10-3. Values that appear when the touchscreen is not touched">Figure 10-3</a>.</p><div class="figure"><a id="values_that_appear_when_the_touchscreen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00182"/><img src="httpatomoreillycomsourcenostarchimages1630126.png.jpg" alt="Values that appear when the touchscreen is not touched"/></div></div><div class="figure-title">Figure 10-3. Values that appear when the touchscreen is not touched</div></div><p><a id="iddle1530" class="indexterm"/>It is important that you note these values, because you can use them to detect when the screen is not being touched in your sketch.</p></div><div class="sect2" title="Mapping the Touchscreen"><div class="titlepage"><div><div><h3 class="title" id="mapping_the_touchscreen">Mapping the Touchscreen</h3></div></div></div><p>By touching the corners of the touchscreen and recording the values returned, you can actually map the touchscreen, as shown in <a class="xref" href="ch10.html#touchscreen_map" title="Figure 10-4. A touchscreen map">Figure 10-4</a>. Basically, you’re plotting the coordinates for each corner. Once you have determined these values, you can divide up the touchscreen map into smaller areas for use as control surfaces.</p><div class="figure"><a id="touchscreen_map"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00183"/><img src="httpatomoreillycomsourcenostarchimages1630128.png.jpg" alt="A touchscreen map"/></div></div><div class="figure-title">Figure 10-4. A touchscreen map</div></div><p>After you’ve created your touchscreen map, you can divide it into smaller regions and use the functions <code class="literal">readX()</code> and <code class="literal">readY()</code> to create a variety of control regions on the screen, which you can then use with <code class="literal">if-then</code> statements to cause specific actions to occur depending on where the screen is touched, as you’ll see in <a class="xref" href="ch10.html#project_hash35_creating_a_two-zone_onsol" title="Project #35: Creating a Two-Zone On/Off Touch Switch">Project #35: Creating a Two-Zone On/Off Touch Switch</a>.</p></div></div><div class="sect1" title="Project #35: Creating a Two-Zone On/Off Touch Switch"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash35_creating_a_two-zone_onsol">Project #35: Creating a Two-Zone On/Off Touch Switch</h2></div></div></div><p><a id="iddle1529" class="indexterm"/>In this project, we’ll use our touchscreen map to create an on/off switch. Start by dividing the touchscreen in half vertically, as shown in <a class="xref" href="ch10.html#onsolidusoff_switch_map" title="Figure 10-5. On/off switch map">Figure 10-5</a>: the left side will be “on” and the right side will be “off.”</p><div class="figure"><a id="onsolidusoff_switch_map"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00184"/><img src="httpatomoreillycomsourcenostarchimages1630130.png.jpg" alt="On/off switch map"/></div></div><div class="figure-title">Figure 10-5. On/off switch map</div></div><p>The Arduino will determine which zone of the touchscreen is touched by comparing the recorded coordinates of the touches to the boundaries of each half of the screen. After the zone has been determined, a digital output could send the on or off signal, but for this sketch we’ll simply display in the Serial Monitor whether a zone has been turned on or off.</p><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00081">The Sketch</h3></div></div></div><p>Enter and upload the following sketch:</p><a id="pro_id00122"/><pre class="programlisting">  // Project 35 - Creating a Two-Zone On/Off Touch Switch

  int x,y = 0;

  void setup()
  {
    Serial.begin(9600);
    pinMode(10, OUTPUT);
  }

  void switchOn()
  {
    digitalWrite(10, HIGH);
    Serial.print("Turned ON at X = ");
    Serial.print(x);
    Serial.print(" Y = ");
    Serial.println(y);
    delay(200);
  }

  void switchOff()
  {
    digitalWrite(10, LOW);
    Serial.print("Turned OFF at X = ");
    Serial.print(x);
    Serial.print(" Y = ");
    Serial.println(y);
    delay(200);
  }

  int readX()                  // returns the value of the touchscreen's x-axis
  {
    int xr=0;
    pinMode(A0, INPUT);
    pinMode(A1, OUTPUT);
    pinMode(A2, INPUT);
    pinMode(A3, OUTPUT);
    digitalWrite(A1, LOW);    // set A1 to GND
    digitalWrite(A3, HIGH);   // set A3 as 5V
    delay(5);
    xr=analogRead(0);
    return xr;
  }

  int readY()                 // returns the value of the touchscreen's y-axis
  {
    int yr=0;
    pinMode(A0, OUTPUT);
    pinMode(A1, INPUT);
    pinMode(A2, OUTPUT);
    pinMode(A3, INPUT);
    digitalWrite(A0, LOW);    // set A0 to GND
    digitalWrite(A2, HIGH);   // set A2 as 5V
    delay(5);
    yr=analogRead(1);
    return yr;
  }

  void loop()
  {
    x=readX();
    y=readY();

<span class="gray-background">1</span> // test for ON<span class="strong"><strong/></span>

    if (x&lt;=900 &amp;&amp; x&gt;=500)
    {
      switchOn();
    }

<span class="gray-background">2</span> // test for OFF<span class="strong"><strong/></span>

    if (x&lt;500 &amp;&amp; x&gt;=100)
    {
      switchOff();
    }
  }</pre></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works-id00082">How It Works</h3></div></div></div><p>The two <code class="literal">if</code> functions used in <code class="literal">void loop()</code> check for a touch on the left or right side of the screen. If the left side is touched, the touch is detected as an “on” press at <span class="gray-background">1</span>. If the right side is touched (an “off” press), the touch is detected at <span class="gray-background">2</span>.</p><div class="note" title="Note"><h3 class="title"><a id="ch10note01"/>Note</h3><p><span class="emphasis"><em>The y-axis is ignored because the touchscreen is split vertically. If we were to create horizontal boundaries, the y-axis would need to be checked as well—as you’ll see in <a class="xref" href="ch10.html#project_hash36_creating_a_three-zone_tou" title="Project #36: Creating a Three-Zone Touch Switch">Project #36: Creating a Three-Zone Touch Switch</a>.</em></span></p></div></div><div class="sect2" title="Testing the Sketch"><div class="titlepage"><div><div><h3 class="title" id="testing_the_sketch-id00083">Testing the Sketch</h3></div></div></div><p>The resulting output of the sketch that appears in the Serial Monitor is shown in <a class="xref" href="ch10.html#output_from_project_35" title="Figure 10-6. Output from Project 35">Figure 10-6</a>. The status of the switch and the coordinates are shown after each screen touch.</p><div class="figure"><a id="output_from_project_35"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00185"/><img src="httpatomoreillycomsourcenostarchimages1630132.png.jpg" alt="Output from Project 35"/></div></div><div class="figure-title">Figure 10-6. Output from Project 35</div></div></div></div><div class="sect1" title="Project #36: Creating a Three-Zone Touch Switch"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="project_hash36_creating_a_three-zone_tou">Project #36: Creating a Three-Zone Touch Switch</h2></div></div></div><p>In this project we’ll create a three-zone touch switch for an LED on digital pin 3 that turns the LED on or off and adjusts the brightness using PWM (<a class="xref" href="ch03.html" title="Chapter 3. First Steps">Chapter 3</a>).</p><div class="sect2" title="The Touchscreen Map"><div class="titlepage"><div><div><h3 class="title" id="touchscreen_map-id00084">The Touchscreen Map</h3></div></div></div><p>Our touchscreen map is shown in <a class="xref" href="ch10.html#touchscreen_map_for_project_36" title="Figure 10-7. Touchscreen map for Project 36">Figure 10-7</a>.</p><div class="figure"><a id="touchscreen_map_for_project_36"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00186"/><img src="httpatomoreillycomsourcenostarchimages1630134.png.jpg" alt="Touchscreen map for Project 36"/></div></div><div class="figure-title">Figure 10-7. Touchscreen map for Project 36</div></div><p>The touchscreen map is divided into “off” and “on” zones and a “brightness” control zone. We measure the values returned by the touchscreen to determine which part has been touched and then act accordingly.</p></div><div class="sect2" title="The Sketch"><div class="titlepage"><div><div><h3 class="title" id="sketch-id00085">The Sketch</h3></div></div></div><p>Enter and upload the following sketch:</p><a id="pro_id00123"/><pre class="programlisting">  // Project 36 - Creating a Three-Zone Touch Switch

  int x,y = 0;

  void setup()
  {
    pinMode(3, OUTPUT);
  }

  void switchOn()
  {
    digitalWrite(3, HIGH);
    delay(200);
  }

  void switchOff()
  {
    digitalWrite(3, LOW);
    delay(200);
  }

  void setBrightness()
  {
    int xx, bright;
    float br;
    xx=x-100;
<span class="gray-background">1</span>   br=(800-xx)/255;
    bright=int(br);
    analogWrite(3, bright);
  }

  int readX()                 // returns the value of the touchscreen's x-axis
  {
    int xr=0;
    pinMode(A0, INPUT);
    pinMode(A1, OUTPUT);
    pinMode(A2, INPUT);
    pinMode(A3, OUTPUT);
    digitalWrite(A1, LOW);   // set A1 to GND
    digitalWrite(A3, HIGH);  // set A3 as 5V
    delay(5);
    xr=analogRead(0);
    return xr;
  }

  int readY()                // returns the value of the touchscreen's y-axis
  {
    int yr=0;
    pinMode(A0, OUTPUT);     // A0
    pinMode(A1, INPUT);      // A1
    pinMode(A2, OUTPUT);     // A2
    pinMode(A3, INPUT);      // A3
    digitalWrite(A0, LOW);   // set A0 to GND
    digitalWrite(A2, HIGH);  // set A2 as 5V
    delay(5);
    yr=analogRead(1);
    return yr;
  }

  void loop()
  {
    x=readX();
    y=readY();

  // test for ON

<span class="gray-background">2</span>  if (x&lt;=500 &amp;&amp; x&gt;=100 &amp;&amp; y&gt;= 150 &amp;&amp; y&lt;375)
    {
      switchOn();
    }

  // test for OFF

<span class="gray-background">3</span>  if (x&gt;500 &amp;&amp; x&lt;=900 &amp;&amp; y&gt;= 150 &amp;&amp; y&lt;375)
    {
      switchOff();
    }

  // test for brightness

<span class="gray-background">4</span>   if (y&gt;=375 &amp;&amp; y&lt;=900)
    {
      setBrightness();
    }
  }</pre></div><div class="sect2" title="How It Works"><div class="titlepage"><div><div><h3 class="title" id="how_it_works-id00086">How It Works</h3></div></div></div><p>As with the sketch for the two-zone map, this sketch will check for touches in the “on” and “off” zones (which are now smaller) at <span class="gray-background">2</span> and <span class="gray-background">3</span> and for any touches above the horizontal divider, which we’ll use to determine brightness at <span class="gray-background">4</span>. If the screen is touched in the brightness area, the position on the x-axis is converted to a relative value for PWM at <span class="gray-background">1</span> and the LED is adjusted accordingly using the function <code class="literal">setBrightness()</code>.</p><p>You can use these same basic functions to create any number of switches or sliders with this simple and inexpensive touchscreen.</p></div></div><div class="sect1" title="Looking Ahead"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="looking_ahead-id00087">Looking Ahead</h2></div></div></div><p>This chapter introduced you to another method of accepting user data and controlling your Arduino. In the next chapter we’ll focus on the Arduino board itself, learn about the different versions available, and create our own version on a solderless breadboard.</p></div></section></body></html>
